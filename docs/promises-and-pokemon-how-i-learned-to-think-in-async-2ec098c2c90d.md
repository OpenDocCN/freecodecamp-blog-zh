# 承诺和口袋妖怪——我如何学会异步思考

> 原文：<https://www.freecodecamp.org/news/promises-and-pokemon-how-i-learned-to-think-in-async-2ec098c2c90d/>

作者卡拉劳·坎特雷尔

# 承诺和口袋妖怪——我如何学会异步思考

![1*J1GQbpmhZFXJ2AxGHLC1Og](img/7f1ecdc6a6350c293bfa7231d885d9c4.png)

Pokeballs. Image Credit: [Lee McKusick.](https://www.flickr.com/photos/leemckusick/9076215503)

如果你一直在学习 JavaScript，你可能听说过承诺，以及它们有多棒。

所以，你决定研究基础知识。也许你偶然看到了关于承诺的 MDN 文档或伟大的文章，如埃里克·埃利奥特的《T2》这篇文章或布兰登·莫雷利的《T4》这篇文章。如果你已经阅读了所有这些以及更多的内容，你可能已经看到了实践承诺的范例。

然而，一旦你看够了这类例子，你就会开始怀疑自己是否真的抓住了承诺。在这一点上，如果你和我一样，你会从概念上理解是什么让它们如此棒——它们允许你以同步模式编写异步代码——但是你渴望看到一个例子，看看它们除了对一系列在不同时间触发的`console.log`进行排序之外还能做什么。

那么，我做了什么？我制作了一个简单的口袋妖怪游戏，以回合制对战电击兽为特色。

**本文假设你已经理解了上面提到的承诺的例子。如果您需要复习，请查看介绍段落中链接的资源。**

### 基本功能

电击兽和玩家都有一定的生命值。首先发生的是电击兽攻击，玩家失去一些生命值。然后，游戏**等待**,直到玩家选择攻击电击兽。

是的，游戏只是等待…等待…这是我真正开始欣赏使用承诺的价值的部分。一旦玩家选择攻击，电击兽会损失一些 HP，然后它会再次攻击。如此循环，直到电击兽或玩家的生命值为零。

### 伪代码

到目前为止很简单。现在，让我们稍微调整一下，让电击兽在更自然的时机进攻。我想让它看起来像是他在行动前在“思考”他的行动。

当我们这样做的时候，让我们加入一点承诺的动作，这样我们就可以连锁那些一旦电击兽完成攻击就会触发的功能，而不是提前一毫秒。这毕竟是一个回合制游戏。

太好了，这个设置稍后将允许我们这样做。

现在，让我们来看看播放器的代码。

我们如何编写一个函数，当它被调用时，在完成执行之前等待用户输入？我们知道它需要为用户输入部分加入一个**事件监听器**。我们也知道，我们应该能够以某种方式将**承诺**用于异步部分……但是如何将两者结合起来呢？

我发现，如果您 1)创建一个承诺，2)在该承诺中添加一个事件侦听器，在我们的例子中，添加到按钮的 click 事件中，3)如果事件侦听器调用的函数解析该承诺，您就可以实现这种等待效果。

瞧啊。现在我们能够做到这一点。

请注意，上面代码中对`playerTurn()`的每次调用都会等待…等待…直到玩家选择攻击。只有到那时，处决才会继续到电击兽，然后再回来。

但是，当同样的代码可以用它的等价的 async/await 形式编写时，为什么要这样写呢？如果到目前为止，您已经能够理解我们对承诺所做的事情，那么了解 async/await 是如何工作的就不是什么难事了。比较下面的代码和上面的，你会发现它们是等价的，但是下面的代码更容易推理。

查看蒂亚戈·洛佩斯·费雷拉的这篇文章或韦斯·博斯的这些幻灯片，深入了解异步/等待。

所以，现在我们的代码能够与电击兽进行几轮回合制战斗。但是我们需要一个结束游戏的方法。

最后，我们希望游戏继续自己运行，直到游戏结束的条件得到满足。我们可以递归调用我们的`gameLoop()`函数，而不是像以前一样手动重复`cpuTurn()`和`playerTurn()`逻辑。

现在，`gameLoop`将继续运行，继续调用自己，继续运行，直到要么电击兽把我们的 HP 降到零，要么我们把他的 HP 降到零。如果你想了解更多关于递归的知识，请观看 MPJ 的视频。当你在做的时候，看看 MPJ 的有趣功能频道上的其他视频。他擅长用有趣的方式解释复杂的话题。

让我们完整地看一下伪代码:

### 代码

现在我们已经完成了伪代码，这里有一支笔展示了我是如何用实际的 JavaScript 实现这个逻辑的:

### 结论

感谢阅读。这个关于承诺的小实验告诉我，当涉及到编写异步代码时，有很多承诺可以简化。虽然 console.logs 和 setTimeouts 的典型承诺示例说明了这个概念，但它并没有让我兴奋，所以我决定创建这个简单的游戏来让我对承诺感到兴奋。我希望你能感受到一些兴奋。如果有任何异步专家正在阅读这篇文章，很高兴听到您关于实现相同功能的更好方法(例如，使用生成器)。如果任何人有不清楚的地方，请告诉我，我会尽力澄清。

**请在[推特](https://www.twitter.com/kalalaucantrell)上随意问好。**