# 亚马逊虚拟私有云课程

> 原文：<https://www.freecodecamp.org/news/amazon-virtual-private-cloud-course/>

Amazon Virtual Private Cloud 是一项服务，允许您在自己定义的逻辑隔离的虚拟网络中启动 AWS 资源。您可以完全控制网络环境，包括 IP 地址范围、子网、路由、防火墙等。

我们刚刚在 freeCodeCamp.org YouTube 频道上发布了关于亚马逊虚拟私有云的完整课程。

尼尔·戴维斯开发了这个课程。他是数字云培训的创始人，拥有丰富的 AWS 经验。

在本 AWS 教程中，您将从初级到高级概念学习 AWS 虚拟私有云(亚马逊 VPC)。你很快就会成为 AWS VPC 大师！

在通过使用动画图表来帮助解释概念的理论之后，您将能够通过许多实践课程边做边学。

以下是本课程的所有部分:

*   IPv4 寻址入门
*   亚马逊 VPC 概述
*   定义 VPC CIDR 街区
*   VPC 巫师
*   创建带有子网的自定义 VPC
*   启动实例并测试 VPC
*   安全组和网络 ACL
*   配置安全组和 NACLs
*   亚马逊 VPC 对等网络
*   配置 VPC 对等
*   VPC 端点
*   创建 VPC 端点
*   AWS 客户端 VPN
*   AWS 站点到站点 VPN
*   AWS VPN CloudHub
*   AWS 直接连接(DX)
*   AWS 直接连接网关
*   AWS 中转网关
*   在 VPC 中使用 IPv6
*   创建 VPC 流量日志

观看 freeCodeCamp.org YouTube 频道的全部课程(2 小时观看)。

[https://www.youtube.com/embed/g2JOHLHh4rI?feature=oembed](https://www.youtube.com/embed/g2JOHLHh4rI?feature=oembed)

## 副本

(自动生成)

Amazon Virtual Private Cloud 是一项服务，允许您在自己定义的逻辑隔离的虚拟网络中启动 AWS 资源。

尼尔·戴维斯教授这门课程。

他创造了许多受欢迎的 AWS 课程，他是一个伟大的老师。

我是数字云培训的尼尔·戴维斯。

在这个动手视频中，您将了解亚马逊虚拟私有云 VPC。

在 AWS 中，VPC 是云的逻辑隔离部分，你可以在其中部署自己的资源，例如 Amazon easy to instances VPC 是一个非常复杂的主题。

在本视频中，我将从初级水平开始，带您进入中级甚至专家级水平，您将学习如何为 VPC 定义自己的 IP 地址范围，如何创建 VPC 并向其中投放资源。

您将了解路由和 VPC 安全组、网络访问控制列表，我们还将介绍 VPN 连接、直接连接等等。

此视频来自我全新的 AWS 认证解决方案架构师助理目标。

因此，如果你打算参加 AWS 认证考试，这个视频将对你非常非常有用。

但它对任何想了解亚马逊 VPC 并实际使用它的人都有好处。

对于那些想了解更多的人来说。

在数字云培训 YouTube 频道上有一些补充视频，包括创建客户端 VPN 和站点到站点 VPN，双手视频，您可以在该视频的描述中找到这些视频的链接。

您还可以找到课程下载，完成本课程的动手练习时需要用到。

现在我真的希望你喜欢这个视频。

让我们直入主题吧。

大家好，在这一课中，我将讲述 IP 寻址的基础知识。

而且我们具体说的是 IP 第四版，不是第六版。

我将在本节的稍后部分讨论版本 6。

现在，我想做的是假设您对 IP 地址没有太多的了解，如果有的话。

我们将从基础开始。

现在这是一个非常复杂的课题。

所以，我只会说到你需要知道的，以便能够胜任与亚马逊 VPC 的合作。

并且通常与 AWS 的 IP 寻址一起使用。

现在，你可能会想深入主题的一些领域。

如果你愿意的话，网上有很多这样的资源。

为了开始这一课，让我们从什么是 IP 地址开始。

现在，假设我们在互联网上有一个 web 服务器，您想与该 web 服务器通信。

现在，web 服务器可能有某种网络接口，并且附加到该网络接口的将是 IP 地址。

这将是一个公共 IP 地址。

在这种情况下，因为 web 服务器可以通过 internet 访问，所以 IP 地址是计算机用来相互通信的地址。

你家里有你的电脑，你有一个打开的网络浏览器。

你输入 example.com，我们网络服务器的地址。

现在发生了什么，因为你输入了 example.com，但是就像我说的，计算机使用 IP 地址进行通信。

这就是域名系统或 DNS 服务器的用武之地。

您的计算机将与 DNS 服务器对话。

它将询问 DNS 服务器 example.com 的 IP 地址是什么。

一旦你的电脑有了结果，它就可以使用 IP 地址连接到网络服务器。

这是主要的名称解析，您将解析一个名称，一个友好的名称，您可以轻松地将其记为 IP 地址，但不太容易记住。

但这是计算机之间真正交流的方式。

让我们继续讨论 IP 地址的结构。

现在，您很可能已经看到了我们在本课程中已经使用过的 IP 地址。

所以一个 IP 地址可能看起来像这个 192 点 168 点 0.1。

这就是所谓的点分十进制记数法。

这是实际表示 IP 地址的一种简单方式。

现在这些点之间的部分实际上是一个二进制八位字节。

这就是事情变得有点复杂的地方。

但是你需要知道这个。

那么什么是二进制八位字节呢？八进制意味着有八个值，这些值可以是 1，也可以是 0。

这是仅有的两个选择。

是二进制的。

在这张小桌子上，你可以看到，在这种情况下，我们曾经有八个一，都在一条线上。

现在在左边，我们有所谓的最高有效位，这意味着如果在最左边，它的值是 128。

如果你有一个 1，在右边，那是最低有效位，它的值只有 1。

如果你有一个零，它只是意味着零。

例如，在这个地址中，第三个二进制八位数是零。

这意味着所有的 8 位都是 0。

1 意味着这里的所有 7 位都是 0。

右手边有一个 1，等于这个最低有效位。

在最左边，我们有 192 个。

嗯，192 是 128 加 64。

所以我们有一个 1 和一个 1，剩下的值都是 0。

对于 168，我们有一个 1，所以是 128。

然后我们在第三个位置有一个 1，也就是 32。

第五位有一个 1，也就是 8。

所以我们有 128 加 32 加 8 等于 168。

理解这种二进制很重要的原因是，当我们谈到子网划分时，我们很快就会看到可变长度子网掩码。

首先，让我们了解 IP 地址网络和主机部分。

每个 IP 地址都有一个网络 ID 和一个主机 ID，左边空白的蓝框代表网络 ID，这个值对于这个网络上的每台计算机都是一样的。

主机 ID 对于网络上的每台计算机都是唯一的。

正如我之前所说，每个 IP 地址都有一个网络和主机 id。

但是这种配置方式是不同的。

现在，我们如何知道哪个是网络 ID，哪个是主机 ID 呢？这就是子网掩码发挥作用的地方。

我们有 255 个。

在这种情况下，本质上我们有一个位，它代表网络 ID。

这里我们有 8 位为 1，8 位为 1，8 位为 1，所以这些第一个空闲的二进制八位数都代表网络 ID。

现在，橙色框中的最后一个二进制八位数将成为主机 ID。

所以才是零。

因此，子网掩码中的每一位都是零，这意味着我们有可以分配给主机的值。

每一位都是 1，这些值对于网络上的每一台计算机都是完全相同的。

因此，子网掩码是一种简单的方法，可以看出哪个位是网络，哪个部分是主机 ID。

让我们来看一个例子。

我们的 19216800 网络的子网掩码如下所示。

这是一个 24 位的子网掩码，因为前三个二进制八位数中有八个 1。

这意味着这是一个全天候的网络。

这是表示子网掩码的另一种方式。

这是您在 AWS 中经常使用的格式。

所以在这个网络上，我们可能有几台计算机。

我们可以看到它们每个都有不同的主机 id。

但是相同网络 ID。

在这种情况下，主机 ID 是 123456，网络 ID 是 1921680。

适用于网络上的所有主机。

我们还有一种叫做带 IP 地址的类的东西。

A 级看起来像这样 10 000 和 255000。

实际上，您有一个 8 位子网掩码。

这意味着第一个可分配的地址将是一个 1，你不能把 0 分配给网络上的计算机。

最后一个可分配的地址将是 254，因为您不能使用 255，也就是众所周知的广播地址。

现在，在 AWS 中，也有一些其他地址使用 a 类子网掩码保留，您可以拥有多达 126 个网络。

每个网络都有大量的主机 16，777，214 台。

这是因为我们有所有这些位来处理主机 ID。

然后我们得到了 B 类，它有一个 16 位子网掩码。

在本例中，第一个可分配的地址是 172 16 01，最后一个地址是 254。

这里我们有 16，382 个网络，因此网络数量增加了很多，每个网络的可用地址减少到了 65，544 个。

最后，我们有一个 c 类。

它有一个 24 位子网掩码。

如您所见，现在网络的数量确实增加了，但是每个网络的可用地址却没有那么多。

这些是标准的类。

现在，还有一种叫做私有 IP 地址范围的东西，其中有一些是保留给私人使用的。

这意味着不是在互联网上，在你们公司内部，我们有 10 个三零到 10 2552 552-551-7216 00217 230-225-5255。

然后 19216800321921680255。

这些地址保留供专用网络使用。

所以不是面向互联网，你不能在公共互联网上使用这些，事情现在变得有点复杂。

有时我们希望改变子网掩码的长度。

我们也不想拘泥于那些标准类。

所以我们使用无类域间路由。

这有助于我们优化 IP 空间。

让我们来看一些例子。

假设我们有这个网络，我们有一个 24 位子网掩码，我们有 8 个地址位和 254 个可能的地址。

第一个地址是点一。

最后是点 254。

到目前为止，相当标准，然后我们有一个 16 位子网掩码。

对于同一个网络，我们使用不同的子网烈士，在这种情况下是非标准的，因为 192168 是典型的 C 类网络。

对于 16 位子网掩码，我们有 16 个主机位和多达 65，534 个地址。

它看起来像这样。

但是一个斜杠 20 的子网掩码呢？在这里，你可以看到，我们有一个蓝色斜线橙色框。

这是因为我们从网络 ID 中借用了一些位来共享它们，并将它们用作主机 ID。

这意味着我们现在有 12 个主机位和 4094 个地址。

所以，有时根据网络上需要的计算机数量和实际需要的网络数量，这是一种更好的配置。

该网络的地址从 01 开始，一直到 15.254。

这就是无类域间路由或 cider。

它使用可变长度的子网掩码。

换句话说，打破标准，优化我们拥有的网络和主机数量。

现在我知道这很复杂，希望在我们阅读这一部分时，它会更有意义。

这就是这节课的全部内容。

我希望你从中获得很多价值，下节课再见。

再见伙计们。

在这一课中，我将向大家介绍亚马逊虚拟私有云或 VPC。

VPC 融合了几个不同的概念。

在这一部分，我们将更详细地探讨它们。

首先，我们将从 VPC 本身的核心知识开始。

因此，在一个区域内，我们有我们的副总裁 C，他们总是在一个区域内，他们不能跨区域。

VPC 本质上是 AWS 云的一个逻辑上隔离的部分，您可以使用它在其中部署您的资源。

这与 VPC 之外的公共空间不同，亚马逊 s3 等服务设置在那里，这是一个私人空间，您可以完全控制如何配置您的 VPC。

如您所知，在一个区域内，我们有可用性分区，您可以通过创建子网并将这些子网分配给可用性分区，在您的 VPC 内使用这些分区。

一个子网总是被分配给一个可用性区域，它不能跨越多个 az。

但是，您当然可以在同一个 AZ 中拥有多个子网，然后我们将资源(例如 easy two 实例)部署到我们的子网中。

现在有一种东西叫做 VPC 路由器。

您实际上看不到 VPC 路由器，但它确实存在，我们通过配置路由表与它进行交互。

现在，VPC 路由器负责子网外部连接的所有路由。

如果你从一个子网发送数据，它必须到别的地方，也许到另一个子网，也许到互联网或其他网络。

因此路由器负责确保数据连接被发送到正确的位置。

正如我所说，您看不到 VPC 路由器。

您只需查看路由表，它们就会为您配置 VPC 路由器。

因此，我们需要为某些网络指定目的地和目标，这就是它如何知道将这些连接尝试发送到哪里。

如果我们想访问互联网，我们还需要一个互联网网关，互联网网关是连接到你的 VPC，你只有一个 VPC，互联网网关是用来发送数据到互联网。

那是出口交通。

来自互联网的流量是入口流量。

我们用到互联网网关 ID 的路由来配置我们的路由表，这告诉它将所有不适合它之前的路由表中的网络之一的流量发送到互联网网关。

现在，您可以在一个区域内创建多个虚拟 PC，默认限制为 5 个，但您可以请求增加数量。

每个 VPC 都有一个苹果酒街区。

这是整个地址块，您可以从中创建分配给子网的地址。

所以这有点像一个主地址块。

每个 VPC 都有不同的一个。

在这种情况下，我们有两台虚拟电脑。

他们有不同的苹果酒块。

正如您在上一课中所学，cider 代表无类域间路由，从整个 cider 块中，我们可以为我们的子网创建网络 id。

它们适合整个苹果酒区。

但是它们有不同的子网掩码，所以本质上是全部可用地址的子集，这就是为什么我们必须确保正确指定我们的 cider 块，以便我们有足够的网络和每个网络足够的主机。

我们将在另一课中讲述这一点。

这里我们有两个虚拟 PC，每个都有不同的 cider 模块，每个都有来自这些 cider 模块的不同子网。

现在，我们将在这一部分讨论许多这些组件，但我现在只想从较高的层面上讨论它们。

你知道什么是 VPC，什么是子网，你也知道什么是互联网网关。

现在，只有出口的互联网网关是当你使用 IP V6 协议时。

它只允许出站流量，而互联网网关是用于 IPv IP 版本 4 的，它允许出站和入站流量。

如您所知，路由器 VPC 路由器负责将连接路由到正确的位置。

现在出现的连接是指你可以连接多台虚拟 pc 机，并在它们之间建立专用路由。

我们将在本节的后面详细讨论这一点。

VPC 端点允许您使用私有 IP 地址连接到 AWS 上的公共服务。

同样，我们稍后将详细讨论这一点。

现在，Nat 实例和网关，我们在本课程前面已经介绍过，这两种方式都可以让您只为专用子网中的实例启用互联网连接出站。

接下来的两个组件，虚拟专用网关和客户网关，都与创建到公司办公室或公司数据中心的虚拟专用网 VPN 连接有关。

这是一个虚拟的私有网络和互联网上的加密隧道。

然后我们有直接连接，它通过使用专用连接直接到达您的数据中心或办公室来避开互联网，安全组和网络 ACL 是两种不同类型的防火墙。

我们将在本节中更详细地介绍它们。

到目前为止，我们已经使用了很多安全组。

它们就是我们所说的实例级防火墙，因为它们运行在连接到我们的 EC 两个实例的网络接口级。

然后我们有网络 ACL，这是一个子网级防火墙。

因此它只能看到进出子网的流量。

简而言之，VPC 的核心知识是一个专用于您的 AWS 客户的虚拟网络。

这类似于在 AWS 中拥有自己的数据中心，因为您可以完全控制自己的行为，包括定义 cider 块、创建自己的子网、设置安全性、路由等等。

你有很多很多的控制权。

它在逻辑上与 AWS 云中的其他虚拟网络相隔离。

正如我之前提到的，您可以完全控制 VPC 中的许多配置项。

VPC 是一个地方，你然后启动你的资源，如亚马逊 82 实例。

当你创建一个 VPC，你必须指定你的苹果酒块。

这就是整个地址块。

现在，我们将了解如何为我们的用例选择最佳的苹果酒模块。

另一个教训是 VPC 跨越了一个地区内的所有 az。

这实际上意味着，如果一个区域中有三个或六个或任意数量的 az，您可以在所有这些 az 上的 VPC 内创建子网。

但是请记住，每个子网总是在一个 AZ 内，它不能跨越 AZ，但是如果您愿意，可以创建多个子网。

在可用性区域中，您还可以完全控制对 VPC 内部资源的访问。

默认情况下，每个区域可以创建五个。

但是如果你提交了申请，你可以延期。

默认 VPC 在每个区域中创建，每个可用性分区中有一个子网。

这始终是一个公共子网。

因此，无论哪个区域被更改为您的 fine，它都已经是默认 VPC，并且其中已经有许多公共子网。

这就是这节课的全部内容。

在下一课中，我们将了解如何为我们的用例设计出合适的苹果酒模块。

在这一课中，我们将看看我们需要做些什么来定义苹果酒块，我们将使用一些规则、指南和最佳实践。

首先是规则和指导方针。

这些来自 AWS，cider 块大小可以在斜杠 16 和斜杠 28 子网掩码之间，它不能与任何与 VPC 关联的现有 cider 块重叠。

你不能增加或减少现有苹果酒街区的大小。

所以你必须从一开始就弄清楚，前四个和最后一个 IP 地址是不可用的。

因此，当您设置子网的大小时，必须考虑到这一点。

因为您希望确保为您部署的实例提供足够的地址。

AWS 建议您使用 RFC 1918 系列的苹果酒块。

请记住，这些是私有 IP 范围。

这就是这些地址。

当然，这些给了你足够的空间。

所以这应该不成问题。

现在让我们来看一个例子。

假设我有一块 VPC 苹果酒，看起来像这样。

它是 10 000，子网掩码为 16 位。

这意味着它看起来像这个 10 000 斜杠 16。

这就是整个地址块。

但是现在我们想创建我们的子网。

我们需要做的是从主机部分取出一些位，并将其分配给网络部分。

所以也许我们会有 10 010 斜线 24。

这意味着我们从第三个二进制八位数借用了所有八个位作为网络 ID。

因此，您的 VPC 子网的子网掩码将比它们来自的 cider 块更长。

在这种情况下，它是一个 24 位子网掩码。

现在下一个网络是什么，下一个网络是 10 020 斜杠 24。

然后下一个是 10，零自由，零斜线 24。

因此，每个子网最多有 254 台潜在主机。

但是当然，你必须从这个数字中减去几个。

所以从那个数字中减去 5。

这就是 ec2 实例剩余的地址数量。

因此，只要您对每个网络的实例数量感到满意，这仍然是一个相当大的数字，那么这是一个很好的、非常简单的使用范围。

现在，我们来看一些额外的注意事项。

你必须确保你有足够的网络和主机，你真的不想搞砸了。

你只能设置苹果酒块一次，然后你就被它卡住了。

所以确保你的计划是正确的。

更大的苹果酒块通常更好，给你更多的灵活性。

对于大多数用例来说，较小的子网是可以的，每个子网不需要 1000 个实例。

考虑在每个子网部署应用层。

因此，如果您有一个自由层应用程序，那么每个层可能有不同的子网。

您可能会让它在多个可用性区域中具有高可用性，并且在每个 AZ 中都有一个子网。

因此，这是让您的工作负载获得高可用性和弹性的好方法。

现在，VPC 对等，我们稍后将讨论，是您连接您的 VP C 的地方，这样您可以使用私有 IP 地址在它们之间直接路由，这样您就不用到公共互联网了。

现在最重要的是你不能有重叠的苹果酒街区。

换句话说，你不能在两台 v 电脑上使用相同的苹果酒块，然后用 VPC 对等技术连接它们。

因此，即使你现在没有进行对等操作，也要记住这一点，因为你将来可能需要这样做。

你要确保你的苹果酒块没有重叠。

这是针对所有虚拟个人电脑、所有地区和所有客户的，所以请确保填写正确。

所以总的来说，尽量避免重叠苹果酒街区就好了。

请确保在设计 IP 地址范围时考虑到这一点。

那么让我们回到一个例子。

假设我们有 10 000 个斜杠 16。

这就是我们的苹果酒街区。

我们创建了一系列子网。

现在，这些子网中的每一个都有一个 24 位子网掩码，正如您所看到的，我们在不同的可用性分区中将它们分为公共和私有子网，私有子网有一个私有路由表，而公共子网有一个不同的路由表。这里的公共子网的主路由表将有一个 internet 网关。

这些子网还会将公共 IP 地址分配给在其中启动的实例。

这是它背后的一点理论和一些实际例子。

我还想向您展示一个非常有用的工具，它可以帮助您规划苹果酒街区和子网。

我将在本课中附上该工具的链接。

现在，我们可以使用该工具指定我们的 cider 块，并查看子网。

实际上，该工具可以根据我们需要的子网数量或每个网络的主机数量，帮助我们确定使用哪些子网。

因此，让我们坚持这个例子，并把 10.0 点 0.0。

然后是子网掩码，我们将向下滚动到斜杠 16。

现在，我希望子网至少有 254 台主机。

这将是一个标准的 C 类网络。

现在让我们看看我们得到了什么。

让我们单击“Create”。

它为我们提供了所有子网，子网掩码为斜杠 24 位，适合 cider 块。

这里是零子网。

然后一路向下，我们到达最后一个子网，即 255。

我们可以有 255 个子网。

每个子网最多可以支持 254 台主机。

当然，VPC 实际上会保留一些地址，所以你不会得到那么多，但你仍然会得到接近 250 个。

这是一个非常好的工具，可以帮助您确定 cider 模块中的子网。

这也将帮助你确定最好的苹果酒块。

大家好，在这一课中，我将向你们展示如何使用 VPC 向导。

该向导可以帮助您真正轻松地创建 VPC，而无需做太多的手动工作。

在我的管理控制台中。

让我们来看看网络和 VPC。

在这里的 VPC 控制面板上，我可以选择启动 VPC 向导，然后我们会看到四个不同的预配置选项。

我想做的是浏览一下每个选项能给你带来什么。

第一个是带有一个公共子网的 VPC。

很简单。

你得到一个斜线 16 苹果酒块和一个斜线 24。

子网。

而且是公共子网。

因此，如果您选择此选项，您可以指定您的 cider 块，它会为您提供此默认值，您可以指定一个名称，它也已经进入子网 cider 块。

如果你愿意，你可以选择一个 AZ，否则，在输入名称后，你可以直接创建 VPC，它会为你完成所有的任务。

这将包括连接一个互联网网关，以便您的公共子网可以连接互联网。

现在，让我们取消这一切，让我们返回到 VPC，查看公共子网和私有子网。

因此，现在您只需获得公共和私有子网。

您还会得到一个网络地址转换设备，因此您会得到一个 NAT 网关，这样您的私有实例就可以访问互联网。

同样，有了这个选项，除了不同的子网(公共子网和私有子网)之外，没有太多需要配置的。

这里的关键区别是您的 Nat 网关需要一个弹性 IP，所以您需要一个弹性 IP 分配 ID。

现在让我们再回去。

这一次，我们将带着公共和私有子网以及硬件 VPN 访问去 VPC。

这里有公共子网和私有子网。

并且还创建了 VPN 隧道。

现在，您需要在企业数据中心安装一台 VPN 设备。

如果我们选择这个选项，我们给它起个名字，我的 VBC。

并在此页面上保留默认值，单击 Next。

然后，它将询问客户网关 IP，这是您公司数据中心网络侧的 VPN 设备的 IP 地址。

因此，如果您指定这些细节，当您创建这个 VPC 时，它将建立这种联系。

我们回去吧，再回去。

底部的最后一个是 VPC，只有一个专用子网，硬件 VPN 访问与之前的相同，只是您只有一个专用子网。

这样，您就有了一个从公司数据中心到 AWS 上的私有子网的 VPN 连接，而没有从 AWS 中的那个子网通过互联网发出的路由。

这就是四个选项。

我只是想快速向你们展示一下。

在下一课中，我们将实际创建我们自己的自定义 VPC。

在本课中，我们将创建一个包含公有子网和私有子网的自定义 VPC。

现在，让我们看看我们将要创建的内容，我们将使用在部分中看到的相同示例 cider 块，它将是一个 10 000 网络，带有 16 位子网掩码，这是整个地址块，然后我们将创建这四个子网。

我们有私有一个 a，私有一个 B，公共一个 B，一个 a 和一个 B 表示它们与特定的可用性区域相关联。

现在，专用子网将有一个专用路由表，公共子网将有一个创建的主路由表，默认情况下，会将一个 internet 网关连接到我们的 VPC。

并且主路由表将具有经由因特网网关到那些公共子网的因特网的路由。

我们还必须指定我们希望我们的实例自动选择一个公共 IP 地址。

这就是配置，让我们到控制台来完成它。

在 VPC 仪表板上。

我将转到您的 V PCs，我们只有一个默认 VPC。

所以让我们创建一个新的。

在你的课程下载代码目录中，亚马逊 VPC，你会有这个文件一个自定义的 bash VPC，我们可以简单地复制值。

我已经知道了名称，它将放在 name tag 下，让我们复制 cider 块并将其放在 ipv4 cider 块下。

在这个阶段，我们不打算做 ipv6。

在本课程中，我们将租赁保留为默认值。

如果您更改为专用，它会将您的实例放在专用于您的硬件上，这将花费您更多的钱。

所以一定要把它作为默认值。

这就是我们创造 VPC 所需要做的一切。

所以 VPC 被创造出来了。

我喜欢做的一件事是转到操作，编辑 DNS 主机名，并启用，这意味着我们将获得我们的 EC 两个实例的 DNS 主机名。

下一个任务是创建我们的子网，我们有公共子网和私有子网。

我将把这些值复制到我的剪贴板上，然后我们再回到子网。

创建子网，我们需要指定我们的 VPC。

我的 VPC，然后我们可以输入名称和子网名称，选择一个美国东部一个可用性分区

然后是苹果酒街区的 IP B，我们会回来，我们会复制这个苹果酒街区。

我们会把它粘贴进去。

现在，我们可以在那里创建子网，也可以添加一个新的子网。

我们将对接下来的三个子网进行同样的操作。

因此，只需浏览该文件并复制您的额外空闲子网的设置。

完成后，您的页面应该是这样的，您在美国东部一个 a 中有一个公共一 a，我们有一个 10 01 网络块，然后您有一个到公共一 B 的子网，它应该在美国东部一 B 中，所以让我们修改它。

而且 10 零到私一 a 应该也在美东一，a 10，零免费，然后私一 B 在美东一，b 10 04。

所以一切看起来都很好。

让我们创建所有四个子网。

这就是创建的四个子网。

现在是我们的公共子网。

我们希望转到此处的操作，修改自动分配 IP 设置，并启用公共 ipv4 地址的自动分配。

我已经为公共 1，B 做了，让我们为公共 1，a 做。

这些现在都更新了。

接下来，我需要为我的私有子网创建一个路由表。

因此它们不附属于主路由表，而主路由表是公共子网所在的位置。

让我们来看看路由表。

创建路由表，我们将指定一个名称，我在剪贴板上的 private RT 文件中有这个名称。

对于 VPC，我将选择我的 VPC。

然后我们将创建路由表。

创建完成后，转到“子网关联”,编辑子网关联，然后选择“专用一号 B”和“专用一号 a”并保存。

现在我们已经完成了，如果我们进入子网关联，我们应该会看到专用子网 A 和 b 的显式关联。

如果我们回到路由表，我们会在这里看到另一个路由表。

这是主路由表，如果您愿意，也可以称之为公共路由表。

在子网关联下，没有显式的子网关联，但是一个 a 和一个 B public 隐式关联。

我需要做的下一件事是去创建一个互联网网关。

在“internet gateways”下，我们来创建一个 internet gateways。

我们会给它一个名字。

让我们从文件中粘贴这个值并创建 internet gateway。

一旦它被创建，它需要被附加和行动，你可以附加到 VPC，选择 VPC，然后附加互联网网关。

现在，我们需要做的最后一件事是，我们已经有了一个互联网网关。

我们不从主路由表中路由。

所以我们来看看这里的主路由表。

转到路由，编辑路由，添加路由，我们将输入 0000 斜杠零，选择我们的互联网网关。

它在列表中。

所以现在，苹果酒街区内的所有东西都将由 VPC 路由器进行本地路由。

所有不在 VPC 苹果酒街区的东西都将通过互联网网关进入互联网。

所以让我们保存这些更改。

就这样，我们创建了自己的自定义 VPC，包括公共子网、用于路由选择的私有子网和一个互联网网关。

现在，这就是我在这节课上需要做的。

在下一课中，我想做的是启动一些实例，测试我们的配置，并确保我们有预期的通信。

因此，我们已经创建了我们的自定义 VPC，我现在就想测试一下。

因此，我们将启动一些简单的两个实例，两个实例位于两个不同的公共子网中，一个位于私有子网中。

我们实际上要通过命令行来完成，了解命令行真的很有用。

现在不是所有的考试都要求你知道命令行。

因此，对于解决方案架构师助理来说，这并不太重要。

对于开发人员来说，它在某些服务上做得更多一点，对于 sysops 考试来说更是如此。

现在，无论你在做什么考试，或者无论你在 AWS 走什么职业道路，它仍然是一项非常有用的技能。

所以绝对值得学习命令行。

所以我们将使用命令行启动一些实例。

然后我们将使用这些实例来测试彼此之间的连通性。

在我们开始之前，我想做几件事。

首先，我想创建一个 NAT 网关。

所以我在 VPC 管理控制台。

在 Nat gateways 下，我们创建一个 Nat 网关，我将把它称为我的 Nat GW，我需要选择一个子网。

请记住，使用 Nat 网关时，它们总是位于公共子网中。

这里，我将选择 public one a，我知道它也在正确的 VPC 内。

因此，连接是公共的，我们分配一个弹性 IP，然后只需创建 NAT 网关。

当然，在我们更新私有子网的路由表之前，它不会起作用。

因此，在路由表下，我们选择私有 RT。

转到路线，编辑路线，添加路线，我们将指定 000 斜杠 0。

这一次，它将是一个 NAT 网关。

我们将选择 Nat 网关 ID。

现在我们的私有子网可以访问互联网了。

这很重要，因为当我们的实例启动时，我们将运行一些用户数据。

它将连接到互联网，为 httpd 下载一些二进制文件。

接下来是安全组，我们需要一个安全组。

让我们创建一个安全组。

我将把它命名为 public that web，给它一个描述，并确保我选择了我的 VPC。

对于出站规则。

默认情况下，它允许所有流量到达任何目的地。

对于目前的入站流量，我们将添加来自任何目的地的所有流量。

所以这是非常开放的，不要担心，我们将在后续课程中锁定它，并使用一些不同的安全组配置进行练习。

但是现在，让我们打开一切。

我将创建我的安全组，现在可以使用了。

你的课程下载里有一个文件。

这是在代码亚马逊 VPC 目录，这是 AWS COI 运行实例，我们需要添加一些值到这个文件中。

对于这个命令，我们需要做的第一件事是指定一个图像 ID。

所以这个命令很容易运行 dash 实例。

这些是我们需要指定的值。

所以首先，让我们找到我们想要使用的 AMI ID。

ami IDs 是区域特定的。

因此，我们必须确保我们在本课中所做的一切都在同一区域内。

这也是你创造你的自定义 VPC。

所以对我来说，这就是北弗吉尼亚，希望对你来说也一样。

让我们启动一个实例。

旁边是亚马逊 Linux 两个 ami。

让我们抓住这个 ami ID，不要拿括号里的任何东西，把它复制到剪贴板上。

返回并粘贴到实例类型中，我们只需键入它，它只是安全组 id 的两个点微。

我们回去找我们安保组的 ID。

我可以看到我的公共 web 访问安全组。

让我们复制安全组 ID，然后将它粘贴进来。

然后我们需要子网 ID。

这一次，我回到了 VPC 管理控制台。

让我们去子网。

首先，我想要公共的一个子网 ID。

所以我要把它复制到我的剪贴板上。

Key name 是您在这个特定区域中使用的密钥对。

回到 ec2，你可以去 key pairs 如果你不记得它是什么，只需复制这个名字。

我们可以把它粘贴进去。

最后，我们将指定一些用户数据。

这是用户数据文件。

它所做的是运行一个网络服务器。

然后它从元数据中创建几个变量，实际上是获取子网 ID，它基本上只是把它放到一个简单的网页中。

因此我们可以看到实例在哪里运行。

在这里的命令中，我们只需要指定该文件的名称。

现在你要做的是转到你的亚马逊 VPC 目录，那里有所有这些信息。

这是文件所在的地方。

所以把它复制到你的剪贴板，确保你有冒号加斜杠的文件，然后是你的文件名。

让我们复制这个并确保它有效。

在我们填写其他两个之前，现在，您必须运行 AWS configure，在您做这个练习之前，您应该已经指定了一个访问密钥 ID secret 访问密钥。

您所在的地区必须与我们现在尝试部署实例的地区相同。

所以我的都很好。

让我们粘贴这个命令并运行它。

这看起来很成功。

我们可以看到，我们有一个实例正在美国东部 one a 中运行。

如果你按空格键，向下翻页，会有很多信息。

让我们进入 ec2，检查它是否在 82 年启动，我可以看到底部的这个实例正在运行。

现在我将把这个标记为 public one a，这样我就知道它是哪一个了。

现在，我们需要做的下一件事是回到 VPC 管理控制台，获取 public one，B 的子网 ID，然后回到我们的文件。

我们要用这个。

所以我们能做的就是把这些都复制下来，放在这里。

然后，我将获取这个子网 ID，并在这里覆盖它。

现在，我们应该可以将 one B 发布到 public 中了，让我们将它复制到我们的剪贴板上，然后回来粘贴它。

看起来不错。

如果我在这里刷新页面，我们有这个挂起的实例，这是公共的。

我给它贴个标签，这样我们就知道是哪一个了。

最后，我们将在我们的私有子网中启动该实例。

同样，我只需要获得 private one v 的子网 ID。

所以我把它复制到我的剪贴板上，回来，把它粘贴进去。

现在我们有了指挥权。

这些用户数据应该可以在私有子网中正常运行，因为我们可以通过 NAT 网关连接到互联网。

所以我把这个粘贴进去，回车。

好了，我们应该有另一个实例，回到 easy to，我可以在这里看到我的挂起实例。

所以让我们称之为私人的，一个是伟大的。

我有这些实例，让我们刷新一下，看看我们在哪里。

因此，他们中的一些人正在运行“让我们按名称来看”，这可能会使事情变得简单一些。

我将把 public one a 的公共 IP 复制到我的剪贴板上，并粘贴到浏览器窗口中。

我得到了这个网页。

它给了我子网 ID。

因此它应该与公共子网 a 的子网相对应。

这很好，我们已经证明了我们可以从互联网连接到我们的 EC 实例。

现在，我想做的另一件事是在我的 EC 两个实例之间进行连接，回到控制台，我要做的是连接到公共实例，我使用 EC 两个实例连接。

虽然这只是连接，让我们回来。

接下来，我想获得我的公共 one B 实例的私有 IP 地址。

这是 10，0 到 25。

让我们回到 EC 两个实例连接。

我要 ping 10 点 0.2 点 25。

让我们看看这种反应。

这证明我们在另一个公共子网公共子网 one B 中连接到我们的实例。

所以我们有双向连接，响应也会返回。

那太好了。

最后，让我们检查一下是否可以连接到我们的私有子网。

所以我们来看看私有 IP 地址是什么。

是 10 04148。

所以我们来 ping 10.0 点 4.148。

让我们看看这是否可行。

这样我们就会得到一个 ICMP 响应。

这很好，表明我们已经建立了连接。

我们可以从这里做的另一件事是看看我们是否能连接到那个网页。

因此，我们将使用 curl 命令并指定 10.0 点 4.148，然后按回车键。

我们在这里得到一个响应，表明该实例位于 ID 为的子网中，并为我们提供了子网 ID。

这就是我们网站上 HTML 网页的 h1 标题。

我们可以看到我们有端口 80。

打开，能够连接到私有子网中的实例。

我们还可以由此推断，该实例可以连接到 internet，因为它能够安装 web 服务。

这就是我们目前的连通性测试。

现在，我将让所有这些实例和 NAT 网关保持运行，因为当我们对安全组和网络 ACL 进行一些测试时，我们将回来继续。

伙计们，安全组和网络访问控制列表。

ACL 是我们可以在 AWS 环境中应用的两种不同类型的防火墙。

所以让我们来看看它们是如何工作的。

这里我们有一个带有两个可用性区域的 VPC。

我们有几个公共和私有子网。

我们有几个 EC 实例，它们已经发布到不同的公共子网和私有子网中。

所以让我们看看如何控制交通。

首先，我们可以应用一种叫做网络访问控制列表或网络 ACL 的东西。

现在这些在子网级别得到应用。

因此，您可以看到它们位于子网的边缘。

现在，进出子网的所有流量都将通过网络 ACL。

因此，您实际上是在过滤进出子网的流量。

因此，入口和出口流量、安全组是不同的。

安全组实际上在 EC two 实例的实例级应用，实际上在 EC two 实例的网络接口级应用。

这意味着我们可以将一个安全组应用于不同子网中的 EC 两个实例。

这是同一个安全组安全组 A，它已经应用于几个不同子网中的实例。

请记住，这是实例级别，这意味着它将过滤同一子网或不同子网中实例之间的流量，我们可以将安全组 B 连接到不同的实例。

因此安全组可以应用于任何子网中的实例。

现在，这些安全组发生的事情与网络 ACL 是一样的。

他们在寻找进出安全组的流量。

因此，如果您将流量从安全组 A 中的一个实例发送到安全组 B 中的一个实例，它将检查是否有允许出站流量的规则，然后它将检查此处，安全组 B 将检查我是否允许来自安全组 A 的流量，您可以通过 IP 地址来完成此操作，或者您实际上可以通过安全组本身的 ID 来完成此操作，我们也将在实际操作中详细了解所有这些内容。

现在，我想和您谈谈有状态防火墙和无状态防火墙，因为安全组是有状态防火墙。

网络 ACL 是一种无状态防火墙。

理解两者的区别非常重要。

让我们来看一个例子。

我们这里有个客户。

这是一台想要访问网络服务器上的服务的计算机，我们在中间设置了防火墙。

因此，客户端将连接到服务器，服务器是一个 web 服务器，它正在侦听端口 80。

源端口是电脑分配给连接的端口。

这就是所谓的高编号端口，即大于 1024 的端口。

它是为每个连接动态分配的。

所以我们有一个源端口和一个目的端口。

我们还有一个源 IP 和目的 IP。

现在，返回流量的源端口是端口 80，因为 web 服务端口在那里运行，目的端口是 65188。

当然，IP 也会被切换。

因此，目的 IP 将是客户端，源 IP 将是 web 服务器。

现在，我们在防火墙规则表中需要什么来允许它工作呢？这里我们需要一个 HTTP 规则，允许源 IP 10.1 点 1.1 与目的 IP 10 点 2.1 点 10 通信。

并且必须指定源端口和目的端口。

当然，这是一个动态分配的端口。

所以我们事先不知道那是什么。

因此，这里最有可能出现的是 any so，而不是指定源端口，我们会指定 any，因此任何源端口都是可接受的。

然后，我们可能会有任何来源 IP，而不是特定的来源 IP，因为它是基于互联网的连接。

这些都是我们可以在规则表中摆弄的东西。

但是目的端口总是 80，因为 web 服务器在那里运行。

所以我们要确保不允许连接到 web 服务器上的任何端口。

这是进入 web 服务器的流量。

回去的返程流量怎么办？好吧，在这种情况下，东西互换了。

我们有相同的协议，web 服务器的源 IP，客户端的目的 IP，源端口 80，客户端动态端口的目的端口。

同样，您可能有目的地端口，目的地 IP 是 any，因为如果您运行公共 web 服务，您希望允许来自互联网上任何客户端的流量，但您可能仍然需要为出站流量设置规则。

这就是有状态防火墙和无状态防火墙的区别所在。

因此，状态防火墙将自动允许返回流量。

这就是安全组的含义，也就是说，对于安全组，您只需要这个卷到顶部，您需要一个角色，它说您将允许来自任何客户端的流量通过任何端口，但是您将允许流量进入您的 web 服务器上的端口 80。

然后自动允许返回流量。

所以你不必担心返回流量会自动出去，它会被允许，因为防火墙足够聪明，知道这是连接的一部分。

所以它只允许返回的流量。

现在，状态不太可行检查两个连接的允许规则。

这就是网络 ACL 的作用。

我们有一个网络 ACL，您需要入站规则和出站规则。

因此，您需要确保对进入的流量使用入站规则，对返回的流量使用出站规则。

即使是同一个连接，它也不明白那是同一个连接的一部分，它把它们分开对待。

因此，在配置网络 ACL 时，理解这些差异非常重要。

现在让我们来看看一个安全组。

这就是安全组规则集的样子。

这里我们为入站和出站流量定义了单独的规则，我们在这里看到的是入站流量。

同样，因为它是有状态的，所以我们不需要为返回流量制定规则。

但是我们可能仍然需要一个出站规则来处理从我们的实例发出的流量。

因此，当我们连接到安全组的实例启动出站连接时。

这里我们可以看到，我们有几个使用不同协议的规则。

我们得到了指定端口范围的协议，然后是源。

并且在许多情况下，来源可以是 IP 地址或 IP 地址范围。

或者它也可以是安全组 ID。

安全组仅支持允许规则。

所以在安全组中不存在拒绝规则。

本质上，在规则集的末尾有一个隐含的拒绝规则。

它将检查是否允许，如果不允许，默认情况下，它将拒绝流量。

正如我提到的，一个安全组可以使用一个 IP 地址的来源、一个 IP 地址范围，或者它自己或另一个安全组的安全组 ID。

现在，让我们看看使用安全组时的最佳实践配置。

我们这里有一个公共子网和一个私有子网。

我们有一个面向互联网的负载平衡器。

这将把流量分配到我们的网络服务器上。

因此，我们有一个负载平衡器，我们有一个 web 服务器前端。

这就是用户从互联网上连接的那个。

还有一个将处理数据的应用层。

这可能有多台服务器。

所以我们有一个负载平衡器。

我们需要一个连接，能够从互联网上的客户端连接到应用层，然后它可能会写入数据库。

我没有在这张图中显示出来。

让我们看看如何设置它。

首先，我们为公共 iob 创建一个安全组。

它允许来自互联网上任何来源的 web 服务在端口 80 上的流量。

现在是出站，因为它现在将创建一个到 web 前端的连接。

它的作用是允许出站访问端口 80。

我们已经指定了实际的安全组 ID public easy to。

这就是这个安全组的名字。

因此，它将只允许流量出站到 web 前端，web 前端只允许来自端口 80 上的公共 lb 的流量。

此外，它还有另一个安全组 private lb 的出站流量目的地和端口 8080。

这就是特定应用程序正在监听的内容。

反过来，专用 lb 安全组将只允许从公共 EC 到安全组的入站流量。

并且它将只允许到专用 easy to 安全组的出站流量。

这是一款包含应用层的产品。

这是我们锁定对应用程序不同层的访问的一种方式，确保应用程序可以与其他组件通信，但其他组件不能。

这就是安全组配置的最佳实践。

现在我们来看一下网络 ACL。

您首先会注意到的一件事是，我们有入站和出站规则。

同样，我们有允许和拒绝规则。

因此，使用 NaCl，您可以明确拒绝，这与安全组不同。

请记住，安全组只支持允许规则。

规则按顺序处理。

所以你可以看到它们被编号了。

所以我们通常会给规则编号。

你可能想说你添加的下一个规则是 202 101。

然后 303，101，你可以为你如何分配这些数字制定你自己的过程，但是只要记住它们将按顺序被处理。

现在，关于这一点的重要事实意味着，一旦您实际上达到了允许或拒绝流量的规则，处理就停止了。

因此，如果我们有一个允许规则 100，允许流量，那么即使您有一个拒绝规则，稍后在该特定流量的规则集中，它不会到达那里，它会允许它，因为它到达 DLL，处理完成。

因此，您必须非常小心地设置您的规则，即您创建规则的顺序，并记住它们将按顺序处理，然后当达到允许或拒绝时，处理就结束了，它将允许或拒绝连接。

理论就是这样。

在下一课中，我们将实际操作并设置我们的安全组和网络 ACL。

大家好，在这一课中，我们将使用安全组和网络 ACL。

在本节的前面，我们应该已经运行了一些实例。

因此，您应该在公共子网中运行自由实例，在私有子网中运行一个。

我们要做的是测试安全组和网络 ACL 的各种配置。

现在，在 ec2 中，我需要做的第一件事是转到安全组。

我将创建一个新的安全组。

所以我们有了公共网络。

现在，我们将创建私人应用程序。

因此，这个安全组将被称为私人 dash 应用程序。

我已经描述过了。

让我们为 VPC 选择我的 VPC。

现在，这里的规则是什么？实际上，我将删除我们已经配置的出站规则，我们之前已经为该特定实例提供了 internet 访问权限。

所以我们在安装 web 服务时能够下载 httpd。

但是现在，我将取出出站规则，这意味着从现在开始，它将无法连接到互联网上的入站规则，我想做的是使用 HTTP。

让我们向下滚动，找到 HTTP，这是 web 服务器的协议。

对于 source，我要做的是输入 s，g。

我可以看到我的公共网络访问。

我在这里做了最佳实践，我想做的是确保我们应用程序中的 web 服务器只允许来自前端 web 服务器的连接，即该安全组中面向公众的 web 服务器。

因此，让我们创建安全组。

现在我们需要将它分配给我们的实例。

因此，让我们选择私有一个，B，转到操作，安全，更改安全组。

我们将移除公共网络。

我们将选择“私有应用程序”，单击“添加安全组”，然后单击“保存”。

很好，所以应该设置正确。

现在，我想做的第一件事是测试对我们前端安全组的访问。

我要做的是转到安全组，选择公共 web 安全组。

在入站规则下，我将编辑入站规则。

我想做的是改变所有的交通。

同样，我们将只选择 HTTP。

我们将删除任何来源，并指定我的 IP。

所以它会获取我的 IP 地址。

这意味着我将能够通过互联网连接到这个特定的网络服务。

现在，我实际上正在使用 VPN，我们马上就要对其进行更改。

所以，如果你能访问 VPN，你也能做到这一点。

否则，这可能有点困难，除非你有多个公共 IP。

但我还是想给你们展示一下这个概念。

因此，让我们保存这条规则，回到实例，采用公共 IP 地址。

在浏览器中，我们只需按回车键。

这看起来很棒。

所以我可以访问这个实例。

现在，我要做的是进入并在这里更改我的 VPN。

所以我在连接不同的服务。

这意味着我现在有了一个不同的 IP。

所以让我们刷新页面。

现在你看不到任何事情发生。

但是，如果您在顶部的浏览器栏中查找，我们可以看到我们正在尝试连接，这就是安全组的情况。

当您无法连接时，它会挂起一段时间，最终会超时。

所以这绝对有效。

我们现在无法访问该实例。

如果我回到安全组，我宁愿选择我的公共 web 安全组编辑入站规则。

相反，我将把它改为任何 ipv4，因为这是一个 web 服务。

所以我们希望互联网上的任何人都能够连接。

所以我们还是保留这条规则吧。

回到这里，它无法连接，让我们刷新。

现在我们又回来了。

所以这是一个很好的配置。

现在我们的 web 服务只允许来自互联网的 HTTP。

然后，由于我们之前设置的安全组规则，它应该能够转发到应用程序服务。

让我们来测试这一层。

现在回到 ec2，让我们来看看实例。

这里我想做的是连接到我的公共实例，通过实例，连接。

我将检查我的私有子网中实例的私有 IP 地址。

那就是 10 04148。

我刚刚注意到我们在这里做的一件事，我们必须确保安全，所以我们把自己锁在外面了。

现在如果你点击这里的注释，它会把你带到一篇文章。

我们可以看到，我们实际上需要 IP 地址的端口 22 来访问该实例。

让我们回过头来，将其设置为安全配置。

回到安全组，我们需要做的是转到公共网站，编辑入站规则，添加规则。

而这个可以是宋承宪。

我们在这里要做的是添加任何互联网地址，因为我可能会多次更改我的互联网地址。

否则，当然，你可以使用我的 IP，或者有一个你信任的地址范围，这将是一个更安全的配置。

但是现在我们将改变 IP。

所以我很高兴把它公开。

所以让我们保留那些规则。

现在，让我们尝试并重试此实例连接，我们成功了。

因此，我想尝试和测试的方法是使用 curl dash s 连接到我们的 AP 层，然后放入 IP 10 04 dash 148。

让我们按回车键，我们得到一个响应。

那太好了。

请记住，我们没有来自该安全组的出站规则。

因此，响应流量返回纯粹是因为这是一个状态防火墙。

这就是安全组的内容。

让我们继续，看看如何将网络 ACL 配置回 VPC 管理控制台。

让我们转到网络 ACL。

我们将看到已经有了网络 ACL。

所以我们为我们的 VPC 定制了一个。

现在我们进去看看配置。

我们有入站规则，规则编号为 100，允许所有流量入站。

最后，我们有一个否认规则。

所以记住，这些是按顺序处理的。

所以在这种情况下，由于 allow 规则，一切都被允许。

所以拒绝规则不会被处理。

出站，我们得到了完全相同的东西。

让我们尝试一下，我要做的是编辑入站规则。

我要添加一条规则。

我要一对一地解决这个问题。

我要做的是指定 HTTP source 将是我的 IP 地址。

所以我知道此刻我的 IP 地址是这个。

所以我用斜线 32 表示完全匹配。

我将点击“拒绝”。

因此，我将拒绝从这个特定的 IP 地址访问 http。

你觉得这会有用吗？希望您意识到这里有一个错误，但是让我们保存更改。

我们去看看。

回来也很容易。

我将复制我的实例的公共 IP，转到一个新的网页，按 Enter 键，我就可以访问了。

所以当然，那没用。

现在我们去看看为什么。

回到 VPC 管理控制台，让我们为网络 ACL 编辑这些规则。

如您所知，规则是按顺序处理的。

所以我们在这里有一个拒绝规则，在允许之后，允许允许一切。

所以实际上，这是行不通的。

让我们把它改为 99 按规则顺序排序。

现在我们有了一个明确的否认和允许。

所以本质上，它将检查规则集，它将看到流量从这个特定的 IP 进入端口 80，并拒绝它。

因此，我们从来没有达到这种特定流量的警报规则。

所以让我们保存更改。

所以我们现在就去测试一下。

但是，对于安全组规则，您只需要了解一件事，当您应用它们时，它们实际上会立即生效，网络 ACL 可能会有一点延迟。

因此，如果您发现您仍然可以访问您的实例，那么这可能只是因为您有点太快了。

所以给它几分钟，再试一次。

我们应该会发现，我们确实在这里的浏览器窗口中被拒绝。

让我们粘贴我们的 IP 地址。

果然，它看起来像是挂着的。

所以这显然行不通。

现在，如果我更改我的 IP 地址，那么这次我可以非常快速地更改到不同的地方，这次，连接确实更改了，并且允许我进入。

所以有时网络 ACL 规则应用得非常快。

有时会有一点延迟。

所以它真的可以变化。

这向您展示了如何对网络 ACL 使用拒绝规则。

现在我要回来清理这条规则。

所以我不想在我的网络 ACL 中有任何拒绝规则。

因此，让我们从入站规则中删除该规则，并保存更改。

现在，我们可以清理一些东西，以确保我们不会收到任何账单。

首先，让我们去我们的 Nat 网关，这些可能要花钱。

所以让我们删除这个 Nat 网关。

那已经过去了。

不要忘记，您还需要确保弹性 IP 也已从您的帐户中删除，现在我希望保留一个公共实例和一个私有实例。

但我可以终止另一个公共实例。

现在，我们将实际使用命令行来执行此操作，我只想向您展示另一个 ci 命令。

回到我们的文件中，我们可以为我们的 DC 两个实例指定值。

所以我这里只有一个。

所以我要用引号把它括起来。

复制这个命令，回到我的命令行，让我们试着终止这个实例。

当您这样做时，您会看到当前状态是正在关闭，而之前的状态是正在运行。

所以我们现在知道我们的 ec2 实例被终止了。

这就是目前的情况，但请让其他两个实例继续运行，因为我们将在后续课程中使用它们。

大家好，欢迎来到本课。

在很多情况下，我们可能希望能够使用 ipv4 或 ipv6 将运行在不同 v PCs 上的机器连接在一起。

例如，我们可能有两台虚拟个人电脑，它们可能在同一个区域。

它可能在不同的地区，甚至是不同的帐户。

我们希望这两台 v PCs 中的两个简单实例能够使用私有 ipv4 地址或 ipv6 地址进行通信。

现在，我们可以使用 VPC 对等技术。

VPC 对等允许在这些虚拟机之间内部路由这些地址。

当我说在内部时，我的意思是，它不会出去到互联网上。

它使用 AWS 全球网络来路由 VPC 之间的流量，因此它永远不会接触到互联网。

当它在地区之间移动时，它会被加密，并且它使用私有 ipv4 和 ipv6 地址。

因此，对于许多使用案例来说，这是一项伟大的技术。

让我们看看如何使用 VPC 对等。

假设我们有一个 VPC，这是 VPC a，然后我们有另一个 VPC，VPC B，我们希望能够在这两者之间路由连接。

因此，我们得到了两个简单的实例，可能是 RDS 数据库，甚至是 lambda 函数，任何在 VPC 内部通信的东西，我们希望能够使用私有 ipv4 地址将这些资源连接在一起。

因此，我们可以在这两台虚拟 PC 之间建立 VPC 对等连接。

因此，这将启用使用私有 ipv4 地址或 ipv6 地址的路由。

现在，我们的副总裁 C 的苹果酒块不能重叠。

因此，当你选择苹果酒块来使用你的 VP C 时，这是一个非常重要的考虑因素。

因为即使他们在不同的账户，你可能有一天会想把你的副总裁们连在一起。

如果他们有相同的苹果酒块或苹果酒块互相重叠，那就不行了。

所以你必须有不重叠的苹果酒块。

如果我们有另一个 VPC、VPC 和 VPC，第四个呢？所以他们都有自己的苹果酒街区，所以看起来不错。

我们绝对可以在这两者之间建立 VPC 对等。

我们要做的是在 BBC a 和 VPC c 之间、VPC B 和 VPC D 之间建立 VPC 对等连接，然后与 VBC C 和 BBC D 建立对等连接

因此，我们现在已经建立了四个对等连接。

但是 VPC 对等的问题是它不支持传递对等。

这意味着，假设我们有资源和 VPC a，它与 VPC B 有对等连接

然后，VPC B 与 VPC D 建立了对等连接

那么这是否意味着 bpca 可以与 VPC d 中的资源进行通信？通过 VPC B 号线。哦，不行。

可传递路由不起作用。

因此，我们实际需要做的是再建立两个对等连接。

我们现在已经有了 A 和 D 之间以及 B 和 c 之间的对等连接。

因此，我们得到了一个全网状拓扑。

因为 VPC 对等不支持传递关系。

我们确实需要这个完整的网格。

所以这就变成了相当多的联系。

现在有了这四个 v PCs，还不算太差。

但是你可以想象一下，如果你把它分散到更多的虚拟 pc 机上，很快这种全网状拓扑就意味着你要建立和管理大量的连接。

所以它变得有点笨拙。

还有其他解决方案，我们将在本节的后面部分和接下来的部分中讨论。

正如我之前提到的，副总裁 C 可以在不同的客户中，也可以在不同的地区。

现在，让我们更详细地了解一下我们是如何设置的。

我们有区域一和区域二。

在本例中，我们得到了两个不同地区的虚拟个人电脑，它们可能在同一个帐户中，也可能在不同的帐户中，我们希望将它们配对在一起。

现在他们每个人都有自己的苹果酒块，这是独一无二的，他们没有重叠，所以这很好。

然后我们有了一些子网。

现在，这些子网可能是私有子网，也可能是公共子网。

因为请记住，它是实例的私有地址，将用于 VPC 到 VPC 的通信。

我们已经在这些子网中运行了一些实例。

现在我显示 public，因为我们将设置一个与此非常相似的实验室，如果它们位于公共子网中，我们可以更轻松地连接到我们的 EC 两个实例。

因此，我们创建了一个 VPC 对等连接。

我将在控制台中向您展示如何做到这一点。

现在，我们需要做的下一件事是建立我们的安全组。

假设我们想使用 ICMP 协议从一个实例向另一个实例发送 ping 请求，然后再从另一个实例返回。

嗯，这样的话，我们也必须建立一个安全组规则。

我们可以用其他地区的苹果酒。

因此，我们可以使用苹果酒块作为来源，并说来自苹果酒块的任何内容都将基于此规则被允许。

现在，我们还必须设置路由表。

我们所做的是我们有一条目的地路线，这条路线通往遥远的 VPC 的苹果酒街区。

我们指定对等 ID，当我们设置对等连接时，它将有一个对等 ID，我们将把它指定为目标。

然后，我们在另一端进行相反的操作，这样路由表会将任何目的地为该 cider 块的流量发送到对等连接，然后它被路由到正确的 VPC。

大家好，在这一课中，我们将在两个不同帐户的两台虚拟电脑之间创建一个 VPC 对等连接。

因此，配置将与我们在屏幕上看到的非常相似，我们有 AWS 组织中的管理帐户和生产帐户。

我们要用这些苹果酒块在每一个里面放一个 VPC。

然后我们将创建安全组。

我们将详细说明这些特殊的规则。

现在，首先，让我们看看如何建立连接，我们需要在 VP C 之间建立对等连接，我们可以在控制台中完成。

然后，我们需要更新路由表，这非常重要，因为您有到达目标的路由。

因此，这个 VPC 的路由表必须指定另一个 VPC 的 cider 块和配对目标作为目的地，反之亦然。

在右手边。

我们的安全组规则将确保我们可以使用 SSH 和 ICMP 进行连接，我们测试连接的方式是使用私有 IP 地址从一个实例 ping 另一个实例，这将向我们显示我们使用的是 VPC 对等连接，而不是互联网。

现在，在我们开始之前，您需要做一些背景工作。

因此，除非您想在生产帐户中使用默认的 VPC，否则您应该使用我刚才展示的相同范围创建一个新的 VPC。

因此，从 VP C 管理控制台，您需要切换到 DCT 生产，转到您的副总裁那里，然后创建一个 VPC。

现在我已经创建了我的，我有你的值在一个文件中。

所以只要打开代码亚马逊 VPC，自定义 VPC 破折号生产文件，这是你需要的信息。

您知道如何做到这一点，您在本节前面已经做到了。

因此，只需创建这个 VPC 并添加子网。

添加您的互联网网关，您的私有路由表，然后我们就可以开始了。

现在，在这个特定的练习中，我们不需要所有这些，但让我们根据管理帐户中的 VPC 创建标准子网，然后我们可能会在以后使用其中的一些子网。

所以让我们开始吧。

现在我需要一些信息。

在我的产品计数中选择了我的 VPC。

我将复制这个所有者 ID，也就是帐户 ID，并将其放入我的文件中。

接下来，我需要 VPC 的身份证，让我们把它放在文件中。

现在，我们将切换回管理帐户。

让我们转到对等连接创建对等连接。

我们需要给它一个名字。

姑且称之为我的同行吧。

选择当地的 VPC，这是我的 VPC。我们可以选择另一个帐户，而不是我的帐户，并复制此帐户 ID。

我们会把它粘贴进去。

我们将坚持使用同一个区域，但是我们也需要另一端的 VPC ID。

这就是我们复制到这里的。

因此，让我们将其复制到剪贴板，粘贴并创建对等连接。

这里显示了一个 VPC 对等连接，PC x，然后它将编号我的对等已被请求，远程 VPC 的所有者必须接受对等连接。

所以让我们回去做那件事。

让我们转到 DCC 生产，转到对等连接，我们可以看到请求等待接受。

因此，只需在左侧选择它，然后转到操作接受请求。

我们可以接受这个。

就这样了。

现在，我们需要测试的一个东西是一个简单的实例。

因此，让我们推出一个简单的实例。

但是，在我们实际发布该产品之前，我将创建一个安全组，该安全组将被命名为“VPC 配对破折号产品”。

这些是我们将要建立的规则。

因此，让我们创建一个安全组。

给它起个名字。

我刚刚也在描述中提到了。

选择正确的 VPC，出站规则就可以了。

暂时如此。

我们所需要的是建立入站规则。

我要设置的第一个规则是 ICMP ipv4。

因此，所有允许 ping 请求的 ICMP 都将来自 10.0 点 0.0 斜线 16。

下一行是 SSH，您可以自定义 TCP 并输入端口范围，或者选择 SSH，它会为您完成。

和上面的一样，我们只是想给它相同的地址。

因此，这应该允许来自管理帐户中其他帐户的 VPC 的入站连接使用整个 cider 块中的任何 IP 地址。

这样我们就可以拯救安全组。

现在让我们启动一个使用该安全组的实例。

我将启动一个实例，从 Linux 到 ami，从 T 到 micro，确保选择您的 VPC，我将把它放入我的公共子网 public one a

让我们单击下一步，转到安全组。

我们将选择一个安全组。

这将是 VPC 同行产品，点击审查和发布和发布。

如果你没有这个区域的密钥对，我在这个阶段没有，那么我将创建一个新的。

我称之为 prod dash 和 V，或者下载那个密钥对，然后启动我的实例。

现在，让我们回到城市管理控制台中的管理帐户。

在管理帐户中，我们需要设置该安全组，并将其分配给公共子网中的一个实例。

在此帐户中，我们有两个实例正在运行，让我们转到安全组创建一个安全组。

它叫 VPC，对达什 MGMT。

我会把同样的描述，选择正确的 VPC。

然后让我们添加和以前一样的规则。

这一次，块将是 10.1 点 0.0 斜线 16。

现在，我们已经指定了相同的协议，因此我们也应该能够使用这些协议从生产 VPC 连接到管理 VPC。

因此，让我们创建安全组。

返回实例 public one a actions security，更改安全组。

我们将加入 VPC 搭档达什·MGMT。

我不打算删除公共 web 的原因是，我们在其中有一个角色，允许从互联网访问端口 22，例如，我们需要 connect。

添加这两个选项后，我们来保存安全组配置。

我们最不想忘记的是路由表。

所以让我们去做吧。

现在。

回到我的管理帐户的 VPC 控制台，我将转到我的主路由表，选择路由，编辑，添加，这将是 10.1 点 0.0 斜线 16。

它将通过对等连接。

我们只有一双，叫做我的那双。

因此，让我们将切换保存到 DCT 生产帐户。

我们需要选择主路由表。

我没有给这个贴标签。

让我们现在就做吧。

但我看到它连着我的 VPC。

因此，让我们转到路线，编辑路线，添加。

而这个应该是 10.0 点 0.0 斜线 16 的。

同样，我们将指定对等连接，它将看到相同的对等连接，我们可以保存更改。

就这样了，希望都准备好了。

现在我们已经更新了路由表。

我们有这两个带有规则的安全组，因此我们应该能够基于我们的私有 IP 地址使用这些协议。

这是真正的测试区域，使用私有 IP 地址来查看我们是否可以连接，如果我们正确设置了安全组规则，我们肯定可以通过公共 IP 执行 ping 操作，但我们希望通过私有 IP 来执行，因为这表明我们不是通过互联网网关，而是通过对等连接停留在私有空间内，回到 easy to，让我们选择实例 ID，我们希望复制私有 IP 地址，我将把它放入我的文件中。

回到这里，让我们切换到管理帐户。

选择公共的一个实例，按实例连接。

让我试着记住这个 IP 10 11221。

让我们将 10.1 乘以 1.2，然后回车。

就这样，我们得到了回应。

那是跨账户的。

而且也是跨地区的。

这表明我们在这两台虚拟电脑之间实现了双向通信。

我们启用的另一个协议是 SSH。

因此，让我们确保我们可以创建一个 10.1 点 1.2 对 1 的 SSH 连接。

我们现在可以我不打算登录，因为我需要我的密钥对。

我还需要详细说明一些细节。

但我只想看到端口是打开的。

这表明安全组以及底层网络设置正确，允许此流量通过私有 IP 地址。

这就是这节课的全部内容。

现在，您可能想做的另一件事是，您可以通过做同样的事情来练习，并将此配置扩展到您的私有子网中的实例。

使用您的公共子网实例作为堡垒主机，您可能必须使用代理转发，然后确保您也可以从那里双向连接。

所以这只是一个额外的乐趣，如果你想多练习一点的话。

既然我们已经完成了这个实验，我们实际上可以在私有子网中终止我们的实例。

除非您继续进行配置，否则我们不会在本实验中使用它。

但是我们将暂时让公共实例运行。

所以让我们终止这个实例。

然后，您也应该转到您的生产环境，并在那里终止您的 ec2 实例，然后我们就都清理好了。

你们应该记得，在本课程的前面，我谈到过一些 AWS 服务是私有的，因为它们运行在像 EC 这样的 VPC 中，而其他服务是公共的，因为它们有一个公共端点，例如 Amazon s3。

这意味着当您连接到 Amazon s3 时，您使用一个公共 DNS 名称，因此作为一个公共端点连接到它。

现在，如果您想将一个实例连接到 Amazon s3，但不想使用公共互联网，那么它可能是私有子网中的一个实例。

这就是 VPC 端点的用武之地。

VPC 端点有几个使用案例，私有连接到 s3 就是其中之一。

有两种不同的类型。

有一个 VPC 接口端点和一个 VPC 网关端点，网关端点是我们可以用于 s3 的端点。

和用于其他服务的接口端点略有不同。

让我们从这里开始。

首先，让我们看一个使用 VPC 接口端点的例子。

所以我们让 ac2 运行在一个私有子网中。

我们不希望这个实例有一个公共 IP。

我们不希望它通过 NAT 网关路由到互联网。

因此，我们提供了一个接口端点，这会在子网中产生 EMI。

然后，实例可以通过该 EMI 连接到公共服务，但它使用私有 IP 地址来连接它们。

现在，每个接口端点都可以连接到许多 AWS 服务中的一个。

您也可以连接到 AWS 专用链路供电的服务。

我们很快就会看到这是什么意思。

因此，这是一种我们可以使用私有 IP 地址将 EC 两个实例连接到这些服务的方式。

现在让我们看看它和网关端点之间的区别。

所以在这种情况下，我想连接到 Amazon s3，将数据存储在 s3 桶中。

再说一遍，我不想有一个公共 IP 地址。

因此，在这种情况下，公共子网中的实例位于私有子网中。

我不想提供 NAT 网关，或者至少我不想让这种流量流向互联网。

所以我可以提供一个免费的网关端点。

这个略有不同。

它使用路由表条目。

因此，我们现在必须放置一个路由表条目，将我们的流量指向 s3 网关端点。

并且使用 s3 的前缀列表和网关 ID。

该实例再次使用私有 IP 地址连接到网关端点。

然后从那里，它连接到亚马逊 s3。

现在，您可以使用 Im 策略来保护这一点，以便可以将策略应用到端点。

您还可以应用存储桶策略。

例如，您可以制定一个存储桶策略，限制对来自网关端点的任何流量的访问。

因此，您现在有了一个 bucket，它只接受来自使用 s3 网关端点的实例的流量。

所以让我们简单回顾一下与接口端点的区别。

你有一个弹性网络接口，它有一个带网关端点的私有 IP，你的路由表中有一个网关目标。

因此，接口端点使用 DNS 条目来重定向流量，而网关端点使用路由表中的前缀列表来重定向流量。

现在什么服务好，有相当多的与接口端点 API 网关云形成。

和云手表只是几个例子。

许多公共服务可以通过一个接口端点来访问。

但是网关端点仅限于 Amazon s3 和 dynamodb。

只有对于接口端点，您可以使用安全组来控制流量，而对于网关端点，您可以使用 VPC 端点策略。

最后，让我们看看如何在服务提供商模型中使用它。

所以我的意思是，我们有一个消费者 VPC 和一个服务提供者 VPC。

因此，我们在每个 VPC 中都有几个子网。

服务提供商正在创建一项服务。

并且该服务位于网络负载平衡器之后。

他们想为消费者提供这种服务。

因此，作为消费者，您需要提供一个端点，然后使用该端点来访问服务。

因此，我们实际上是在一端发布服务，然后在左边的 VPC 中消费它，并使用接口端点来实际消费该服务。

这就是它的工作原理。

在下一课中，我们将设置网关端点。

欢迎参加另一个动手练习在本课中，我们将创建一个 VPC 端点，它将成为一个网关端点。

我们将使用一些策略来查看如何控制对 Amazon s3 存储桶的访问。

这基本上是一种配置，我们已经有了一个 VPC 和一个公共子网，并且之前已经有一个实例在其中运行。

现在我们要创建一个 Amazon s3 bucket。

这里我有点超前了，因为我们实际上会在下一节中详细介绍 s3。

如果你对它完全不熟悉，并且你想得到一本入门书，你可以向前翻页，但是我们不会在这里做太多，这将是相当简单的东西。

现在，当我们创建端点时，一条路由将被添加到我们的路由表中。

这将指向一个将解析为 Amazon s3 的 IP 地址的目的地。

现在发生的是，这是一个比任何其他路由更具体的路由，就像通往互联网的路由一样。

因此，它应该遵循这条路径，这意味着任何到 AWS s3 端点的连接都应该通过网关端点进行路由，我们将能够证明这一点，并且我们没有使用公共互联网。

因此，我们将修改这里的策略来做到这一点，您很快就会明白我的意思。

在 s3 存储桶上，我们将添加一个策略。

现在，存储桶策略基本上只是基于资源的策略。

它使用 JSON 语言，就像我们使用 Iam 策略一样，但是我们只是使用它们来控制对我们的 buckets 的访问。

因此，我们将它们直接应用于 bucket，而不是应用于基于身份的策略等原则。

要做的第一件事是去创建 VPC 端点。

我在北弗吉尼亚的管理账户里。

在左侧的“端点”下，我们可以创建一个端点。

让我们点击这个按钮创建端点。

在服务下，如果我们输入 s3 并进行搜索，我们会得到这些选项，我们将选择亚马逊 s3 网关。

现在我们需要指定实际更新哪个路由表。

如您所见，我们的 VPC 路由表中没有自定义路由表。

这是因为我们需要确保指定我们的自定义 VPC。

现在我们可以看到我们的路由表。

我将选择主路由表。

这是与我的公共子网相关联的一个。

现在，默认策略是完全访问。

因此，我们在这里有一个声明，即行动，任何行动明星效应允许，然后任何资源和任何委托人。

所以它非常开放，但是你可以自定义。

让我们创建端点，它已经为我们创建好了。

这是我们的终点。

现在我们要做的是转到路由表，确保路由表已经更新。

这是我们定制 VPC 的主路由表。

在“routes”下，我们现在可以看到我们有了目的地，这是病毒式传播和 VPC 端点。

这就是通过端点到达 Amazon s3 的路径。

这是正确设置的。

我们需要做的另一件事是，我们将从我们的 EC 实例中运行针对 Amazon s3 的命令。

所以我需要给它一些权限，我要创建一个角色。

因此，让我们在 Iam 服务中选择“创建角色”。

常见使用情形将变得很容易，因此我们将允许 EC 调用 AWS 服务来获取权限，只需键入 s3 并进行搜索。

我们将给予完全的访问权。

我将复制此策略的名称。

我们也将使用它作为角色名。

所以让我们把它粘贴进去，创建角色。

现在我们有一个 roll 可以分配给我们的 EC 实例。

在 EC 中，让我们选择实例，转到“操作”、“安全性”、“修改 Iam 角色”,我们将选择一个角色，我们应该会在这里看到它。

这就是亚马逊 s3，完全访问。

现在，让我们保存一个拥有所需权限的实例。

在 Amazon s3 控制台的“服务和存储”下，我们将创建一个 s3 存储区。

因此，桶只是一个容器，我们可以向其中添加对象、文件、视频或任何您想添加的内容。

我将我的测试命名为 DCT VPC 测试，它将位于北弗吉尼亚州，我可以向下滚动，此时无需更改任何其他内容，即可创建此存储桶。

现在我们有了一个桶，我们可以添加一些对象对象，就像我说的，只是文件。

这是一个基于对象的存储系统。

所以我们可以进来添加文件，我只是要添加一些 JPEG 图像并上传。

简单到我们在 Amazon s3 上有一些文件。

现在让我们回到容易选择我们的公共一个实例，去实例连接和连接。

现在我们还没有指定任何策略，但是让我们检查一下我们是否可以连接到 Amazon s3。

现在我们应该能够对 s3 运行命令了。

让我们试着运行 AWS s3 Ls 并按回车键。

我们可以看到我们的存储桶，我们应该能够运行 AWS s3 Ls，然后 s3 冒号斜杠以及我们的存储桶名称。

如果我们在这里点击 enter，我们应该会看到桶中的内容。

所以现在，一切都很好。

现在，我们如何知道这是通过端点，而不是通过互联网，因为我们在一个公共子网？好吧，让我们回到我们的终点。

选择我的端点后，我将选择策略。

我将把这段代码复制到端点策略中，选择“Custom paste it”。

让我们把政策改成拒绝。

所以这应该否定了一切。

现在，如果我们通过互联网，这应该不会有任何不同。

但如果我们要通过端点，这应该会阻止访问。

回到我们的实例，让我们尝试重新运行该命令，但我们得到的是拒绝访问。

让我们尝试运行 ls 命令。

又一次，我们被拒绝了。

所以在我的端点上肯定不行。

我将再次把它改回来，因为我真的不想让它拒绝我访问。

让我们回到完全访问，单击“保存”。

接下来我们要做的是设置我们的存储桶策略。

存储桶策略将阻止除 VPC 端点之外的任何访问。

这是很多考试场景中都会出现的情况。

让我们回到我们的桶里。

转到权限。

转到“bucket policy ”,单击“Edit ”,我将拷贝 bucket AR n。

这就是水桶政策。

因此，在你的代码亚马逊 VPC 目录桶政策 VPC，你需要做的是把这整个 AR n 在这里，只是粘贴你的正确 AR n 在你的桶的顶部。

这里有两个选择。

一个没有斜线号，一个有。

所以有斜杠星的那个表示你也可以查看桶内的对象。

现在我们最不需要的就是 VPC 身份证。

回到我的端点，我将复制端点 ID，然后返回并将其粘贴到我的策略中。

就这样，这个政策现在应该适用了。

现在它做什么？让我们看一看。

这项政策被否决了。

因此，它将拒绝任何原则对这些资源的自由操作，特别是，如果条件不等于这个 VPC 端点 ID，换句话说，如果您不是来自这个 VPC 端点 ID，您将被拒绝。

如果你来自这个 VPC 端点 ID，它就不适用。

所以让我们把这些代码复制到我们的剪贴板上。

回到这里的存储桶策略编辑器，我将全部粘贴进去并保存这些更改。

所以让我们回去，确保我们没有破坏访问。

回到我们的实例，让我们尝试运行 AWS s3 ls 命令，我们会看到我们的存储桶，让我们检查一下我们可以看到我们的存储桶内部并且工作正常。

这很好，因为这个实例来自 VPC 端点。

因此，我们再次证明了我们是通过端点来实现的。

但是我们能做的另一件事是从我们自己的计算机上检查。

我们不应该被允许进入。

回到这里的终端，我将运行 AWS s3 Ls。

我确实看到了水桶。

但是，如果我尝试查看存储桶内部，那么完整的命令是 AWS s3 lS s3 冒号，斜杠斜杠，然后是您的存储桶名称并按 enter。

所以我的访问被拒绝了。

这证明我不能从我的计算机访问这个桶，因为我不是通过端点来的。

现在，让我们回到控制台，看看这里的存储区中的存储区，您可以看到我们不再拥有对此存储区的权限，我们实际上已经将自己锁定在外面，因为我实际上是通过控制台进入这里的，而控制台并没有到达终点。

所以我们需要做的是回到我们的 82 实例。

这一课到此结束，我们已经完成了简单实例，以及带有端点的 VPC 端点，您只需选择端点，转到操作，然后删除端点。

这应该也会清除路由表中的条目。

但是你可以随时去查看，你可能需要刷新页面。

然后就没了。

所以一旦你完成了，终止你的实例。

这一课到此结束。

嗨，伙计们，欢迎来到这一课。

本课是关于 AWS 客户端 VPN 的。

听起来确实如此。

这是一种通过 VPN 连接将客户端计算机连接到 AWS 数据中心和 VPC 的方法。

所以虚拟专用网络连接。

假设你有一台 Windows 或 Mac 或 Linux 的电脑，你可以从那里建立一个客户端连接到 VPC。

这意味着你可以和 VPC 的资源交流。

因此，您可能能够直接使用私有 IP 地址连接到 ec2 实例。

现在，当然，它是一个虚拟的私人网络。

这意味着它也是端到端加密的。

让我们来看看你是如何设置它们的。

这里我们有一个区域。

在那个区域，我们有一个 VPC，我们有几个子网。

现在我们创建一个 VPN 端点。

并且 VPN 端点与子网相关联。

因此客户端 VPN 网络接口是在子网中创建的。

这是 VPN 连接能够与子网中的资源进行通信的方法。

因为在配置到子网中的网络适配器和 VPN 端点之间存在关联，所以我们有一台客户端计算机，它将运行一些 VPN 软件。

VPN 软件不是 AWS 软件。

所以你需要选择一个可用的选项。

在下一课中，我们将使用 open VPN，客户端软件将通过 SSL TLS 与 VPN 端点建立连接。

因此，端口 443 将通过互联网，VPN 端点将实际执行源地址转换，从与 VPN 客户端关联的 cider 块转换到与 VPC 关联的 cider 块。

在客户端，如果查看您的路由表，您可以在 Windows 上运行 route print 命令，然后您会看到您的路由表，您将能够看到 VPC 的 cider 块的目的地和指向 VPN 端点的网关。

这就是我们的客户端 VPN 工作原理。

同样，这是从您的计算机通过互联网进行的加密连接。

这样，您的计算机就能够使用私有 IP 地址与 VPC 子网中的实例进行通信。

这就是它的工作原理。

在下一课中，我们将使用 Amazon workspaces 上的 Windows 客户端和 VPN 端点来设置此功能。

伙计们，我们可以在 AWS 中建立的另一种类型的 VPN 是站点到站点 VPN。

因此，站点到站点 VPN 是您可以连接到 AWS 的地方，例如，客户数据中心或办公室位置，并在互联网上建立一个专用网络。

因此，一个加密的连接，然后你可以通过你的流量隧道，同样，使用内部 IP 地址专用 IP 地址。

所以设置看起来像这样。

左边是 AWS VPC。

在右侧，我们有一个企业数据中心，可以是数据中心或办公室，您需要将其连接到 AWS。

所以 AWS VPN 是托管的 IPsec VPN。

我们所做的是创建一个虚拟专用网关，也称为 VG W。

在 AWS 端，VG W 部署在 AWS 上，然后部署客户网关。

在客户端，当您拥有这两个组件时，您就可以通过 internet 建立一个加密的 VPN 连接。

VPN 连接支持静态路由或 BGP 对等和路由。

因此，在我们的路由表中，我们实际上可以为公司数据中心的 cider 块指定一个目的地，然后将它指向一个虚拟网关 ID。

这就是这个装置。

因此，这意味着任何流向该 IP 范围的流量都将通过 VPN 连接发送。

所以这很简单。

最常见的使用案例是我们在这里看到的，它在数据中心或办公地点连接到 AWS，这样您就可以使用互联网通过加密连接传输流量。

它有时也可以用作直接连接的备用连接。

我们将在这一部分的后面讨论这个问题。

这就是我现在想介绍的所有理论。

在下一课中，我们将从实际出发，做一个实验，设置 VPN 连接。

AWS VPN cloud hub 实际上不是一项可以在 AWS 控制台中找到的服务。

这实际上是一种模式和架构模式，您可以在利用 AWS 站点到站点 VPN 技术时使用。

因此，让我们来看看您可以在其中实施云中心的架构。

所以我们有了一个 VPC。

我们已经实现了一个虚拟专用网关。

这显然是部署在 AWS 端。

然后我们有多个客户办公室，或者这些可能是客户数据中心。

但是在我们希望使用虚拟专用网络连接到 AWS 的本地环境中，它们是不同的。

现在，我们在云中心拓扑中连接它们的方式是使用中心辐射模型。

换句话说，AWS 是枢纽，是 VPC。

然后轮辐延伸到每个办公室。

所以我们要做的是在每个办公室部署一个客户网关。

每个客户网关都有一个唯一的 BGP ASN，这是一个边界网关协议自治系统号。

所以 BGP 是一种协议，你可以用它来通告到你的网络的不同部分的路由。

每个环境都有自己的 ASN。

这对应于将被通告到网络中的路由，即 IP 前缀，因此每个办公室必须有一个唯一的 BGP ASN。

然后，我们可以在每个客户网关和 AWS 端的同一个虚拟网关之间建立 VPN 连接。

现在，网络流量可以从办公室发出，然后到达 VPC 或 VPC，再回到办公室。

此外，它还可以在客户办公室或客户的内部环境(无论是办公室还是数据中心)之间传输。

因此，这里的客户办公室可以通过 VG W 进行通信。

所以这个海关办公室。

因此，我们使用 AWS 站点到站点 VPN 来建立路由拓扑，连接多个客户办公室以及 VPC 本身。

现在，它使用的是 IPsec VPN，与我们在之前的课程中看到的 VPN 相同。

原来如此。

那是 VPN 云集线器。

正如我提到的，如果你在 AWS 控制台中四处寻找，你不会找到 cloud hub。

但是如果你真的在网上搜索，你会找到一些关于这种架构的文章，这可以让你对它是如何设置的有更多的了解。

但基本上，我们只是将多个客户网关连接到一个虚拟专用网关。

然后由您来相应地配置您的 BGP 协议，以通告您想要通告到网络中的路由。

这就是对 cloud hub 的快速概述。

下节课再见。

我们已经讨论过虚拟专用网络连接 VPN。

现在，VPN 通常在公共互联网上运行，这意味着我们会受到互联网上带宽限制和潜在延迟问题的影响，我们无法控制互联网，我们不知道每分钟、每时每刻会发生什么，我们可以获得良好的服务提供商。

但是，有时我们和 AWS 上的服务之间还有很长的路要走。

这意味着在这条路径的某个地方，我们可能会遇到拥塞或延迟。

因此，其中一个解决方案是使用直接连接或 dx dx，这意味着您有一个到 AWS 的私人连接，这意味着它不是共享的，不是公共的，它是专用于您的，它是一个到您的 AWS 数据中心和您的亚马逊 VPC 的连接。

让我们来看看我们是如何设置的。

假设我们有一个 VPC，我们有几个子网。

此外，我们还有公司数据中心，也可以是您的办公室。

现在，中间是一个叫做直接连接位置的地方。

这是两个不同的 AWS 区域。

世界上有很多这样的地方。

因此，在您的设备所在的数据中心，或者您所在城市附近的某个地方，很可能有直接连接的位置。

在直连位置，AWS 有一个机架，因此它们有一个装满自己设备的机架。

然后是客户或合作伙伴框架。

因此，要么您在该数据中心有一个装有某些设备的机架，要么您利用 AWS 合作伙伴。

现在这两个笼子都将有一个路由器。

因此，我们在 AWS 框架上获得了直接连接端点。

在客户或合作伙伴框架中，我们有客户或合作伙伴路由器，您必须使用特定类型的连接器，实际上是为您分配了一个 dx 端口。

然后，您需要在客户或合作伙伴路由器和 AWS 之间进行交叉连接，这样我们就有了一个客户路由器，实际上位于您的数据中心，并在 AWS 中直接连接。

我们可以形成直接连接。

现在，从您的客户路由器，您需要有一个到客户或合作伙伴网络的物理连接。

因此，您可能需要与您当地的 ISP 联系，以便从这一点连接到您的数据中心，除非您碰巧将所有设备都放在直接连接的位置，这种情况经常发生。

从那里，我们有交叉连接到 AWS，然后有物理连接一直到 VPC 所在的 AWS 区域，这是一个物理光纤连接，以每秒 1 GB 或 10 的速度运行。

现在，100 gig 最近刚刚在一些地方发布。

如果你想要更慢的速度，你可以和一个伙伴谈谈，他们可以给你 50 兆比特每秒以上的速度。

所以让我们来看看它的一些好处。

AWS 和您的数据中心或办公室之间有专用连接，您可以获得一致的网络体验，您可以控制网络路径，这不像在互联网上，您不知道发生了什么。

这意味着您可以提高速度，改善延迟，为您的连接获得更好的带宽和吞吐量。

对于许多客户来说，dx 可能相当昂贵。

但对于那些将大量数据从数据中心转移到 AWS 的人来说，这可能是划算的。

现在让我们更深入一层。

这里我们有相同的配置。

您可以在这个盒子底部的公共空间中看到一些 AWS 服务。

那么，我们如何在这条专用线路上提供连接呢？嗯，我们必须创造一种叫做私人 viff 的东西。

Vf 是一个虚拟接口。

私有 viff 是使用虚拟网关连接到同一地区的 VPC 的方式。

因此，有一个虚拟专用网关连接到您的 VPC，专用 viff 将通过 DX 连接将数据发送到您的 VPC 是一个虚拟接口，它使用 802 点一 Q、虚拟局域网 VLANs 以及 BGP 会话。

那么连接到公共空间呢，你不用通过私有 viff 连接到公共 AWS 服务。

相反，您需要一个公共的第五，我们的公共这将允许您连接到任何 AWS 地区的公共空间中的 AWS 服务。

但是不能通过公五连上网。

现在，如果你想连接到同一地区的多台虚拟个人电脑，在这种情况下，你有多个虚拟专用网关和多个专用网关连接到每个 VPC，你也可以创建一个所谓的托管虚拟主机，这意味着你可以与另一个 AWS 帐户共享虚拟主机。

正如我刚才提到的，你可以从 APN 合伙人那里获得较低的速度。

这些是 AWS 合作伙伴网络中的合作伙伴。

这些速度可以从每秒 50 到 500 兆位。100 千兆位也是一些选定位置的特色，这些是 AWS 直连位置。

所以那可能是你现在所在的地方，可能不会在考试中出现，但是，它非常非常新。

考试中非常重要的一点是要记住，dx 连接是不加密的，你不能加密 dx 连接。

因此，您无法选择复选框并在传输过程中启用加密。

它只是不是一个功能。

那么如果你想加密你的流量，你该怎么做呢？那么，您可以在连接之上创建一个 IPsec 站点到站点 VPN。

所以你有你的 dx 连接，你基本上是在那个连接上运行一个 VPN。

所以现在你的流量是私有的，它在你的私有 DNS 连接上，你有延迟和带宽特性。

您还可以使用 VPN 隧道对流量进行加密。

所以记住这一点非常重要，它确实会出现在很多考试题目中。

这就是直接连接的核心理论。

在下一课中，我们将了解另一项名为直连网关的功能。

欢迎来到本课。

在本课中，我将讲述 AWS Direct Connect gateway。

现在，了解 direct connect gateway 优势的最佳方式是看一看我们不使用它的体系结构，以及它会变得有多复杂。

然后，我们将了解何时使用直连网关，以及它如何解决一些问题。

这是一个架构示例，我们没有使用直连网关。

现在我们有多个地区，我们有一个办公室。

我们在世界各地有多个 dx 站点。

我们正在做的是将这些区域中的每一个连接到靠近该区域的一个 dx 位置，然后连接到一个公司办公室。

我们在底部的欧盟中部地区也在做同样的事情，就像我们在美国西部地区一样。

因此，该公司现在有多个位置，他们在这些位置使用 dx 连接到 AWS，然后必须建立一个私有 viff。

并且使用虚拟网关连接到同一个区域中的单个 VPC，我们在第二个区域中也是如此。

现在 dx 是区域性服务。

因此，很明显，该拓扑必须使用多个 DNS 位置，并且还需要区域办公室或长距离、昂贵的链路。

换句话说，这里的这些客户路由器必须要么在一个低物理位置，一个地理位置，并且您有来自欧洲或美国的非常长距离的链路，要么这些是在不同地理区域的多个办公室。

因此，当我们希望开始使用直接连接将我们的办公室连接到多个地区时，这可能会变得非常昂贵和复杂。

现在，我们来看一个使用直连网关的架构。

在这种情况下，我们有相同的两个区域，我们有一个公司办公室和一个 dx 位置。

所以我们现在只能从一个地方连接到我们的办公室。

我们有一个 dx 网关。

然后 DX 网关实际上连接到多个区域，一个专用 Vf 与 DX 网关相关联。

然后 DX 网关与虚拟网关相关联。

在每个区域中，BGP 通过 DX 网关向所有虚拟 PC 通告。

从 DX 网关到这些不同地区的流量通过 AWS 主干网，因此它使用的是 AWS 全球网络的一致网络体验。

现在，网络流量可以从办公室流向任何一个地区，因此任何一个 VPC 都是连通的。

当然，我在这里只展示了两个。

但是可以有许多许多区域连接到一个 dx 网关。

现在，您不能通过 DX 网关将区域流量从一个区域路由到另一个区域，因为它不支持这一功能。

但是您可以使用它从您的公司办公室通过单一的 dx 连接连接到世界上的多个地区。

这就是 x 网关。

如果您是一家全球性公司，但您没有全球办事处，或者您希望在一个办公地点获得全球多个地区的一致网络体验，这是一项非常有用的技术，使用 AWS transit gateway 是一项非常棒的服务。

它被 AWS 描述为云路由器，它使用一个中心集线器将 v PCs 和内部位置连接在一起。

所以让我们来看看这意味着什么。

现在，我想再次向您展示一个没有 AWS transit gateway 的全网状架构，以帮助您理解我们试图解决的问题，因为当我们有大量 VP C 时，在本地位置，情况会变得非常复杂，如果我们使用 VPC 对等，我们建立的对等连接会变得非常复杂。

假设我们再次拥有 VPC A、B、C 和 D，并且我们已经建立了 VPC 对等链路。

如您所知，这里将有相当多的对等链路，我们有六个对等链路，我们必须为虚拟 PC 设置。

随着副总裁人数的增加，事情变得非常复杂。

这里我们有六个 VPC 对等连接，然后我们有一个通过客户网关连接的公司办公室。

那么，我们如何使用点对点 VPN 将公司办公室连接到每一台虚拟个人电脑呢？我们在每个 VPC 都需要一个虚拟网关，然后我们需要从每个 VPC 建立到客户网关的连接。

每个都有自己的加密 IPsec VPN。

所以有站点到站点的 VPN 连接。

这还不包括冗余。

如果您想增加冗余，您需要另一个客户网关，并将 sts VPN 连接的数量加倍。

所以它开始变得超级复杂。

现在让我们看看同样的架构。

但是有中转网关。

在这种情况下，虚拟个人电脑和公司办公室也是如此，我们将中转网关放在中间，它成为连接虚拟个人电脑和内部网络的网络中转中心。

现在我们有了到每个虚拟主机的连接，虚拟主机连接到中转网关。

并且从每个可用性区域中指定一个子网，这样就可以在该可用性区域内为任何其他子网启用路由。

然后我们有客户数据中心，我们有一个带有客户网关的公司办公室，客户网关连接到这里。

仅此而已。

这现在是一项服务，允许我们通过这个云路由器连接到任何一台虚拟个人电脑，tgw。

w 可以连接到 VPN、直连网关、第三方设备以及其他地区和其他帐户的中转网关。

所以让我们来看看它是如何与 x gateway 一起工作的。

在这种情况下，我们的公司办公室有一个客户路由器，我们连接到一个 dx 位置，并使用 dx 网关，而不是使用站点到站点 VPN。

现在，DX 网关已连接到中转网关。

这就是所谓的关联。

然后，我们通过直接连接与公司办公室建立物理连接，我们创建了一种称为运输货车的东西。

这是另一种类型的虚拟接口，专门用于直连网关，当与中转网关相关联时。

因此，transit Vf 仅在您将 dx 网关连接到中转网关时使用。

现在，这种架构支持本地、中转网关和所有连接的虚拟 PC 之间的可传递路由。

可以想象，当您的公司变得更大，并开始在更多地区使用更多 VP C 时，您希望在它们之间建立可传递的配对，这可能会变得非常复杂，transit gateway 将真正解决许多挑战。

这一课到此结束。

下节课再见。

大家好，欢迎来到本课。

我现在要谈谈在亚马逊 VPC 中使用 ipv6 协议。

请记住，我在前面提到过，IP 有两个版本，它们被广泛使用。

其中之一是 ipv4，这是目前最常用的，它已经存在很长时间了。

然后是 ipv6。

现在，ipv6 也已经存在了好几年，但是它还没有被广泛使用。

但这需要随着时间的推移而改变，因为我们的 ipv4 地址越来越少。

因此，我们将看看如何在虚拟 PC 中使用 ipv6。

我们先来看看 IP v4 地址的结构。

所以记住，它是由点分隔的四个数字组成的。

这些数字来自一个八位字节。

这是八个二进制位，要么是 1，要么是 0。

因此，ipv4 地址的长度为 32 位。

现在让我们来看看你得到了多少个地址，你得到了 43 亿个地址，这听起来是一个很大的数字。

你的银行账户里有大量美元。

但是，当需要将地址分配给全世界各种不同的设备时，在一个拥有 70 亿人口的世界中，这远远不够。

几年前，这听起来似乎已经足够了，但很明显，即使在 90 年代，这还不够，现在也还不够。

因此，我们即将用尽这些地址。

并且 Nat 必须被广泛使用。

因此，如果你在一家公司，你的公司内部有 1000 台计算机，那么这些计算机很可能使用 ipv4 地址。

这些都是私人地址。

当他们访问互联网时，他们使用 NAT 设备或某种设备。

这意味着一个公共 IP 地址被用来代表许多许多的电脑。

这是我们必须在 ipv4 中采用的一种变通方法。

有了 ipv6，我们就不用担心这个了。

让我们来看看 ipv6 地址的结构。

这就是 ipv6 的结构。

它还具有网络部分和节点部分。

但它有 128 位长。

所以这是一个非常非常大的数字。

而且它使用十六进制。

而 ipv4 使用点分十进制。

这意味着，与十进制相比，十六进制中可以使用更多的潜在值。

这意味着地址的数量要大得多。

这是您可以从 ipv6 中获得的地址数量。

它绝对是巨大的。

所以从某种角度来看。

顺便说一句，如果你在谷歌上寻找关于 ipv6 地址基数大小的类比，有各种各样奇妙的类比，因为它确实是巨大的。

我喜欢的一点是，地球上的每个原子都有 100 个 ipv6 地址。

这是一个非常非常大的数字，这意味着我们永远不用担心 ipv6 地址用完了。

因此，让我们看看我们需要如何设置我们的 VPC。

我们有一个包含几个子网的 VPC，我们需要一个 ipv4 cider 块。

然后，我们需要为我们的子网分配单独的子网范围。

现在，我们还需要一个 ipv6 cider 块，因此我们已经为此帐户分配了一个。

现在，AWS 将为 VPC 分配一个斜杠 56 ipv6 地址范围，然后您可以在该地址空间内创建您的子网范围。

这些子网变成了斜杠 64 子网。

现在，一个斜杠 64 子网将允许 1800 万万亿个地址。

所以，再一次，这是一个为什么你真的不需要担心你的计算机有多少地址的例子，因为它太大了。

现在，您会注意到在 IP 地址的末尾有两个用红色突出显示的数字。

这是一个十六进制对，其值从 00 到 FF。

这指定了单独的子网。

所以它对于每个子网必须是唯一的。

这意味着您可能会有 256 个子网，其中包含 ipv6 地址块。

每一个都是斜线 64。

所以每一个都将支持 1800 万万亿个地址。

因此，您的 VPC 非常灵活。

现在，我们来看看启用 ipv6 后的路由表，现在我们有了 ipv6 cider 块的本地路由。

对于该范围之外的所有内容，我们都需要一个到互联网网关的路由，就像我们对 ipv4 所做的那样，对于 ipv6，我们有冒号加冒号加零斜杠，指向互联网网关 id。

这意味着任何不在这个范围内的 ipv6 地址都将进入互联网网关。

因此，当我们启用 ipv6 时，我们将确保我们的路由表中有指定的地址。

现在，所有 ipv6 地址都可以公开路由。

这意味着没有网络地址转换。

现在，如果你想的话，你可以使用一种叫做出口专用互联网网关的东西。

现在，这样做的目的是为了只允许使用 ipv6 的出站访问。

这有点像在带有 ipv4 的私有子网中有一个 EC two 实例，然后在公共子网中添加一个 NAT 网关。

这意味着该实例是受保护的，没有人可以直接从 internet 访问它，但它可以出站访问 internet。

这就是仅出口互联网网关的作用。

这就是本主题的全部内容，在下一课中，我们将为我们的 VPC 启用 ipv6。

大家好，在这一课中，你们将了解 VPC 流量日志，然后我们还将设置一个流量日志，看看它是如何工作的，以及实际捕获了哪些数据。

因此，VPC 流量日志可以捕获进出网络接口的 IP 流量信息。

在 VPC 中，数据是使用云观察或亚马逊 s3 存储的。

您可以在不同的级别创建流日志。

因此，在 VPC 级别、子网级别或接口级别，接口级别的服务与连接到 ec2 实例的 ENI 相关联，您可以捕获大量流量，这对故障排除和安全性非常有用。

让我们在 easy to 中创建一个流日志，我还有一个正在运行的实例，如果您没有正在运行的实例，只需启动一个实例，就像我们之前所做的那样，并将其放入您的公共实例(子网)中，它应该有一个公共 IP 地址。

接下来，我们将把数据发送到 cloudwatch 日志中。

在云监控服务中，我将转到日志组，创建日志组，并为自己创建一个日志组，我将它命名为我的子网日志，我可以设置保留设置。

对我来说，让我们把五天，所以五天之后，我不再需要这些数据。

让我们创建日志组。

接下来，我们需要创建一个角色。

因此，流日志服务在身份和访问管理服务中拥有所需的权限，我们将创建一个角色。

所以我们来创建一个角色。

选择“Create role ”,我们将选择“easy to ”,因为我们很快就会修改它，因为它实际上不是承担此角色的服务，我们将直接跳过策略，因为我们将添加一个内联策略。

我将把我的角色称为流日志云观察，我将删除描述并创建此角色。

现在我们来找角色。

在“permissions”下，我们将添加一个内联策略，我们将转到 JSON。

我们在你的代码里有这个 JSON 代码，亚马逊 VPC 目录。

这是 VPC 流量日志。

所以我们要做的就是把这些都复制下来。

如您所见，该服务将获得创建日志组、创建日志流以及记录事件、描述日志组和描述日志流的权限。

复制完成后，我们回来，覆盖所有代码，单击“review ”,为其命名，我就称之为“cloud watch permissions ”,然后创建策略。

现在我们确实需要编辑信任关系，实际上这并不容易。

回到这里，信任策略可以被替换，我们可以在这里复制这段文本。

我们将把它粘贴到写着“EC”的地方，在“亚马逊 aws.com”上加点。

因此，现在能够承担这一角色的服务是 VPC 流日志。

让我们更新信任策略。

就这样，我们现在可以开始创建我们的流日志了。

回到第二步，我只有一个实例在运行。

因此，识别网络接口很容易，我们将在网络接口级别创建流日志。

因此，轻弹到流日志，创建流日志，我就叫它我的流日志。

让我们把它用于所有的流量，以及一分钟的聚合。

所以我们又快又好地得到了一些数据。

无论如何，当我们终止我们的实例时，我们将删除它。

我们将发送云监控日志。

所以我们有了我们的日志组。

让我们找到自己的角色，从心流开始。

所以是流量日志云看。

我们将保留默认格式，然后只创建该流日志。

现在让我们尝试几件事。

我们想发送一些成功的连接。

因此，让我们复制我们的公共 IP，转到此处的一个新窗口并将其放入。

我们现在已经产生了一些 HTTP 流量。

我可能会刷新几次。

如果发送一些流量，我们会被拒绝，这是我们可以做的另一件事。

让我们回到实例，看看这个实例属于哪个安全组。

它实际上有两个。

让我们来看看公共网站，因为我认为它有一些规则，允许来自互联网的某些协议。

是的，我们可以看到 SSH 和 HTTP 规则就在那里。

因此，让我们来编辑入站规则。

我将临时删除我的 SSH 规则并保存。

现在从命令行，我将尝试不带任何参数地对该实例进行 SSH。

这不应该工作，它应该只是不断失败，因为我们没有安全规则允许这一点。

所以基本上它只是产生了一点流量。

因此，我们现在可以做的是转到云观察日志，看看是否有一些数据开始发送到那里。

回到云中。

查看日志，我将选择我的日志组。

让我们看看是否有溪流。

我有一条又快又好的小溪。

现在，如果它还没有出现，不要担心，你可能要等几分钟，它会出现的。

让我们选择我的日志流，看看这里有什么数据。

您可以看到这里有一些条目，我们可以看到一些拒绝。

与此相关的是各种信息，包括弹性网络接口、源和目标 IP 地址，我们有端口号、协议号，我们有各种各样的信息，在您进行的任何分析中都可能有用。

如果您想刷新，可以单击“resume ”,然后您应该会看到随着时间的推移会有更多的数据进来。

这就是我们的情况，我们也收到了相当多的不合格品。

几分钟后，我刷新了我的屏幕。

我们也可以看到一些接受。

所以有很多，我们可以在这里看到端口号，端口 80。

这些都是进入我们网络服务器的成功连接。

原来如此。

那里有大量的数据可以用于各种分析。

了解不同类型的日志非常有用，我们有一个 AWS，其中包含哪些数据，这样您就知道哪些数据可用于故障排除或分析。

这一课到此结束。

我们现在已经完成了 EC 实例，因此我们可以继续删除它。

一旦你终止了你的实例，你就被清理干净了