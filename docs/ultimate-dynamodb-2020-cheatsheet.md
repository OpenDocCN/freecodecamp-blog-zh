# Dynamo DB cheat sheet–2020 AWS 认证开发人员助理认证所需了解的一切

> 原文：<https://www.freecodecamp.org/news/ultimate-dynamodb-2020-cheatsheet/>

云服务的出现改变了我们构建网络应用的方式。这反过来改变了 Web 开发人员的职责。

我们过去常常在一台服务器上将所有东西都构建到一个 web 应用程序中。这包括多种职责，如存储、数据库、身份认证、后台作业、缓存等。

云服务允许我们通过将责任推给这些高度可用、可扩展和持久的云服务来降低我们的 web 应用和 web 服务器的复杂性。

知道如何部署云服务并将其与 web 应用程序集成的 Web 开发人员就是我们所说的**云工程师。**

如果你想在 2020 年成为一名网络开发人员，那么 **AWS 开发人员助理认证**可以帮助你实现最终目标。

要通过 AWS 开发人员助理考试，您需要学习的最重要的 AWS 服务是 DynamoDB。所以我免费发布了我称之为**的*终极版* DynamoDB 备忘单**。你可以在考试当天打印出来，以增加你通过考试的机会。

是 AWS 开发者 AWS Amplify 的倡导者 Nader 建议我免费发布我的整个备忘单。如果不是他，你不会有这个资源。

专门研究 DynamoDB 的 AWS 高级技术专家 Kirk 自愿抽出时间来确保这份备忘单的准确性。这使它从 5 页变成了 8 页长！？？？？？？？？

如果你有推特，请帮我个忙，在 [@dabit3](https://twitter.com/dabit3) 和[@ nosqlnowhow](https://twitter.com/NoSQLKnowHow)发带有#AWSCertified 标签的推特来感谢他们。

让我们继续看备忘单:

## DynamoDB 的基础知识

**DynamoDB** 是一个完全托管的 NoSQL 键/值和文档数据库。

DynamoDB 适用于具有任意数据量的工作负载，这些工作负载**需要可预测的读写性能**以及从大到小以及从大到小的自动扩展。

DynamoDB 可上下扩展，以支持您在调配容量模式下指定的每秒的任意**读写容量。或者，您可以将其设置为按需模式，几乎没有容量规划。**

*   DynamoDB 在一个区域的 3 个 az 中的 SSD 驱动器**上存储了 **3 份数据**。**
*   DynamoDB 最常见的数据类型有 **B** (二进制)、 **N** (数字)和 **S** (字符串)
*   表格由**项**(行)组成，项由**属性**(列)组成

## 读写一致性

DynamoDB 可以设置为在每次调用的基础上支持**最终一致读取**(默认)和**强烈一致读取**。

**最终一致读取**立即返回数据，但数据可能不一致。数据拷贝通常会在 1 秒内保持一致。

**强一致性读取**将总是从主分区读取，因为它总是有最新的副本。数据永远不会不一致，但延迟可能会更高。数据拷贝将保证 1 秒钟的一致性。

## 划分

一个**分区**是 DynamoDB 将你的表分割成更小的数据块。这加快了非常大的表的读取速度。

DynamoDB 自动为以下项目创建分区:

*   每 10 GB 数据或
*   当超过单个分区的 rcu(3000)或 wcu(1000)限制时
*   当 DynamoDB 看到一个热分区模式时，它会分割该分区，试图修复这个问题。

DynamoDB 将尝试**跨分区平均分配**rcu 和 wcu

### 主键设计

主键定义了数据在分区中的存储位置和存储方式

密钥模式可以由两个密钥组成:

*   分区键(PK)也称为**哈希**
*   排序键(SK)也被称为**范围**

> 当使用 AWS DynamoDB API(如 CLI、SDK)时，由于传统原因，它们通过替代名称来引用 PK 和 SK。

主键有两种类型:

*   **简单**主键(仅使用分区键)
*   **复合**主键(同时使用分区和排序键)

键的唯一性如下:

*   创建简单主键时，PK **值可能是唯一的**
*   创建复合主键**时，组合的 PK 和 SK 必须是唯一的**

使用排序键时，分区上的记录按升序逻辑分组。

## 次要索引

DynamoDB 有两种类型的索引:

*   **LSI** -本地二级索引
*   **GSI** -全球二级指数

### LSI -本地二级索引

*   强烈支持**或最终一致性读取**
*   只能用初始表创建(不能修改或删除，除非同时删除表)
*   仅复合
*   每个分区 10GB 或更少
*   与基础表共享能力单位
*   必须与基表共享分区键(PK)。

### GSI -全球次级指数

*   **仅最终一致性**读取(无法提供强一致性)
*   可以随时创建、修改或删除
*   简单和复合
*   可以有任何属性作为主键(PK)或辅键(SK)
*   每个分区没有大小限制
*   有自己的容量设置(不与基表共享)

## 扫描

您的表应该以这样一种方式设计，即您的工作负载主访问模式不使用扫描。总的来说，扫描应该是有节制的，例如对于不频繁的报告。

*   扫描表中的所有项目，然后通过过滤器返回一个或多个项目
*   默认情况下，返回每个项目的所有属性(使用 **ProjectExpression** 进行限制)
*   扫描是连续的，您可以使用**段**和**总段**通过并行扫描来加速扫描
*   扫描可能会很慢，尤其是对于非常大的表，并且很容易消耗您提供的吞吐量。
*   扫描是访问 DynamoDB 中数据的最昂贵的方式之一。

## 询问

*   基于主键值查找项目
*   为了能够查询，表必须有一个组合键
*   默认情况下，查询最终是一致的(使用 **ConsistentRead True** 来改变强一致性)
*   默认情况下，返回查询找到的每个项目的所有属性(使用 **ProjectExpression** 进行限制)
*   默认情况下是升序排序(使用 **ScanIndexForward** 为 False 来反转降序)

## 容量模式

DynamoDB 有两种容量模式，**调配**和**按需**。您可以每 24 小时在这些模式**之间切换一次。**

### 为…提供所需物品（尤指食物）

**Provisioned Throughput Capacity**是允许应用程序每秒从表或索引中读取或写入的最大容量

*   ****调配的**适合可预测或稳定状态的工作负载**
*   ****RCUs** 是读取容量单位**
*   ****WCUs** 是写容量单位**

****您应该使用调配的**容量模式启用自动扩展。在这种模式下，您可以为您希望桌子支持的容量设置下限和上限。DynamoDB 会代表您在这些值之间自动添加和删除容量，并抑制超过上限太久的调用。**

**如果超出了您提供的容量，您将得到一个异常:**provisionedthroughputexceedexception**(节流)**

****节流**是当**请求由于读或写频率高于设定阈值而被阻塞**时。例如，超出设置的供应容量、分区分裂、表/索引容量不匹配。**

### **按需**

 ****按需容量**是按请求付费。所以你只为你所使用的付费。**

*   **按需适用于**新的**或**不可预测的**工作负载**
*   **吞吐量仅受表的默认上限限制(40K RCUs 和 40K WCUs)**
*   ****如果您在 30 分钟内超过先前峰值容量(高水位线)的两倍，节流就会发生**。例如，如果您以前的峰值为 30，000 ops/sec，则不能立即达到 90，000 ops/sec，但可以达到 60，000 ops/sec。**
*   **由于没有硬性限制，根据新出现的场景，**按需可能会变得非常昂贵****

## **计算读取和写入**

### **计算读取次数(RCU)**

****读取容量单位**表示:**

*   **每秒一次非常一致的读取，**
*   **或者每秒两次最终一致的读取，**
*   **对于大小不超过 4 KB 的项目。**

**如何计算**强**的 rcu**

1.  **将数据向上舍入到最接近的 4。**
2.  **将数据除以 4**
3.  **读取次数乘以**

**这里有一个例子:**

*   **每个项目以 40KB 读取 50 次。(40/4) x 50 = 500 个区域协调单位**
*   **每个项目 6KB 读取 10 次。(8/4) x 10 = 20 个区域协调单位**
*   **每个项目 33 次 17KB 读取。(20/4) x 33 = 132 个区域协调单位**

**如何计算**最终**的 rcu**

1.  **将数据向上舍入到最接近的 4。**
2.  **将数据除以 4**
3.  **读取次数乘以**
4.  **将最终数字除以 2**
5.  **向上取最接近的整数**

**这里有一个例子:**

*   **每个项目以 40KB 读取 50 次。(40/4) x 50 / 2 = 250 个区域协调单位**
*   **11 每个项目读取 9KB。(12/4) x 11 / 2 = 17 个区域协调单位**
*   **每个项目读取 14 次，每次 24KB。(24/4) x 14 / 2 = 35 个区域协调单位**

### **计算写入次数(写入次数)**

****写容量单位**表示:**

*   **每秒一次写入，**
*   **对于最大 1 KB 的项目**

**如何计算**写****

1.  **将数据向上舍入到最接近的 1。**
2.  **乘以写入次数**

**这里有一个例子:**

*   **50 次写入，每项 40KB。40x 50 = 2000 wcu**
*   **11 次写入，每个项目 1KB。1 x 11 = 11 个 wcu**
*   **18 次写入，每项 500 字节。1 x 18 = 18 个 wcu**

## **DynamoDB 加速器** 

**DynamoDB 加速器 **(DAX)** 是在集群中运行的 DynamoDB 的**完全管理的内存直写缓存****

*   **读取最终是一致的**
*   **传入的请求平均分布在集群中的所有节点上。**
*   **DAX 可以将读取响应时间减少到**微秒****

### **DAX 非常适合于:**

*   **尽可能最快的响应时间**
*   **更频繁地读取少量项目的应用程序**
*   ****读取密集型应用****

### **DAX 不适合于:**

*   **需要高度一致读取的应用程序**
*   **不需要微秒级读取响应时间的应用**
*   ****写密集型**或不执行太多读活动的应用**
*   **如果你不需要 DAX **考虑使用 elastic cache****

## **DynamoDB 事务**

**DynamoDB 通过 **TransactWriteItems** 和 **TransactGetItems** API 调用支持事务。**

****事务**让您一次查询多个表，是一种全有或全无的方法(所有 API 调用必须成功)。**

## **全局表格**

**DynamoDB 全局表为部署**多区域、多主数据库**提供了一个完全托管的解决方案。**

## **流**

****DynamoDB Streams** 允许您设置一个 Lambda 函数，每次修改表中的数据时触发该函数，以对更改做出反应。**溪流不消耗区域协调单位。****

## **DynamoDB API**

**DynamoDB API 最著名的 CLI 命令: **aws dynamodb <命令>****

****AWS dynamo db*get-item*返回具有给定主键的项目的一组属性。如果没有匹配的条目，那么它不会返回任何数据，响应中也不会有条目元素。****

****AWS dynamo db*put-item*创建一个新项目，或者用新项目替换旧项目。如果指定的表中已经存在与新项具有相同主键的项，则新项将完全替换现有项。****

****AWS dynamo db*update-item***编辑现有项目的属性，或者在表格中添加一个不存在的新项目。**

****AWS dynamo db*batch-get-item*从一个或多个表中返回一个或多个项目的属性。您可以通过主键来标识请求的项目。单次操作可以检索多达 **16 MB 的数据**，其中可以包含多达 **100 个项目**。****

****AWS dynamo db*batch-write-item*在一个或多个表格中放置或删除多个项目。可以写入多达 **16 MB 的数据**，其中可以包含多达 **25 个上传或删除请求**。要写的单个项目可以**大到 400 KB** 。****

****AWS dynamo db*create-table***向你的账户添加新的表格。每个区域中的表名必须是唯一的。**

****AWS dynamodb*update-table***修改给定表的预配吞吐量设置、全局二级索引或 dynamo db 流设置。**

****AWS dynamo db*delete-table*操作删除一个表格及其所有条目。****

****AWS dynamo db*transact-get-items***是一个同步操作，它从单个帐户和区域中的一个或多个表(而不是索引)自动检索多个项目。通话最多可以包含 **25 个对象**。事务**中项目的总大小不能超过 4 MB** 。**

****AWS dynamo db*transact-write-items*一个同步写操作，将多达 **25 个动作请求**分组。这些操作可以针对不同表中的项目，但不能针对不同 AWS 帐户或区域中的项目，并且没有两个操作可以针对同一个项目。****

****aws dynamodb *查询*** 根据主键值查找项目。您可以查询具有复合主键的表或辅助索引。**

****AWS dynamo db*scan*通过访问表或二级索引中的每个项目，返回一个或多个项目和项目属性。****

## **？#火箭消费者**

**我想帮助你进入 web 和云计算行业。这就是为什么我要在 freeCodeCamp YouTube 频道上发布我的**免费** **AWS 开发者助理认证 2020** 课程，其中包含我之前从未发布过的 10 多个小时的额外内容。**

**这个免费的课程将在几天后发布，因为我应用了最后的润色。**

**我相信让全世界都能接受科技教育，因为反过来，我们掌握的技能越多，我们就能越早让人们摆脱贫困，我们就能越早设计出可持续的解决方案来保持地球的绿色和健康，我们就能越早向火星发射火箭。**