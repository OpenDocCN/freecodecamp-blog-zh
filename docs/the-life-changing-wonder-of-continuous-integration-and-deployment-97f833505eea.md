# 持续集成和部署带来的改变生活的奇迹

> 原文：<https://www.freecodecamp.org/news/the-life-changing-wonder-of-continuous-integration-and-deployment-97f833505eea/>

作者:保罗·麦吉瑞

# 持续集成和部署带来的改变生活的奇迹

![z7GtpYx3xFAict2QwozKb49iQFnmC6drcNM3](img/2eece4ee160c09e409054329ce6d94c0.png)

Photo by [Jordan Madrid](https://unsplash.com/photos/yTdb-7MoyvM?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

在[远程](https://remote.online)的第一年左右，我用 [Dreamweaver](http://www.adobe.com/uk/products/dreamweaver.html) 一页一页地拼凑网站。当我完成后，我会通过我的 56k 调制解调器将结果 FTP 到我的主机提供商，并让他们做他们需要做的任何事情，使网站在网络上运行。

我不需要知道它是如何工作的；刚刚成功了。我上传的文件直接覆盖了旧文件。如果我需要改变什么，我也可以直接重写那些文件。如果我犯了一个错误，需要返回，我只能希望我记得最近备份到外部硬盘驱动器，否则我会熬夜！

三、四年前，我们是一个三人团队，在伦敦码头区的 tele house(T1)共同部署我们自己的服务器网络。我们的网站是使用 SQL Server 2000 的数据库驱动的，HTML 是由 ASP 和 VBscript 生成的。当我们升级一个站点时，我们必须记住我们在发布中更改过的文件，并上传这些文件。

过了一段时间，我们学会了为每次升级创建一个新文件夹，这样我们就可以将它用作一个临时站点，直到我们准备好投入使用——然后我们将使用 IIS、域绑定和 DNS 来使临时站点投入使用。

它工作了，但是容易出现各种各样的错误。在上线过程中，我们可能会忘记更改配置文件。或者以前工作的东西会突然停止工作，因为我们在项目中的其他地方做了更改，而我们没有想到要测试网站的这一方面。如果需要快速修复，我们通常会屈服于诱惑，直接将修复上传到实时网站，而不是使用新的暂存文件夹。

我们自己安装、升级和管理服务器。如果服务器中的一个组件坏了，就由我们来修复它。

我记得有一次，我们的一个网络服务器瘫痪了——我打电话给现场的一名工程师，他成了我的眼睛，打开机器，告诉我他能看到什么。我推断是电源坏了，于是上网搜索数据中心附近的计算机供应商店，想找到一家有这种几乎过时的电源的商店(服务器是我们的第一个，它有点过时了)。当我找到一个时，我付钱给一个伦敦的摩托车快递员去取货，然后把它开到数据中心，工程师正在那里等着安装它。在三个非常紧张的小时后，所有网站都恢复了。

再过八年左右，我们团队中有五个人，虚拟服务器已经成为一个可行的提议，考虑到优势，我们一头扎了进去。如果我需要一台新的服务器，我不再需要订购它、安装软件、开车去伦敦，然后自己把它装在机架上(尽管每当我在数据中心工作时，我总是感到非常空间感)。我只需按下我的 [VMWare vCloud Director](https://www.vmware.com/uk/products/vcloud-director.html) 控制台上的几个按钮，20 分钟后，服务器就会启动并准备运行。

如果我需要更多的硬盘空间，这不再意味着当我把机器从机架上拿出来，把硬盘拧紧到位，配置 RAID(可怕的)并希望整个系统再次干净地启动时，我就要停机了。相反，现在我只需点击在线控制台上的几个按钮，快速重启，我就可以使用这个驱动器了。

如果电源出现故障，服务器实例只需将自己移动到多个可用刀片服务器中的另一个，并在几分钟内重新联机。它的操作仍然有点笨拙，我仍然需要管理软件更新，并掌握 CPU、RAM 和磁盘空间等资源，但这是一个巨大的改进。

在这一转变过程中，我们的部署流程没有太大变化。我们对暂存文件夹变得更加警惕。我们没有使用名为“dev”和“live”的文件夹，当我们需要新版本时，这些文件夹会立即变得混乱(“dev 2”或“new live”，后来成为“live final”，live final 2 等)，而是使用发布版本编号来表示文件夹——“v1”、“v1.5”、“v 2”等。这个过程变得更加健壮，随着我们越来越了解如何避免常见的陷阱以保持我们的站点的生存和无错误，但是人为错误仍然是可能的，如果我们要在没有容易出错的捷径的情况下正确地做，做小的更新仍然是一个相当大的操作。

随着我们转向更多的企业级应用和移动应用，我们的部署流程变得更加复杂。在线应用程序需要多个配置文件，移动应用程序有许多构建和部署阶段，需要批处理文件、服务器脚本和各种手动配置才能完成。我们在这些过程中所需要的许多知识都保存在需要这些知识的开发人员的头脑中，我们担心的是，如果这些开发人员离开了，这些知识也会离开。

但是技术以令人眼花缭乱的速度发展，在远程我们喜欢跟上这种速度。

快进到 2017 年，现在是一个由开发人员、设计师和项目经理组成的敏捷团队，该公司从其卑微的开端变得面目全非，云就是一切。我们已经将大部分应用转移到了微软 Azure 上——应用服务的灵活性令人惊讶。我们可以推出一项新服务，告诉它。网，。NET Core、PHP 或我们正在使用的任何风格的代码，并设置我们在 IIS 中设置的常见内容，但形式简单。

我们可以将一个应用程序添加到服务计划中，其中所有应用程序共享分配的内存、CPU 等，在不需要时将资源归还给池。该服务与 Azure SQL 连接，Azure SQL 的行为方式类似，与其池共享资源，并在不需要时减少资源。一个可定制的控制面板提供了所有应用和服务的资源利用率图表，我们可以隔离一项服务，只需几次点击，就可以将它移动到自己的资源池中，无需停机。

如果一个应用程序发现自己的需求比平时更大，Azure 可以“向外扩展”，并实时创建一个新的应用程序副本，根据需要在应用程序的两个、三个、四个或十个副本之间共享访问者流量——当需求再次下降时，副本也会如此。在我睡觉的时候。

我们所有的版本控制都是用 Git 管理的。不再需要在备份中寻找文件的以前版本。我们只是将我们的源代码版本回滚到文件存在的时间，并进行任何必要的更改。新的变更被平滑且容易地与“主”主干合并，通常遵循“拉请求”，在允许加入主源代码之前，对等体可以对新的代码部分进行审查和评论。当代码被提交给主人时，哦，甜蜜的喜悦…

对我来说，持续集成和部署是近年来最令人兴奋的发展。我将我的代码提交给主干，VSTS 意识到代码已经被更改。它立即运行我的任务列表——它获取完整的代码，下载任何相关的 [NuGet](https://www.nuget.org/) 包，构建解决方案，运行我们的单元测试以确保一切都正常，然后一旦一切正常，它将整个项目发布到暂存文件夹并预热，这样当我们第一次访问网站时，我们就不必等待它加载。一旦我们对试运行站点进行了一系列 QA 手动测试，以确保我们对它满意，只需单击一下鼠标就可以交换试运行和生产时段，使我们的新更新上线，而不会给网站访问者带来任何停机时间。以前的生产版本现在处于暂存状态，以防我们需要再次快速回滚。

它很棒，很简单，排除了许多人为错误的可能性，而且速度快得多。对于更复杂的构建，可以将这些脚本和批处理文件编程到部署中——不再需要清单和记忆，只需一个 Git 签入，项目就部署好了。我们对构建如何发生，以及在构建过程中发生了什么有非常详细的控制，并且任务的顺序可以根据我们的需要来改变。感觉我们已经到达了一种技术乌托邦。

当然，设置并不总是完全简单和现成的。例如，使用会话 ID 的在线应用程序将需要重新编码，以使用类似 Azure Redis 缓存的东西来保存这些状态，以便它们可以从多个实例访问，并且在应用服务切换服务器时不会丢失。

在 Azure 中，一切都是不稳定的，保存图像或文档等用户文件的网站需要重新编程，以将这些文件保存在共享的虚拟存储驱动器上，这样当 CD 交换部署插槽时，最新的文件也不会被交换。但是，这很容易做到，好处是巨大的。

在整个开发周期中留在微软堆栈中也有巨大的好处——我们使用 [Visual Studio](https://www.visualstudio.com) 进行开发，并在 [VSTS](https://www.visualstudio.com/team-services/) 托管我们的 Git 库，这也是我们将项目管理流程迁移到的地方，这样我们就可以处理一个问题，将 Git 提交与它相关联，并查看该问题是在哪个版本中发布的，所有这些都在同一个软件中。Pull 请求意味着其他开发人员可以在 Visual Studio 中查看和评论代码，Visual Studio 还可以管理 Git 的 pull 和 commits。我们可以在 Azure 中设置 CI/CD，然后在 VSTS 中对该设置进行更细粒度的更改，这一切都非常快速和透明。

当一个构建完成时，或者更重要的是，当它失败时，我甚至可以得到一个 [Slack](https://slack.com/) 消息；我们为我们处理的每个问题创建一个新的 Git 分支，然后将该分支提交回主干，这样，如果出现问题，我们可以立即从 CI 系统获得反馈，并从客户端获得反馈，客户端可以访问试运行站点——不必再等待两周的正式发布，那时我们必须立即将我们所有的开发分支合并到主站点中——简直是地狱——取而代之的是一个稳定、渐进和安全的部署。客户提供这种即时反馈的能力意味着他们可以看到我们正在进行的项目的哪个部分，并提供早期反馈，这样我们就可以在生命周期的早期实施任何调整。

我们真的感觉到，这种自动化提供了管理这些流程时一直需要的即时性、交互和智能的丰富层，结果是可靠性、速度和质量的巨大改善。我将在以后的文章中更深入地讨论所有这些技术的细节，但是现在，让我们为这个美丽的新世界干杯；我是一个非常快乐的居民。

最初发布于 [remote.online](https://remote.online/journal/the-life-changing-wonder-of-continuous-integration-and-deployment) 。