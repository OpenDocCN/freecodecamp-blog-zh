# 如何设计不烂的 API

> 原文：<https://www.freecodecamp.org/news/https-medium-com-anupcowkur-how-to-design-apis-that-dont-suck-922d864365c9/>

作者:阿努普·考库尔

# 如何设计不烂的 API

![PpQn4XEJRKUxbZac6aO3l0DxVgbhTmZJ7Ccr](img/1e5852ef5a02b592b437062ef4969d9b.png)

其他开发者实际上必须使用你设计的 API。所以别让那些 API 烂了。如果你不想让一群愤怒的程序员半夜拿着火把和干草叉突然出现在你家，你需要正确地设计它们。

以下是我多年来从同事那里学到的一些设计技巧。它们适用于所有类型的 API:开源库、内部 SDK、模块甚至单个类。

### 明确一点

![DSOySAAyesVKzC6ELKzkEp91o6a88RmSBYRl](img/e55e5b5ee25d5482903fe58c7b48b7f2.png)

这可能是最重要的提示。如果你有一个名为`getUser`的方法，它在没有明确说明的情况下导致了一些副作用，这会导致很多问题。

不要在不明确的情况下修改共享的可变状态。如果我调用`getUser`，我希望它只返回一个用户，而不是让`user_id`增加`1`。你也可以考虑使用[不可变数据结构](https://speakerdeck.com/anupcowkur/the-mutable-state-monster-and-how-to-defeat-it)。

在合理的范围内，在方法/类/模块名称中尽可能多地编码行为。不要期望用户去挖掘源代码来发现名字没有揭示的隐藏行为。你以后会省去很多痛苦。

### 保持您的 API 表面积较小

![4KXGTI1YlSKWcRgDnZxKPbSL7ujqj9smEqYG](img/3d122b2526e7025f22c58486e3fb8364.png)

没有人喜欢臃肿的程序。为完成工作而公开的 API 越少，每个人的体验就越好。

真的有人要你想写的这个新 API 吗？你也许可以推迟它，直到它实际上是一个有人想要解决的问题。

在一些像 Android 这样的编程环境中，对应用程序可以拥有的方法总数有硬性限制，所以如果你瞄准这些平台，这可能是你必须记住的事情。

预期实现是造成大量编程时间浪费的原因。练习 [YAGNI](https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it) 。

### 减少样板文件

![9yJ0ghRN0COLWY7IbyQMJsgtpeWKhWhxNdl4](img/249c572f4e3ed89783536e028aba3db9.png)

在内部处理尽可能多的实现细节，以减轻客户的负担。消费者需要做的事情越少，您需要处理的错误就越少。

还有审美的问题。不得不编写样板文件可能会毁掉一个原本非常好的 API，并使消费者代码变得难看。我们都喜欢干净的代码，对吗？让你的用户在使用你的 API 时保持代码简洁和干净。

### 减少依赖性

![rSBUK82V1tiyfrJa6UslDdJKsUdbGV8IqMv7](img/e227f6851e750ee13fe97608ede02c29.png)

尽量让你的代码保持独立。依赖项越多，它在下游消费者代码中引起的潜在问题就越多。

如果你真的想从另一个模块中得到好的功能，试着把它提取出来，只包含你需要的。

代码重用和紧密耦合之间总是一个很好的平衡。你必须做出判断。如果功能很小，可能值得自己重新实现。

### 返回有意义的错误状态

![-RVX-RiOcYT95tqhRYJMnmKwyyYb-QfL830G](img/1508c0fcf64bb59a7ee109e313ce2759.png)

我可以整天抱怨`null`在很多情况下是一个无用的构造。字面意思是*没什么*。

“嘿模块，给我一个用户”

“没有。这里的*没有什么*取而代之”

这给了我关于哪里出了问题以及我能做些什么来改善这种情况的信息。如果我们有一个文档化的方法来表达问题域中的预期错误状态，比如`Error.USER_NOT_CREATED`或`Error.USER_DELETED,`，这给了我更多可操作的数据，并帮助我调试问题。

错误消息也应该遵循相同的准则。*你需要登录才能进行*比*好多了 LOL！出事了。*

### 将例外留给真正例外的情况

![UMLr3G0JKXjEM6ulyGiXurHZu4SL0ojg7YsO](img/7964ac66999f3e1b164202a9950daad8.png)

如果你的语言没有例外，那就欢呼吧！无论如何，函数式语言中的类型及其同类在提供有意义的错误状态方面要好得多。

在 Java 领域，异常往往会被严重滥用。例外是为了处理*真正例外的*案件。真的没想到`getUser`可能找不到用户？别扔个`UserNotFoundException`。请返回正确的错误状态。

然而，如果真的失败了，那么越快失败越好。

正如杰克·沃顿所说:

> 唯一比崩溃的程序更糟糕的事情是它不会崩溃并继续处于不确定的状态

### 记录所有的事情

![r7Hic26NyTbMq9ARW2ysPhyJXu8cua-loJvR](img/2d76e34a11e6c34d78561f90e00e34b9.png)

文档很无聊。而且和很多无聊的事情一样，必不可少。好的文档会拯救你的理智。你可以避免消费者对你的 API 不断提出问题，这一点就非常值得。

良好的文档应包括:

1.  对整个模块及其工作原理的高度概述
2.  Javadocs、Heredocs、Rdocs 或任何它的公共方法和协议
3.  展示如何使用它的示例代码

并非所有的抽象都需要相同级别的文档。例如，一个小类不需要样本代码。

文档也必须是渐进的。如果你有很多问题问同样的事情，你可以把它添加到文档中，供未来的消费者使用。

太多的文档也是浪费时间，因为这是你必须保持更新的另一项资产。如果没有人使用它，它就没有价值。

然而，有重点的和充分的文档总是有帮助的。

### 编写测试

![v5fWTuryjAfWKGSzs9ocX6vY2WTRiEgDtSqz](img/f0502bd7b2ef68366188ea1c31bef4d4.png)

测试是正确性的证明，文档和样本代码合二为一。它们在重构时提供了巨大的价值，并让你在改变事情时充满信心地快速行动。

想要更深入了解您的实现的消费者可以随时阅读测试，以了解更多关于您的代码的意图和内部行为。文档不能捕获一切，这就是测试的用处。

"如果我有测试，为什么还要写文档呢？"你可能会问。冒着使用模糊类比的风险，如果文档是你的 API *、*的*用户手册*，那么测试就是 x *86* 、*操作码指令参考。*

### 让它可测试

![YP5cCfvl-1LjWNiFJwKICv286lVV9Xa86rk-](img/f7c7c21035ba97456e085696e5eaa174.png)

测试你自己的代码是一回事。另一个问题是编写 API，让使用它们的人能够轻松地测试他们的代码。关心测试的开发人员会被 API 吓跑，这使得他们很难在测试用例中模仿/隐藏它们。

在适用的情况下，您可以使用调试和生产版本的配置选项。在持续集成/持续部署环境中，事情通常需要与在生产环境中稍有不同。说明这一点。

### 允许用户选择

![kl9YBnKLsBLCe97pV4YC5buUS7USGSrsRhHJ](img/8abb5533e15f940aaed1fe29474ed0e1.png)

不是每个消费者都想以同样的方式使用你的 API。有些人可能希望它同步。其他人可能更喜欢异步回调、期货、承诺或 Rx 可观。

尽可能让消费者有选择自己想要的东西的能力。你的 API 越容易集成到他们现有的编程和系统环境中，人们就越有可能使用它。

### 不要让用户有太多的选择

![Sozy1eQKs8QRsMuvW0Q6H4Dh65qLLbNSktyz](img/57210c46d36826e6eeacdb40db5aa9e3.png)

不要给消费者太多的选择，以至于最终导致分析瘫痪。总是努力提供合理的默认值。大多数时候，你的 API 会以某种方式被使用。让默认值以这种方式运行。

API 应该鼓励规范的行为。如果这不是 API 契约的一部分，就不要让用户修改模块中的随机状态。如果你揭露了一些怪异的无意行为，你可以放心，总有一天它会被利用，产生不可预见的后果。

固执己见。不要因为给出太多选项而失去重点。平衡适当的意见和适当的灵活性需要实践和经验。当有疑问时，宁可选择少一点。

### 结论

设计 API 是一门艺术。希望这里列出的技巧能帮助你写出更好的代码。我可能错过了很多其他的东西，但是这些对我很有帮助。活到老学到老。

*如果您喜欢，请点击？下面。我注意到了每一个人，我感谢他们中的每一个人。*

如果你想了解更多关于编程的想法，请关注我，这样当我写新帖时你会得到通知。