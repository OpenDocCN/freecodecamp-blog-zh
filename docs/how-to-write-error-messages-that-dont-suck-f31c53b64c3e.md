# 如何写出不烂的错误信息

> 原文：<https://www.freecodecamp.org/news/how-to-write-error-messages-that-dont-suck-f31c53b64c3e/>

贾斯汀·富勒

"出现验证错误。"没错。谢谢！

发布在即；这是需要验证的最后一个更新，我得到了一个错误消息，它就像电梯上的关闭按钮一样有用。

原来它*是*一个验证错误，有点。我给出的输入是重复的。它是有效的，它已经存在了！

知道这些不是很有帮助吗？

事实上，当错误发生时，被告知几件事情是有帮助的。我不需要知道一切。编程的历史在这里对我没有帮助。这个消息应该给我足够的信息来修复这个错误，这样我就可以完成我的工作，回家和我的孩子一起玩。

#### 什么导致了错误？

在 JavaScript 中，错误对象总是具有名称、消息和堆栈属性。该名称为您提供了对错误的一目了然的分类。栈告诉你它发生在哪里。信息？根据一些开发者的说法，你不需要担心这个问题。"堆栈跟踪为您提供了所需的一切."

请不要成为那些开发者中的一员。

#### 有用的错误消息

举起你的右手，把你的左手放在一份“干净代码”上，跟我念。

“我发誓在我的错误消息中包含足够多的细节，以便未来的开发人员能够很容易地确定哪里出错了，以及他们需要做些什么来修复它。”

#### 发生了什么

当一个警察让你靠边停车给你开罚单的时候，上面写的是“不良驾驶”吗？不要！它说你在一个时速 25 英里的学校区域里以 65 英里的时速行驶，你超过了一辆停下来的公共汽车，而且你的车已经四年没有检查过了！当然，你会坐牢，但至少你知道*为什么*。

因此，前面的错误消息不应该是“发生了验证错误”，而应该是:

```
Unable to save model "user" because the property "email" with value "JustinFuller@company.com" already exists.
```

不要使用简单的错误信息“无效选项”,而是使用:

```
The option "update" is not valid. Valid options include "upsert", "get", and "delete".
```

这些更新的错误消息试图帮助我们理解原因，给我们一个解决方案的开始。

#### 它是如何发生的

既然错误描述了到底是哪里出了问题，是时候帮助这个陷入困境的可怜的灵魂开始爬出来了。仔细看。当做得正确的时候，看起来就像你通过预测可能导致这一不幸事件的原因而穿越时间。你会和未来的开发者在一起——也许是你自己——告诉他们一切都很好，你们会一起度过难关。

你将从解释发生了什么开始。

对于任何有先决条件的步骤，比如配置或验证，您可以建议验证该步骤是否已经完成。如果您的错误消息变得很长，不要担心。提供太多信息总比不够好。

我将为之前的一个例子添加更多细节:

```
The option “update” is not valid. Valid options include “upsert”, “get”, and “delete”. If you expected “update” to be an option, you must first export it from the file: "./src/controllers/index.js".
```

现在，您正在预测这可能是如何发生的:开发人员可能只是忘记了导出新选项。该错误成为该步骤的提醒。现在您已经展示了错误的两个可能原因；第一个是可能的输入错误(这里是有效选项)，第二个是配置错误(这里是应该导出的位置)。

React 库在预测错误如何发生方面做得非常好。它们并没有解决每一种边缘情况，但是它们确实为最常见的错误提供了有用的提示。例如，您不能在浏览器中使用函数`reactDom.renderToNodeString()`，因为那里不存在节点流。所以 React 给你一个建议，告诉你它是如何发生的，以及如何修复它:

```
ReactDOMServer.renderToNodeStream(): The streaming API is not available in the browser. Use ReactDOMServer.renderToString() instead.
```

该错误可能有其他原因，但他们猜测最常见的原因是在浏览器中调用了`renderToNodeStream`。

#### 有关数据

在编写错误消息时，你必须记住应用程序很少一次只做一件事。因此，当出现错误时，找到应用程序当时的状态是一个挑战。因此，获取相关数据并将其反馈给开发人员非常重要，这样他们就可以查明原因。

在第一个例子中，我加入了短语:

```
The property “email” with value “JustinFuller@company.com” already exists.
```

这非常有用，但可能不切实际。为数据的每个变化创建自然语言错误可能会花费太多的精力或时间，或者在某些情况下，我们可能会简单地传递我们无法控制的失败，因此剩下的唯一选择是给出一个良好的描述，并包括尽可能多的可以安全打印的相关数据。

选择哪些数据可以安全打印是很棘手的:如果你选择了要包含哪些属性，那么每次有新的属性时，你都要修改列表，或者，更糟糕的是，你忘记了，当需要时它不会出现；另一方面，您可以删除已知不安全的属性，但是这里您冒着添加新属性并忘记将其排除的风险，从而导致敏感数据泄露。你必须运用你的判断力，考虑你的公司规则。您的软件是否处理不应写入非加密目的地的高价值数据或个人数据？不假思索地记录每一个导致错误的对象可能会让你被解雇，而在其他工作中，这是标准的操作程序。所以请运用常识，小心行事！

#### 意外错误

当您不确切知道哪个属性或操作导致了错误时，有两种方法可以包含相关数据。

第一种应该在您希望错误被人类阅读时使用，您将数据直接放在消息中:`An error was received: “Duplicate entry found for user.email”, while upserting user: { “email”: “justinfuller@company.com” }.`这种错误风格有其缺点，就像整个对象被放入错误消息中，可能会被发送到意想不到的地方。然而，如果你知道它是安全的，那么这种风格的优点是给出了关于情况的完整细节。

在其他情况下，您可能不希望数据泄漏到日志文件或 API 响应中。您可以提供一个引用 ID、一个可以在以后手动或自动引用数据的时间戳，或者其他一些属性，以便开发人员能够跟踪导致错误的讨厌的数据点。

#### 预期误差

我会第一个承认我容易犯简单的错误。我输入“upswert”而不是“up sert”；我输入“npm tes”而不是“npm test”。所以当我收到一条错误消息说:

```
Unknown command, "npm tes". Did you mean npm test?
```

当开发人员为此做准备时，他们显然凝视着未来，看到有人会犯这个错误——或者他们只是知道人类容易犯愚蠢的错误。

每当流程中有一个步骤可能会出现可预见的错误时，您就有机会准备清楚的指导，说明哪里出错了以及如何修复它。

#### 解决问题的步骤

对于某些错误，可能会给出错误的解决方案，而不仅仅是报告它的发生。有些时候这很容易，就像之前我们不小心输入了“update”而不是“upsert ”,显示了正确的选项。其他时候，你需要付出更多的努力，给用户足够的信息来纠正他们的错误，就像如果你发现了一个递归依赖，你需要告诉他们循环在哪里，他们必须做什么来消除它。

#### 一个并不糟糕的错误

那么，您想提供有用的错误消息吗？在您编写的下一个错误中，尝试包含发生了什么、它可能是如何发生的、可以安全包含的任何相关数据以及可能有助于解决问题的任何步骤的完整描述。

嗨，我是贾斯汀·富勒。很高兴你看了我的帖子！我需要让你知道，我在这里写的一切都是我自己的观点，并不代表我的雇主。所有代码样本都是我自己的，与美国银行的代码完全无关。

我也很乐意收到您的来信，请随时通过 [LinkedIn](https://www.linkedin.com/in/justin-fuller-8726b2b1/) 、 [Github](https://github.com/justindfuller) 或 [Medium](https://medium.com/@justindanielfuller) 与我联系。再次感谢阅读！