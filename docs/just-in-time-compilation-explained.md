# 及时编译解释

> 原文：<https://www.freecodecamp.org/news/just-in-time-compilation-explained/>

实时编译是一种提高解释程序性能的方法。在执行期间，程序可以被编译成本机代码以提高其性能。它也被称为动态编译。

动态编译比静态编译有一些优势。当运行 Java 或 C#应用程序时，运行时环境可以在应用程序运行时对其进行分析。这允许生成更优化的代码。如果应用程序的行为在运行时发生变化，运行时环境可以重新编译代码。

一些缺点包括启动延迟和运行时编译的开销。为了限制开销，许多 JIT 编译器只编译经常使用的代码路径。

## 概观

传统上有两种方法将源代码转换成可以在平台上运行的形式。静态编译将代码转换成特定平台的语言。解释器直接执行源代码。

JIT 编译试图利用两者的优点。当解释的程序正在运行时，JIT 编译器确定最常用的代码，并将其编译成机器码。根据编译器的不同，这可以在一个方法或一小段代码上完成。

1960 年，J. McCarthy 在一篇关于 LISP 的论文中首次描述了动态编译。

实时编译(JIT)或动态翻译是在程序执行过程中进行的编译。也就是说，在运行时，而不是在执行之前。发生的事情是翻译成机器代码。JIT 的优势在于这样一个事实，即由于编译发生在运行时，JIT 编译器可以访问动态运行时信息，从而能够进行更好的优化(如内联函数)。

理解 JIT 编译很重要的一点是，它会将字节码编译成运行机器的机器代码指令。也就是说，生成的机器码针对运行机器的 CPU 架构进行了优化。

JIT 编译器的一些例子是 Java 中的 JVM (Java 虚拟机)和 C#中的 CLR(公共语言运行时)。

## 历史

最初，编译器负责将高级语言(定义为比汇编语言更高级的语言)转换成目标代码(机器指令)，然后通过链接器链接成可执行文件。

在语言发展的某个阶段，编译器会将高级语言编译成伪代码，然后(由解释器)解释这些伪代码来运行你的程序。这消除了目标代码和可执行程序，并允许这些语言可移植到多种操作系统和硬件平台。Pascal(编译成 P 代码)是第一批；Java 和 C#是最近的例子。最终，术语 P-Code 被字节码所取代，因为大多数伪操作都是一个字节长。

实时(JIT)编译器是运行时解释器的一个特性，它不是每次调用一个方法就解释字节码，而是将字节码编译成运行机器的机器代码指令，然后调用这个目标代码。理想情况下，运行目标代码的效率将克服每次运行时重新编译程序的低效率。

### 典型场景

源代码被完全转换成机器码

### JIT 场景

源代码将被转换成类似汇编语言的结构[用于 C#的 ex IL(中间语言)，用于 java 的字节码]。

只有当应用程序需要时，中间代码才被转换成机器语言。

## **JIT 与非 JIT 对比**

在 JIT 中，不是所有的代码都被转换成机器码。首先，一部分必要的代码将被转换成机器码，然后，如果一个被调用的方法或功能不在机器中，那么它将被转换成机器码，这减轻了 CPU 的负担。由于机器码将在运行时生成，JIT 编译器将生成为运行机器的 CPU 架构而优化的机器码。

JIT 的一些例子有:

*   Java: JVM (Java 虚拟机)
*   C#: CLR(公共语言运行库)
*   Android:较新版本的 DVM (Dalvik 虚拟机)或 ART (Android 运行时)

Java 虚拟机(JVM)执行字节码，并保存一个函数执行次数的计数。如果这个计数超过了预先定义的限制，JIT 将代码编译成处理器可以直接执行的机器语言(与 javac 将代码编译成字节码然后编译成 Java 的正常情况不同，解释器逐行解释这个字节码，将其转换成机器代码并执行)。

此外，下次计算该函数时，将再次执行相同的编译代码，这与逐行解释代码的常规解释不同。这使得执行速度更快。