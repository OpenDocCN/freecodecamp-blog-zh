# 如何使用普通 JavaScript 执行 CRUD 操作

> 原文：<https://www.freecodecamp.org/news/crud-operations-using-vanilla-javascript-cd6ee2feff67/>

作者:扎法尔·萨利姆

现在有很多 JavaScript 框架，比如 React，Angular，Vue 等等。它们都为 web 应用程序的开发提供了一种简单易行的方法，尤其是 SPAs。

然而，许多 JavaScript 学习者倾向于开始学习这些框架，对如何用普通 JavaScript 开发类似的应用程序知之甚少。

任何应用程序中最基本的操作之一就是 CRUD(代表创建、读取、更新、删除)。这是我们今天要实现的目标。我们将举一个基本的老例子:一个 Todo 应用程序。

尽管本教程将使用普通的 JavaScript，但我们将使用 ES6 语法，而不是普通的旧 JavaScript 语法。为了实现这一点，我们将使用 babel transpiler 将 ES6/ES7 转换为 ES5，并且我们将使用 webpack 作为构建工具。

我假设您的计算机上已经安装了 node.js 的最新版本。设置我们的环境将需要一些额外的时间，所以没有必要进入这些细节。简单地从这里克隆我的样板代码([https://github.com/zafar-saleem/hut](https://github.com/zafar-saleem/hut))并运行“npm install”来安装所有的依赖项。

新文件将放入/src 文件夹中。因此，在/src/scripts/文件夹中创建一个名为 Todo.js 的新文件，并将以下代码写入该文件。

正如你在上面的代码中看到的，我们正在创建一个 Todo 类，在这个类中我们正在编写一个构造函数。尽管 JavaScript 默认没有类，但是 ES6 有类(实际上，是 JavaScript 原型之上的语法糖)。

现在，当我们使用 new 关键字创建这个类的新实例时，将自动调用构造函数。在这里，我们将向 Todo 类添加一些属性，我们将能够使用关键字 **this** 在整个类中访问这些属性。

现在我们有了上面的代码，继续将上面的文件导入到 src/index.js 文件中，并创建这个类的一个新实例，如下所示。

现在我们在 Todo.js 中有了一些基本的代码，我们还需要一些基本的 html 代码。在根文件夹的 index.html 文件中写下下面的代码。

现在我们有了基本的 html 代码，让我们回到 Todo.js 并获取对我们的。“列表项”容器。在构造函数中编写下面的代码。

在得到对“的引用后。list-item "元素，我调用 render 函数在屏幕上呈现一个项目列表。这个函数还不存在，所以我们接下来要写它。

但是在编写呈现函数之前，我们需要一些将要呈现的模拟数据。因此，在本教程中，我们将使用一个对象数组。在 Todo.js 文件的顶部编写以下代码。

现在回到渲染函数:下面是整个渲染函数。

在这个函数中，我们要确保 this.list 容器是空的，也就是说，我们不希望将任何项目追加到现有项目中。第一行只是在追加新项之前清空容器。

接下来，我们将循环使用 forEach 函数在 Todo.js 文件顶部创建的 mockData 数组。在 forEach 回调函数内部，我们首先通过调用 createDomElements(item.id)来创建一些 DOM 元素；函数，我们将当前项目的 id 传递给该函数。接下来我会写这个函数，但在此之前，让我们先写完这个函数。

一旦它创建了带有子元素(在本例中是按钮)的新 DOM 元素(li 元素)，它就使用“this”关键字将 li 元素作为属性添加到 Todo 类中。现在我们可以在整个 Todo 类中访问那个 li 元素，所以我正在访问那个 li 元素，并使用 insertAdjacentHTML()函数添加标题。

接下来，我将检查当前项目是否已完成。如果是，那么我在当前的 li 元素中添加一个类，在项目中添加一个线条样式。

最后，我将 li 元素添加到这个列表中

现在让我们编写下面的 createDomElements()函数。

这个函数看起来代码很多，但是很容易理解。我简单地创建李元素，删除，编辑和完成按钮。然后，我向所有这些按钮添加一些类，设置 data-id 属性，并分配我们作为参数从 render 函数传递的当前项目的 id。然后，我使用“innerHTML”在这些按钮(编辑、删除和完成)上放置文本。

最后，我将这些按钮附加到 li 元素，稍后我将在 render 函数中访问该元素以执行进一步的操作。

现在我们有了基本的结构，如果您在浏览器中运行 npm run dev 并转到 localhost:2770，您应该有下面的项目，一个输入字段和按钮，以及四个项目和它们各自的按钮。

到目前为止，您应该已经有了 CRUD 的“R”部分——我正在从 mockData 中读取所有元素，并将它们放在屏幕上。

既然 Read 部分已经完成，是时候开始 CRUD 的 C 部分了。编写一个名为 create 的函数，并添加以下代码。

Create 函数非常简单明了:它所做的就是从文本字段中获取值。它创建了一个 newItem 对象，属性为 ID、title、done 和 date。

最后，将 newItem 推入 mockData 数组，清空 textfield 并调用 render 函数来呈现所有带有新创建项的项。

现在，请在您的浏览器中尝试一下。在文本字段中输入一些文本。按下 add 按钮—但是您看不到任何变化。这是意料之中的，因为还有最后一部分。只需在构造函数中的“add”按钮上添加一个事件监听器，然后调用 create 函数，如下所示:

现在在你的浏览器中试试看，瞧。新项目位于列表的底部。

CRUD 操作的两个部分已经完成。接下来是删除的 D 部分。

为了删除一个条目，让我们编写一个 remove (delete 是 JavaScript 中的保留关键字，因此我将其命名为 remove)函数。

这个函数也很简单:首先从 delete button 元素中获取 id，这个元素是使用 data-id 属性在 createDomElements 函数中添加的。通过 mockData 进行筛选，并用 delete 按钮的 id 检查当前项目的 id。该检查只返回除返回 true 的项目之外的所有项目。

在这个操作之后，通过调用底部的 render 函数重新渲染所有的项目。

事情看起来很好，但是等一下:这个函数需要通过调用 delete 按钮来触发。您可能还记得，这个按钮是在“createDomElements”函数中动态添加的。向这样的元素添加事件有点棘手。由于这些项目在 DOM 加载时并不存在，而是后来添加的，所以将事件侦听器直接添加到 delete、update 和 complete 按钮是行不通的。

为此，将事件监听器添加到文档对象中，并找到特定的按钮(在本例中为“delete”)来执行删除或移除操作。

要调用 remove，需要使用 self 这个词。在回调函数中，this 关键字丢失了对 Todo 类的引用。出于这个原因，创建一个名为 self 的新变量，并在构造的顶部将“this”关键字赋给它。

在回调函数中，我检查 click 元素是否有一个类‘BTN-delete’—也就是说，它是一个删除按钮吗？然后只需触发 remove 函数，并将事件作为参数传递。我在 remove 函数中使用这个函数来获取当前被单击元素的 id，以执行删除操作。

更新部分稍微复杂一点。它由两个功能组成。第一个是呈现编辑表单，它有一个文本字段和更新按钮。第二个是更新执行更新操作的函数。

以上代码所做的就是添加和删除 CSS 类来显示和隐藏编辑表单，该表单已经在带有 edit-popup 类的 DOM 中。从编辑按钮获取 id，并将其放在更新按钮上。遍历 mockData 并使用其 id 检查当前项。将 mockData 中的项目标题放入文本字段进行编辑。

要触发此函数，请遵循与删除相同的逻辑来添加事件侦听器，如下所示:

现在该写更新操作了。遵循以下代码:

该函数的前两行从文本字段中获取项目的 id 和值，并将它们放入各自的变量中。然后通过 mockData 进行映射，并根据 id 进行检查以找到需要更新的项目。找到该项目后，用新的“itemTobeUpdate”标题替换标题。最后从地图返回更新项目。

一旦操作完成，通过添加和删除相应的 CSS 类来隐藏编辑弹出表单。然后通过调用 render 函数重新呈现 mockData。

要触发此函数，请在构造函数中添加以下代码。

现在所有的 CRUD 操作都已经完成了。还有最后一个步骤，它不是 CRUD 的一部分，而是 Todo 应用程序的一部分。也就是将项目标记为已完成。下面的函数将实现这一点。

同样，遵循与其余函数相同的模式:

*   从按钮的 data-id 属性获取 id
*   通过 mockData 映射并找到相关的项目，将其 done 属性设置为 true 并返回该项目
*   最后，通过调用 render 函数重新呈现 mockData。

同样，使用相同的逻辑触发 delete 函数，并在构造函数中添加以下代码，将任务设置为已完成。

这是我在本教程中使用的一些基本 CSS 没什么特别的。

这就是普通 JavaScript CRUD 操作！下一步是将其转换为 Angular 和 React 应用程序，以查看差异并了解此类框架有多方便。

要获得代码和完整的项目，请克隆以下存储库:

[https://github.com/zafar-saleem/todo](https://github.com/zafar-saleem/todo)