# 如何用 Alexa 响应拦截器改进你的代码

> 原文：<https://www.freecodecamp.org/news/how-to-improve-your-code-with-alexa-response-interceptors-2b3e73721fc/>

加勒特·瓦格斯

# 如何用 Alexa 响应拦截器改进你的代码

![1*d0I7athFoo0jgOpGMLPCKg](img/5d21c70a3918894108615169eaba98dd.png)

在过去的几年里，我已经发表了十几篇 Alexa 技能。在那段时间里，我遇到了一些模式和最佳实践。

我在代码中广泛使用的 SDK 的一个更强大但宣传不足的特性是响应拦截器。它是 [Alexa Node SDK](https://www.npmjs.com/package/ask-sdk) 的一部分。这个 SDK 简化了 Alexa 技能开发。

当使用它时，你可能会发现你的代码被多余的错误处理和清理任务弄得乱七八糟。响应拦截器允许你在处理 Alexa 意图的流程中插入一个钩子。这通过在将响应传递回 Alexa 之前在一个中心位置执行最后一分钟的操作来保持您的代码干净。这对于**调试**、**解决常见任务**，以及**清理响应**以避免使用 Alexa 生态系统时遇到的一些常见错误极其有用。

#### 排除故障

要使用 Alexa SDK 添加响应拦截器，您需要将实现 **process** 函数的类传递给 SkillBuilder 对象上的 addResponseInterceptors 函数，如下面的代码示例所示。我们稍后将讨论这个类的实现细节。

这个片段还显示了设置一个请求拦截器函数，它将在请求被传递到 Alexa 处理程序之前运行。例如，我发现记录每个传入请求和传出响应有助于调试。您可以使用请求拦截器和响应拦截器来实现这一点，如代码片段所示。该代码片段还显示了返回空承诺的流程函数的语法。

#### 解决常见任务

我的许多技能处理亚马逊。重复收听，以便用户可以再次听到最后一次响应。如果你有一项复杂的技能，尤其是维护状态引擎的技能，当用户要求 Alexa 重复自己时，你应该提供额外的细节，这样用户就能准确地知道他们在哪里。但是在更简单的技巧中，只需向用户回放之前的响应就可以了。响应拦截器允许您保存每个传出的语音和重新提示提示，以便您可以轻松地重新播放它们:

另一个常见的任务是处理属性。Alexa SDK 有几层属性。

*   请求属性(仅在单个请求期间有效)
*   会话属性(适用于会话长度)
*   持久属性(保存在类似 DynamoDB 的存储中，以便跨会话使用)。

我发现兼顾所有这些可能会让人不知所措。我将我的代码组织成只使用会话属性，在会话结束时保存到持久存储中。但是这种一揽子方法有两个问题——有些属性您可能不想保存，有些时候您希望值在处理程序之间传递，而不是跨会话传递(请求属性旨在解决这一问题)。

我通过使用一个**会话**和**请求**对象离开我的属性来解决这些问题。您可以在上面保存 lastResponse 和 lastReprompt 的代码片段中看到会话字段的示例。我不想持久地保存这些，所以在会话结束时持久存储之前，我清除了整个对象。以类似的方式，我每次都在响应拦截器的末尾清除请求对象，所以这些属性真正地只保留给请求。

#### 避免常见错误

困扰许多开发人员的一个限制是响应不能包含 5 个以上的音频标签。对于动态内容，有时很难避免这种情况。

例如，在我的 21 点技巧中，每发一张牌，我都会发出一种声音。通常没问题。但是当读出庄家的手牌时，如果他们最后抽了几张牌，你可以超过这个限制。当然，我可以在生成响应时尝试捕捉这个问题，但是这会使代码变得复杂。谁能说它是否符合每一个边缘案例？

最好将多余的音效作为响应处理程序的一部分移除。对于这项技能，我只是从响应的末尾删除了多余的音频文件，使计数减少到 5。

我遇到的另一个问题是不允许在对话框中返回指令。委托指令，如果您正在从用户那里引出槽。如果您正在处理按钮输入或使用显示指令，这可能会很烦人。在将指令添加到您的响应之前，您可能需要检查多个地方，以确保不会与 Dialog.Delegate 冲突。请保持代码整洁，并在返回之前使用 responseInterceptor 过滤您的指令:

我希望您喜欢这些技巧，并看到使用响应拦截器的威力。让我知道你自己的最佳实践，并在评论区分享你自己的技巧！