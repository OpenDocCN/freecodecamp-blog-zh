# 远离魔法——或者:为什么我不想再用 Laravel 了

> 原文：<https://www.freecodecamp.org/news/moving-away-from-magic-or-why-i-dont-want-to-use-laravel-anymore-2ce098c979bd/>

尼克拉斯·舒尔霍恩

# 远离魔法——或者:为什么我不想再用 Laravel 了

是时候改变我使用的工具了。我来告诉你为什么！

首先，我想确定你知道我的意图。我并不想对 Laravel 或者为什么其他框架可能更好大吼大叫。

这篇文章很主观。我将告诉您我的想法，并尝试让您重新考虑您的框架选择。当你在重新评估后坚持使用 Laravel，这没问题。我无意将人们从 Laravel 转向其他框架或语言。但重要的是要仔细观察，确保你知道**你用的是什么**和**为什么要用**。

![1*C547D5BdRsA6qdzFz-5GgA](img/8bd415a9a5f35f21483b2dc808dff7ae.png)

Drowning because of too much magic. Photo by [Kristopher Roller](https://unsplash.com/photos/PC_lbSSxCZE?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/search/photos/magic?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

### 介绍

我已经和 Laravel 一起工作了大约两年。我一直很喜欢在几分钟内启动一个应用程序并投入使用是多么容易。它提供了许多现成的有用工具。在编码过程中，控制台命令在各个方面都支持您。它们生成类、认证支架等等。

但是你越深入，项目越大，Laravel 的开发就越复杂。或者，让我换一种说法:更好的其他工具将完成这项工作。我甚至没说这只是拉弗尔的错。这也部分是由于 PHP 没有被很好地设计。

现在，我们开始吧！

### 雄辩的 ORM

如果你已经和 Laravel 一起工作过，你肯定知道口才。这是默认安装附带的 ORM。它有很多简洁的功能。但是它的设计使您的应用程序变得不必要的复杂，并阻止 IDE 正确地分析您的代码。

这部分是因为正在使用的**活动记录 ORM** 模式，部分是因为雄辩想让开发者不必写更多的代码。为了做到这一点，它让开发人员向模型中填充了大量不属于那里的东西。

听起来是好意，但我开始越来越不喜欢这样。

让我们来看一个例子:

您首先看到的是模型上没有属性。这似乎无关紧要，但对我来说，这很重要。通过读取表元数据，所有内容都被“神奇地”注入到类中。当然，如果没有帮助，您的 IDE 不会理解这一点。您没有机会用不同于列的名称来命名属性。

现在来看看 scope 方法。对于 Laravel 用户来说，它的功能非常清楚。如果调用此方法，它会通过添加给定的 WHERE 子句来确定基础 SQL 查询的范围。

你可以看到，它不是静态的。这意味着这个方法在类的特定对象上操作。但在这种情况下，**并不**。在查询生成器上调用范围。它与模型对象本身没有任何关系**。在您看到通常如何调用这些作用域后，我将解释这一点:**

你正在调用一个没有人定义过的静态方法`popular()`。但是因为 Laravel 定义了一个`__call()`和`__callStatic()`方法，所以通过它们来处理。[这些方法将调用转发给查询构建器。](https://github.com/laravel/framework/blob/5.7/src/Illuminate/Database/Eloquent/Model.php#L1610)

这不仅仅是你的 IDE 不理解的东西。这使得重构更加困难，可能会让新开发人员感到困惑，静态分析也变得更加困难。

另外，当把这样的方法放在你的模型上时，你就违反了 [SOLID](https://hackernoon.com/solid-principles-made-easy-67b1246bcdf) 的 S。如果您对此不熟悉，SOLID 是一个缩写词，代表:

*   单一责任原则
*   **O** 笔/闭原理
*   伊斯科夫替代原则
*   I 界面分离原理
*   **D** 依赖反转原理

当你使用口才时，你的模型有多重责任。它保存来自数据库的数据，这是模型通常做的，但它也有过滤逻辑，可能排序，甚至更多。你不想那样。

### 全球助手

Laravel 附带了相当多的全局助手函数。他们看起来很方便，是的，他们很方便。

你只需要知道，你牺牲了你的独立性来换取方便，你的全局命名空间被污染了。这很少会导致冲突，但是最好完全避免冲突。

我们来看几个例子。这里列出了三个我们有但不需要的辅助方法，因为有更好的替代方法:

*   `app_path()` —为什么？如果需要 app 的路径，问 app 对象。你通过类型提示得到它。
*   `app()` —嗯？我们不需要这种方法。我们可以注入 app 实例！
*   `collect()` —这将创建集合类的新实例。我们可以自己创建一个对象。

再举一个具体的例子:

我们使用 Laravel 的全局`request()`助手来检索 POST 数据，并将其作为属性放入我们的模型中。

除了使用全局助手，我们可以在控制器方法中输入提示 a `Request`对象作为参数。Laravel 的调度员知道如何为我们提供所需的对象。它会用它来调用我们的方法，而我们不需要调用助手。

我们可以更进一步，进一步分离。Laravel 与 PSR-7 和 T2 兼容。因此，您也可以键入 hint `ServerRequestInterface`，而不是键入 hint 请求对象。这允许你用任何符合 PSR-7 的东西来替换整个框架。这种方法中的一切都将继续工作。如果您仍在使用 helper 方法，这将会失败。新的框架不会附带 helper 方法，因此，您必须重写这部分代码。

你很少改变整个框架，但是有人会这样做。即使*你*可能永远不会切换，它对互操作性仍然很重要。能够注入依赖关系并拥有简洁的数据流，而不是从里到外地解析和请求依赖关系和数据，这才是正确的做法。当你掌握它时，它使测试、重构和几乎所有事情都变得更容易。

当我读到 Laravel 5.8 [将字符串和数组助手从内核中移除并放到一个单独的包中时，我很高兴。](https://laravel-news.com/laravel-5-8-deprecates-string-and-array-helpers)这是良好的第一步。但是文档应该开始阻止使用**所有**助手函数。

### 外表

上一部分的论点在这里也发挥了作用。Facades 似乎是一个很好的工具，可以快速访问一些不是真正静态的方法。但是他们再次将你束缚在框架中。您使用它们来手动解析依赖项，而不是指示环境提供它们。

同样的道理也适用于通过神奇的方法传递一切的复杂性。

既然我们讨论了 IDE 支持，我知道你们中的一些人可能会向我介绍来自 barryvdh 的 [IDE 助手包](https://github.com/barryvdh/laravel-ide-helper)。你不需要。我已经知道这个包了。但是为什么还需要它呢？因为 Laravel 的一些设计决策并不好。有些框架不需要这些。以 Symfony 为例。不需要 IDE 帮助文件，因为它设计和实现得很好。

代替 facades，我们可以像前面的例子一样再次使用依赖注入。我们会有一个真正的对象，并可以在其上调用真正的方法。好多了。

我再给你举一个例子:

我们很容易就能清理干净。让我们告诉 Laravel 注入一个`ResponseFactory`并将当前请求传递给我们:

我们现在已经成功地从我们的控制器中消除了外观的使用。代码看起来仍然简洁紧凑，甚至比以前更好。由于我们的控制器总是扩展一般的`Controller`类，我们可以通过将响应工厂移动到父类来更进一步。无论如何，我们在所有其他控制器类中都需要它。

我听说有些人提供“太多的构造函数参数”作为反对注入一切的论据。但我不同意这一点。它只是首先隐藏了依赖性和复杂性。如果你不喜欢在你的构造函数中有 10 到 20 个参数，你是对的。

然而，解决方案并不神奇。在一个类中需要这么多的依赖关系意味着这个类很可能有太多的职责。与其隐藏这种复杂性，不如重构这个类。将它分成新的部分，并改进你的应用程序架构。

有趣的事实:有一种真正的设计模式叫做“门面模式”，是在四人帮的书里介绍的。但它有着完全不同的意义。Laravel 的门面本质上是**静态服务定位器**。命名并没有传达这一点。不同事物的相同命名也使得项目中关于架构的讨论变得更加困难，因为另一方可能期望名称背后有完全不同的东西。

### 结论

让我们结束吧。我可能很快会写一篇后续文章，谈谈我现在更喜欢使用哪些技术。但是现在，让我总结一下我们学到的东西:

Laravel 让一切尽可能简单的方法是好的。但是当你的应用变得更高级时，就很难相处了。我更喜欢令人敬畏的 IDE 支持、更强的类型、真实的对象和良好的工程。当我想写一个更小的应用程序时，我甚至可能会回到 Laravel。

我的很多观点不仅仅是 Laravel 的错。我可以交换我不喜欢的部分，例如 ORM。但是相反，我会切换工具箱，让缺省值更适合我的需要。我看不出使用一个框架有什么意义，在这个框架中，我必须花更多的时间来避免它为糟糕的工程设置的陷阱，而不是开发我的应用程序。其他框架和工具提供了设计更好的缺省值和更少的魔法。

所以现在，我要和拉弗尔说再见了。

谢谢你的时间。我希望在评论中有一个好的讨论，当然我也欢迎你的问题和建议。

附:特别感谢 [Marco Pivetta](https://www.freecodecamp.org/news/moving-away-from-magic-or-why-i-dont-want-to-use-laravel-anymore-2ce098c979bd/undefined) 的校对和附加输入！

*编辑 2019 年 3 月 1 日:*
自从我的文章发布在 Reddit 上，我就创建了一个 Reddit 账号来回答一些评论。我的账号不是发文章的那个，而是这个:[https://reddit.com/u/nschoellhorn](https://reddit.com/u/nschoellhorn)

*编辑 2019 年 3 月 13 日:*
如果你读到这里，不妨看看我的[推特简介](https://twitter.com/nschoellhorn)。感谢您对本主题的持续关注！我总是乐于进行富有成效的讨论，所以请随时联系，无论是在这里还是在 Twitter 上。