# 我们如何利用 Refract 的反应式编程能力

> 原文：<https://www.freecodecamp.org/news/how-we-harnessed-the-power-of-reactive-programming-with-refract-87f269ac779e/>

乔·麦格拉思

# 我们如何利用 Refract 的反应式编程能力

你有没有想过由公司建立的开源库是如何产生的？

我一直很好奇。他们是从创建内部库的意图开始的吗？开源是最初的目标吗？如果都不是，它到底是怎么发生的？既然我已经足够幸运地从头到尾看到了这一点，我觉得有必要分享一下[如何折射](https://refract.js.org/)的故事！

![zwjEANmYzAbTRpsN5UdKBCeQYwXDcMRPYgBb](img/0daf001caae682d2920ef4206ea4891f.png)

在接受了 FanDuel 的工作邀请后，我做的第一件事就是给面试过我的工程师发电子邮件。

我的前雇主是一家雄心勃勃的初创公司，致力于一些很酷的想法，但 FanDuel 是真正的交易:一家技术独角兽，被誉为美国顶级公司之一。因为我只有几个月的 React/Redux 等人的经验，所以抢先一步似乎是个好主意…所以我问要学什么技术。

在熟悉和陌生的库和概念中，回复中的一行引起了我的注意:

> “xstream —我们对使用反应式编程感到非常兴奋”

我听说过反应式编程——这正是我希望学习的那种强大、灵活的编程技术。然而，我对它了解得足够多，以至于 xstream 这个名字引起了质疑。

通常，React 和 reactive 编程的组合意味着 redux-observable，redux-observable 使用 RxJS。Xstream 是 RxJS 的替代品。他们使用 xstream 的事实意味着要么是一个适配器，要么是某种定制集成。

我希望是后者。这符合该公司的创新声誉，感觉是一件非常有趣的工作。

我不会失望的。

### 探索的时间

十二月中旬开始新工作有利有弊。如果你的第一周恰好是黑客马拉松，这种影响会被放大。

要过一段时间，严肃的工作才会送到我面前，对我来说，这是件好事。这意味着我有时间去探索。我学习方法的一个怪癖是，我乐于通过简单地阅读代码来吸收关于新代码库的知识和背景。

我的主要目标是从总体上理解这个应用，但我还有其他问题。我想看看他们是如何使用反应式编程的——很快就找到了我要找的东西。

深入几个抽象层导致了一对更高阶的组件:`withSideEffects`和`withPropsSideEffects`。

前者允许您通过动作或选择器观察 Redux 存储。它在概念上类似于 redux-observable，但是嵌入在 React 组件中。

后者更有趣。它允许你观察流经 React 本身的数据，这是我从未听说过的可能性。

这两个一般化的 hoc 构成了一系列更专门化的 hoc 的基础。每个人都接受了一组数据，并相应地产生了特定的副作用。一对分派分析事件，另一对分派到商店。另一个用来触发导航变化。这是一个明显的限制:你一次只能观察一个源，并且只能产生一种效果。

另一个缺陷是 HoCs 有一个非常神秘的 API。要配置它们，你必须传入嵌套数组，包含你想观察的事物列表和你想引起的反应。

结果，这个强大的功能没有发挥出它的全部潜力。代码背后的想法显示了很大的灵活性，但是这些缺陷阻碍了它的发展。

那么瑕疵从何而来？这段代码在承受这些创伤之前经历了哪些战斗？

原来我第一次遇到的代码实际上是第四次迭代。早期的迭代是什么，它们是如何实现的？

![AZ2XVzgBF9mlhPLnCO7Z7crFmYgKUAa3Lm4V](img/ce17624a35cfe58b7374feca01388338.png)

Photo by [Atul Vinayak](https://unsplash.com/@atulvi?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

### 很久以前

2015 年，FanDuel 决定为一个潜在的新市场创造一种新产品。这被视为一个新的开始——一个尝试新事物的机会，探索流行的 React/Redux 生态系统可能比现有的 Angular 应用程序提供的潜在优势。

托马斯是这个项目的首席工程师之一。他确信反应式编程可以带来巨大的好处，渴望找到在应用程序中使用它的机会。

Refract 的第一粒种子——第一次迭代——来自每个开发人员最喜欢做的事情:分析。

我们不会在这里探讨这个版本，因为当时托马斯写了一篇解释这种情况的文章，仍然值得一读。该特性的核心是嵌入到 React 组件中的流。它允许您观察操作和选择器，并作为响应将数据发送给分析供应商。

### 稳步前进

新应用被认为是成功的，该公司决定使用闪亮的新技术重新平台化这款美国旗舰产品。

对已经大规模使用的产品进行如此重大的改变是很自然的，这将是一个长期的项目。在撰写本文时，一些角度视图仍在使用，一些甚至更老的遗留代码在某些地方仍然存在。

但这并不意味着生活要等待旧的代码赶上来。随着时间的推移，对付副作用的方法不断发展和完善。

折射的第二次迭代将保持丢失。引用托马斯的话，“我已经忘记了，我想那样更好。”

第三次迭代类似于我第一次遇到的方法。它的 API 甚至更难阅读，而且仍然局限于观察 Redux。

第四次迭代是一个巨大的飞跃。引入了观察反应道具的能力。小的矛盾被解决了。命令式和声明式代码被拆分成类似于 Redux 的 reducers 和 action creators 的东西。

这个迭代稳定了一年多。随着时间的推移，它证明了自己的价值，在我加入的时候，它被认为是一个成熟的特性。

![0rUO5jLVkG2DT1C5N9aC2ITt5FoyFmY8AXAK](img/7d7010c4a92cfcd4cf9952247c67b50d.png)

Photo by [Nigel Tadyanehondo](https://unsplash.com/@nxvision?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

### 一个新想法

因此，Refract 最初是一些私有代码，被认为是稳定的，但很难使用，内置在一个大型应用程序中。我们如何将它变成一个独立的库，供更广泛的社区使用？一路走来采取了哪些步骤？

这个项目实际上是由外部影响引发的。FanDuel 经常举办爱丁堡聚会，至少有一两个工程师参加。

在一次聚会上，一次谈话探讨了 redux-observable，在场的一个人突然意识到，相比之下，我们的代码可以做得更多。我们在接下来的几周里讨论了这个问题，觉得这是一个非常值得开源的东西。

有一段时间，这些讨论似乎没有任何结果。虽然公司将每个人 10%的时间用于职业发展，但每个人都有自己想做的其他事情。此外，代码看起来太复杂，不可能成为一个真正成功的项目。

### 发生了吗？

然后，4 月中旬的一天，出现了新的松弛通道。频道的用途:`Discussion of a new API for side-effects, with OSS plan`。托马斯贴出了一个他想到的新 API 的草图。

草图比现有的 API 简单得多。它使开发人员的体验更加清晰和直观，并增加了更多的灵活性。在接下来的几周里，我们讨论了改进的想法，同时继续进行自行车的严肃事务——去掉项目的名称和标志。

有一段时间，我们在不太满意的情况下集中在名称**反冲**上，但后来有人提出了一个完美的名称:**折射**。先画出符号，然后完成最终的 logo。进步！

严肃的工作结束后，我们可以继续处理剩下的细节——也就是等待托马斯编写代码。

他从应用程序中提取了现有代码，并对其进行了调整，以匹配新的 API 设计。我们花时间构建一些测试项目，迭代细节，然后编写文档和示例。我们向我们的首席技术官和其他高管提出了这个想法，获得了许多关键利益相关者的批准。

![uphZh85IkaSVE1mTUJSQt4MEdMSWKchiJZr8](img/38a39070e1a0db20699205ecee2a293c.png)

现在你明白了:至少在这种情况下，我们的图书馆比它看起来有更长的历史。在开源的第一个暗示出现之前，它经历了多次迭代。

我们在内部使用了一段时间后，于 2018 年 8 月底发布了 Refract 的第一版，这是一次愉快的合作。但是，就像最好的起源故事一样，结局仅仅是更伟大的开始。

### 新的目标

我们早期使用图书馆的经历使我们产生了一些新的想法。我们实现了其中最好的一个，Refract 变成了比我们最初想象的更通用的东西。

它不再仅仅是一个从同步逻辑中隔离副作用的库。它现在让你**使用反应式编程**构建你的 React 应用。这对我们未来如何构建应用程序有着巨大的影响。

但那最好留给下次去探索。

现在，如果你想了解更多，[查看我们的文档](https://refract.js.org/)和我们众多的[现场代码示例](https://refract.js.org/examples)！

如果您有任何问题或反馈，或者只是谈论您希望如何使用该库，请加入我们在 Reactiflux Discord 服务器上的 [**#refract** 频道。我们期待您的回复！](https://discord.gg/fqk86GH)

[**Refract—Documentation**](https://refract.js.org/)
[*利用无功编程的力量为您的组件增压*refract.js.org](https://refract.js.org/)