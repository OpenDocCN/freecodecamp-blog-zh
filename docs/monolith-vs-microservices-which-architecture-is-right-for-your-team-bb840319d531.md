# 整体服务与微服务:哪种架构适合您的团队？

> 原文：<https://www.freecodecamp.org/news/monolith-vs-microservices-which-architecture-is-right-for-your-team-bb840319d531/>

杰克·卢梅塔

# 整体服务与微服务:哪种架构适合您的团队？

![KtotVaKGRTo8MT2HiaCrzaOW83KfAa6vwwK6](img/e8d54cef828bb6670340b29b5576e82a.png)

The iconic Monolith. Your next application?

我的好朋友 Darby Frey 在担任色域的高级平台工程主管后，最近启动了一个新项目。尽管在他以前的公司 Belly 开始使用 monolith，他发现——在正确的情况下——从 monolith 开始并不总是最好的方式。

在 Belly，Darby 和他的团队将他们的整体结构分解成一个相当大的微服务架构。他们设法把它放到一个好地方，但只是在迁移到微服务的几个月的考验和磨难之后。

这一经历历历在目，他在 Gamut 着手新项目时对微服务更加谨慎。

“我是 Monolith 团队的坚定成员。他说:“我认为，让我们建立一个单一的应用程序，如果我们开始感到痛苦，就把它拆开。”。

虽然这是一个绿地项目，达比的团队很小，他有积极的时间表，所以从表面上看，一个整体似乎是显而易见的选择。

“[但有了这个新项目]，我渴望不再重复过去的错误。”

与此同时，他发现自己面临着一个我们都在挣扎的决定:我们应该从整体服务还是微服务开始，以及我们如何决定？

### 关于巨石柱的传统观点

许多创业公司都是从整体开始的，因为它的结构非常适合小团队，并提供了其他优势，如更少的运营开销。此外，独石通常只有一个庞大的代码库。服务器端应用程序逻辑、前端客户端逻辑、后台作业等都是在相同的代码库中定义的。这意味着，如果开发人员想要进行任何更改或更新，他们需要一次性构建和部署整个堆栈。

一块巨石不是我们需要留在过去的过时建筑。在某些情况下，一个整体是理想的。为了更好地理解这一点，我与前谷歌员工、Scaylr 的工程主管史蒂文·切尔文斯基(Steven Czerwinski)进行了交谈。

“尽管我们在谷歌使用微服务时有过这些积极的体验，但我们(在 Scaylr)还是选择了(整体式)路线，因为拥有一台整体式服务器意味着我们两个工程师的工作量会减少，”他解释道。这要追溯到 Scalyr 的早期。

换句话说，因为他的团队很小，所以统一的应用程序比把所有东西都分散到微服务中更容易管理。

### 微服务的替代方案

粒子公司的首席技术官扎卡里·克罗克特在一次采访中告诉我:

> “当讨论微服务时，人们倾向于关注该领域的一端:许多微小的应用程序相互传递太多的消息。在光谱的另一端，你有一个巨大的庞然大物做太多的事情。对于任何真实的系统，在这两个极端之间有许多可能的面向服务的架构。”

微服务架构风格是一种将单个应用程序开发为一套小型服务的方法。每个都在自己的进程中运行，并与轻量级机制(通常是 HTTP 资源 API)进行通信。

这些服务是围绕业务功能构建的，并且可以由完全自动化的部署机器独立部署。这些服务可以用不同的编程语言编写，并且可以使用不同的数据存储技术，对它们的集中管理非常少。

微服务确实有明显的优势:

*   **更好的组织:**微服务架构通常组织得更好。每个微服务都有非常具体的工作，它不关心其他组件的工作。
*   **解耦:**解耦的服务也更容易重组和重新配置，以服务于不同的应用程序(例如，服务于 web 客户端和公共 API)。它们还允许在更大的集成系统中快速、独立地交付各个部件。
*   **性能:**在适当的情况下，微服务也可以有性能优势，这取决于它们的组织方式。隔离热门服务并独立于应用程序的其他部分进行扩展是可能的。
*   **更少的错误:**微服务通过在你系统的不同部分之间建立一个难以跨越的边界来实现并行开发。通过这样做，你就很难——或者至少更难——做错误的事情:也就是说，连接不应该连接的部分，而把需要连接的部分耦合得太紧。

但它们也带来了独特的挑战:

*   **跨每个服务的横切关注点:**当您构建一个新的微服务架构时，您可能会发现许多您在设计时没有预料到的横切关注点。您要么需要为每个横切关注点(即测试)产生单独模块的开销，要么将横切关注点封装在另一个服务层中，所有流量都通过该服务层进行路由。最终，即使是单体架构也倾向于通过外部服务层路由流量，以解决横切关注点，但是有了单体架构，就有可能将这项工作的成本推迟到项目更加成熟的时候。
*   **更高的运营开销:**微服务经常部署在它们自己的虚拟机或容器上，导致虚拟机争论工作激增。这些任务通常通过集装箱船队管理工具实现自动化。

### 哪个型号适合你？

与数十位 CTO 的访谈告诉我们，一种方法并不适合所有人。他们的经历可以作为一个有用的标尺，让你在整体服务和微服务之间做出选择。回答这些问题应该会引导你走向正确的方向:

#### 你在熟悉的领域吗？

Darby 和他在 Gamut 的团队能够直接研究微服务，因为他有电子商务平台的经验，并且他的公司有丰富的关于客户需求的知识。如果他一直在一条未知的道路上旅行，那么一块巨石实际上可能是更安全的选择。

同样，初创公司通常诞生于之前公司经历的痛苦。在这些场景中，有时很明显，扩展将是首要要求，尤其是在基于基础设施的服务中，如云日志管理。

#### 你的团队准备好了吗？

你的团队有微服务的经验吗？如果您在下一年内将团队规模扩大到原来的四倍，情况会怎样？微服务是这种情况下的理想选择吗？评估团队的这些方面对项目的成功至关重要。

阿尔戈利亚首席技术官朱利安·莱莫因对此表示赞同:

> “我们一直从微服务方法开始。主要目标是能够使用不同的技术来构建我们的服务，原因有两个:

> 1)我们希望为每项服务使用最好的工具。我们的搜索 API 在最底层进行了高度优化，C++是实现这一点的完美语言。也就是说，使用 C++做任何事情都是对生产力的浪费，尤其是构建一个仪表板！

> 2)想要最好的人才，只使用一种技术会限制我们的选择。这就是为什么我们公司有不同的语言，当你想在毫秒级优化一切时，Go 不如 C++完美，但当性能仍然是关键时，它是完美的语言(使用 ruby 或 python 处理日志，我们每天处理几 TB 的日志，会浪费 CPU)。"

如果您的团队准备好了，从微服务开始是明智的，因为它允许您从一开始就习惯在微服务环境中开发的节奏。

#### 你的基础设施怎么样？

实际上，你需要基于云的基础设施来让微服务为你的项目工作。万神殿首席技术官大卫·施特劳斯是这样解释的:

> “[以前]，您可能希望从一个整体开始，因为您希望部署一个数据库服务器。必须为每个微服务设置一个数据库服务器，然后进行横向扩展，这是一项艰巨的任务。只有一个庞大的、精通技术的组织才能做到这一点。

> 然而今天有了像 Google Cloud 和 Amazon AWS 这样的服务，你有很多选择来部署微小的东西，而不需要拥有每一个的持久层。"

#### 评估业务风险

你可能认为微服务是一个雄心勃勃、精通技术的初创公司的“正确”道路。但是微服务带来了商业风险。大卫·施特劳斯解释说:

> “许多团队最初过度构建了他们的项目；每个人都希望自己的创业公司成为下一个独角兽，因此，他们应该用微服务或其他超可扩展的基础设施来构建一切。但这通常是错误的，几乎总是如此。”

他在 Pantheon 早期的一个例子是一个仅限于单个 VM 的系统。他们认为这将是一个或两个月，直到他们被迫规模。这一过程持续了一年多——他们最终以一种完全不同于预期的方式进行了扩展。

他接着说，在这些情况下，您认为需要扩展的领域可能不是首先需要扩展的部分。这导致了错误的努力，甚至对于需要扩展的系统也是如此。

### 背景是关键——选择架构的经验法则

我们对成功的 CTO 进行了数小时的采访，并将其提炼为选择服务架构时要遵循的一般准则。

#### 什么时候开始用整块石头

这里有一些场景，表明您应该使用 monolithic 架构开始您的下一个项目。

*   **您的团队正处于创建阶段:**您的团队规模很小，只有 2-5 名成员，因此无法处理更广泛且高开销的微服务架构。
*   **你正在打造一款未经证实的产品或概念验证:**你正在打造一款未经市场证实的产品吗？如果这是一个新的想法，它很可能会随着时间的推移而改变和发展，所以一个整体是允许快速产品迭代的理想选择。同样的道理也适用于概念验证，你的目标只是尽可能快地学到尽可能多的东西，即使你最终把它扔掉了。
*   **你没有微服务经验:**如果你的团队以前没有微服务经验，除非你能证明在这么早的阶段冒“即时”学习的风险是合理的，这可能是你应该坚持开始的另一个迹象。

#### 何时开始使用微服务

以下是一些表明您应该使用微服务开始下一个项目的场景:

*   **您需要快速、独立的服务交付:**微服务允许在更大的集成系统中快速、独立地交付各个部分。请注意，根据您的团队规模，与从 monolith 开始相比，可能需要一段时间才能看到服务交付的收益。
*   **您平台的一部分需要非常高效:**如果您的企业正在对数 Pb 的日志量进行密集处理，您可能希望用非常高效的语言(即 C++)来构建该服务，而您的用户仪表板可能是用 Ruby on Rails 构建的。
*   **你计划壮大你的团队:**从微服务开始让你的团队从一开始就习惯于在独立的小服务中开发。通过服务边界将团队分开，可以更容易地在需要时扩展团队，而不会带来指数级的复杂性。

### 选择你能舒适相处的建筑

微服务已经成为越来越受欢迎的服务架构，但了解它是否最适合您的项目是至关重要的。根据上述考虑因素评估您自己的背景，这是决定您应该从整体服务还是微服务开始的关键。

杰克是 ButterCMS 公司的首席执行官。更多类似的内容，请在 Twitter 上关注 [@ButterCMS](https://twitter.com/ButterCMS) ，并订阅[我们的博客](https://buttercms.com/blog/)。