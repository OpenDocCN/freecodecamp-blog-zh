# 什么是软件事后分析，你如何写一个？

> 原文：<https://www.freecodecamp.org/news/what-is-a-software-post-mortem/>

每个公司都有自己的最高优先级错误的名称。优先级一，紧急情况，关键修复或紧急修复。

如果不迅速处理，有些软件缺陷最终会让公司陷入瘫痪。

骑士国会集团是一家美国金融服务公司。一名技术人员忘记将一些新代码复制到计算机服务器上，这一软件发布给他们造成了 4.4 亿美元的损失。这是因为其中一台计算机服务器在 45 分钟内开始快速购买股票(完成了 400 多万笔买卖)。

并不是每一个软件缺陷都如此引人注目。但是作为软件开发人员，有些时候你必须尽可能快地解决问题。

最近，我了解到一些公司公开发布了他们紧急漏洞的事后报告，于是我一头扎进了其中。

# 什么是验尸？

事后分析是团队反思他们所做的事情哪里出错了，并记录下来和/或修改他们的过程以防止它再次发生。

软件发布失败了吗？让我们分解出事情开始出错的时间表，并让我们反思我们如何能够更早地发现它。

这是最重要的一点:验尸后**不是**来分配责任。如果我们看看骑士国会集团的例子，应该有**没有办法**让一个人忘记一些事情而使公司瘫痪。

有人检查技术人员工作的质量保证流程在哪里？他们在投入生产前测试过这个吗？在成功部署到生产环境之前，没有运行自动测试吗？

你应该找的是**流程故障**而不是**个人故障**。

# 为什么要做尸检？

这样我们就不会一遍又一遍地犯同样的错误了！

通过学习我们过去是如何失败的，我们提供了更健壮、无错误、稳定的软件。

最重要的是，我们可以捕捉我们甚至不知道的错误。如果我们尽早修正容易导致问题的流程，那么这些错误甚至不会发生。

我们希望从停机和紧急情况中吸取每一个教训，确保它们不再发生。没有什么比经验更有价值。

# 让我们一起来看看一些验尸报告

我想要一点公司和语言的多样性，所以让我们回顾一下谷歌、微软和 Flowdock。

一个[通用事后分析模板](https://gist.github.com/adhorn/e76339b2050d468d318336c8bf6d7d6d#file-postmortem)将包含一些关键细节，如:

*   事情发生的时候
*   谁负责事后分析(并将进行分析)
*   一些经验教训
*   紧急错误的大致时间表和事后分析的一些行动

所以让我们开始吧。

## 谷歌

如果你在 2009 年 1 月 31 日上午 6:30 到 7:25 之间用谷歌搜索，你会在每一个结果中看到“这个网站可能会危害你的计算机”的信息。

### 发生了什么事？

如果已知该网站安装了恶意软件，Google 会用此消息标记搜索结果。这是一个保护谷歌用户的警告，并与谷歌的自动算法、手动数据输入和一个名为[StopBadWare.com](https://www.stopbadware.org/)的非营利组织进行了对比。

其中一个开发者更新了列表，不小心输入了一个`/`，它解析到了每一个站点！

我们知道这是人为错误，正因为如此，每当文件更改时，Google 都会执行一些测试和检查。(而且 2009 年以后就没再见过了！)

完整的验尸报告可以在[这里](https://googleblog.blogspot.com/2009/01/this-site-may-harm-your-computer-on.html)找到。

## 微软

微软在 2012 年 2 月 29 日经历了 12 小时的停机。

### 发生了什么事？

微软有**结构控制器**，这是控制大约 1000 台服务器的计算机。它管理它们的生命周期，监控它们的健康状况，并在服务器停机时重启服务器。

将所有这些服务器隔离到 1，000 个服务器集群中有助于他们保持模块化，并将故障局限于 1 个**结构控制器**(而不是所有服务器都停机)。

集群中的每个服务器都有一个叫做**主机代理**的东西，**结构控制器**用它来完成它认为必要的工作。它处理的事情之一是部署 SSL 证书，以保持服务器使用 HTTPS，这是一种加密数据的方式。

要知道这些 SSL 证书什么时候需要重新生成，就取第二天的午夜加上一年。因此，如果**结构控制器**在 1990 年 3 月 19 日为服务器创建新证书，它将在 1991 年 3 月 20 日到期。

你知道这是怎么回事吗？这些服务器试图为闰年的服务器生成一年证书。它试图将证书设置为在 2020 年 2 月 30 日到期。

当无法为服务器生成证书时，它将终止。而如果它连续终止三次，就认为是硬件故障，然后告诉 **Fabric Controller** 它有故障。

**结构控制器**、**、**试图“治愈”故障服务器，将工作移交给另一个服务器。当试图生成这些证书时，所有的服务器将一个接一个地出错。这最终会关闭**架构控制器**(以及它的 1000 台服务器！).

这场灾难是由错误的代码造成的。有更好的方法来处理闰年和时区差异等日期问题。

完整的验尸报告可以在[这里](https://azure.microsoft.com/en-us/blog/summary-of-windows-azure-service-disruption-on-feb-29th-2012/)找到。

## 谷歌，第二次

从 2015 年 8 月 13 日星期四到 2015 年 8 月 17 日星期一，谷歌云服务出现了一些错误，同时一些硬盘上 0.000001%的数据永久丢失。

### 发生了什么事？

当地电网连续遭到四次雷击，为谷歌的电脑供电，为谷歌云服务供电。

有一些系统开始通过使用备用电池来立即替换被切断的电源。在谷歌员工的人工干预下，服务以最小的永久损失得以恢复。

谷歌有一个正在进行的项目，升级他们的基础设施，使他们不容易受到这样的问题。之后，他们对配电、控制云服务的软件以及正在使用的云硬件进行了分析。

完整的验尸报告可以在[这里](https://status.cloud.google.com/incident/compute/15056#5719570367119360)找到。

## 流动船坞

在 2020 年 4 月 21 日至 22 日期间，Flowdock 即时消息大约有 32 小时不可用。还发现了奇怪的行为，比如一些用户无法登录。此外，一些人在他们的组织中发现了来自另一个组织的用户(例如，像亚马逊员工交叉感染了微软)。

### 发生了什么事？

冠状病毒导致在家工作的人突然激增，导致 Flowdock 的使用率高于平时。这导致了非常高的 CPU 使用率，并导致数据库在试图处理负载时挂起。还有一些永久性的数据丢失。

完整的验尸报告可以在[这里](https://flowdock-resources.s3.amazonaws.com/legal/Flowdock-RCA-For-Incident-On-2020-04-21.pdf)找到。

# 做尸检时要记住的事情

我读过 Adrian Hornsby 写的一篇精彩的文章，他是亚马逊的一名首席开发人员。在这篇文章中，[他讨论了](https://medium.com/the-cloud-architect/incident-postmortem-template-7b0e0a04f7a8)一些要避免的事情，以及一些要强调的事情，以便写出最好的事后分析，如果你曾经是一个事后分析的拥有者的话。

以下是他的一些建议:

*   不要做事后分析来指责个人、团队或组织。相反，关注**过程****未能允许这些错误造成损害。永远不要做事后分析来惩罚某人。这没有价值，你也找不到改进。**
*   **不要认为已经发生的事情比实际情况更容易预测。只是因为它们已经发生了，现在才变得明显。(**[**后知后觉**](https://en.wikipedia.org/wiki/Hindsight_bias)** )**
*   **确保你足够深入。不要只说我们看到前端代码有错误。真正深入挖掘具体的错误以及导致错误的条件。下一次该流程如何捕捉这种情况？更好的 QA 流程？更多同行评议？更好的错误记录？**
*   **如果你阻止它发生的解决步骤真的很模糊，比如“改进文档”或“更好地培训”，你就没有足够清楚地理解它，不能更具体。使这些解决步骤切实可行。**
*   **试着把你的决心步骤放在那些可以在**短期内**完成的事情上。我们正试图尽快阻止这些再次发生。事后检讨可以产生长期的过程变化，但这不是你目前关注的。不要试图重新构建一些基本的东西，或者试图改变一些巨大的代码库所使用的语言。**
*   **让你的事后分析挑战你的团队目前认为正确的东西。不要因为大家都相信某件事是真的就假设它是([**Com**](https://en.wikipedia.org/wiki/Argumentum_ad_populum)**[**mon 信念谬误**](https://en.wikipedia.org/wiki/Argumentum_ad_populum) )****

## **如何了解更多**

**如果你喜欢这个，你可以在这里找到更多的公开验尸报告。这包括我们已经讨论过的公司的事后证明，以及亚马逊、GitHub、Linux、Heroku、Spotify、Valve、Cloudfare、Etsy、GoCardless、Travis CI 等公司的例子。**

## **结论**

**我希望这已经解释了什么是软件开发生命周期中的事后分析，如何有效地编写事后分析，以及在编写最初几个时会出现的常见错误。**

**如果你喜欢这篇文章并想看更多，我在 Twitter 上分享我的文章。**