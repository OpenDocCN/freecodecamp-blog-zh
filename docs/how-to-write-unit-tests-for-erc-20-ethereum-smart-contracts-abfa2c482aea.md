# 如何为 ERC 20 以太坊智能合约编写单元测试

> 原文：<https://www.freecodecamp.org/news/how-to-write-unit-tests-for-erc-20-ethereum-smart-contracts-abfa2c482aea/>

伊尔·卡德罗夫

# 如何为 ERC 20 以太坊智能合约编写单元测试

![1*b8-UrpS2ct361i2QWAVeRw](img/47eaed5d19f644d1da842fe6cc26df6b.png)

为你的智能契约编写单元测试是非常重要的，就像任何开发项目一样。然而，基于区块链的解决方案中的单元测试经常被低估和忽视。

去年，我对主要为以太坊(Ethereum)以及 Neo、Eos、Tron 和比特币区块链撰写的智能合约进行了 200 多次审计。

据我观察，这些项目中有将近一半没有写单元测试。这种疏忽往往导致合同执行不力，并在审计中发现各种安全问题。

#### 必备测试

![1*8fQ1Akp_3eABKt_w9t_emQ](img/020ad6dc95cda51519d386b346e5ab8e.png)

每个智能合同都有共同的部分，例如

*   建筑工人
*   总供水量
*   转入和转出的功能
*   审批功能
*   并且有时用于燃烧额外的代币

因此，检查您的智能合约以正确初始化所有参数，并在您溢出或下溢总电源或其他 *uint* 值时进行恢复非常重要。此外，您需要检查修饰符和正确的权限使用。

在本文中，我将特别关注以太坊智能合约，但这也适用于其他平台，因为其他加密货币的合约结构相同。首先，让我们测试令牌的正确初始化及其到某个地址的正确传输。

#### 检查初始化

正确初始化的测试很简单。您只需要创建一个样本契约，并检查所有必须初始化的值的正确性。

#### 支票转账

检查 ***转账*** 功能非常重要，因为可能会出现导致转账不正确的问题。您必须确保收款人和汇款人的余额在转账时发生变化，并在函数获得错误参数的情况下尝试恢复。

举个例子，

*   当发送的金额超过发送者的余额时
*   当发送合同地址或无效地址而不是收件人地址时，等等。

最后，您必须检查*传输*事件是否被**记录**。

***transferFrom*** 功能与转账非常相似，但这里您还需要测试支出者是否有足够的批准余额用于发送。

这里是测试当挥霍者没有足够的资金转让。

#### 检查批准

**批准**功能是 ERC20 标准中最简单的功能。没有必要检查零地址。检查津贴数组是否正确填充就足够了。另外，如果您没有 increaseApproval 或 decreaseApproval 函数，approve 将覆盖所有以前的值。

因此建议使用这些函数来防止不必要覆盖。当然，检查是否从批准事件中获得了正确的日志也很重要。

#### 燃烧未售出的代币

大多数智能合约都包括一个功能，用于在主销售结束后烧掉剩余的代币。他们中的许多人都有一个特殊的代币持有者帐户，有时是所有者帐户。因此，焚烧未售出代币的最佳解决方案如下:

*   获取持有人地址的代币数量
*   然后从总供应量中减去这个数量
*   并将持有者地址上的代币数量设置为零。

这将确保您不会烧掉所有令牌，因此在白皮书中列出令牌烧掉策略非常重要。

#### 结论

在将智能合约部署到主网络之前，对其进行测试非常重要，这样可以防止将来出现问题。当你编写单元测试时，他们会保证你的白皮书和智能合约之间不会有任何差异，你的智能合约不会被调用*应该*有正确权限而*没有*的函数所破解。

不仅仅是智能合约:你需要对你所有的应用和代码进行单元测试，因为它向你展示了你的应用可能失败的所有方式。