# 什么是跨站点脚本？如何防范 XSS 病毒的攻击

> 原文：<https://www.freecodecamp.org/news/cross-site-scripting-what-is-xss/>

跨站点脚本是开源应用程序安全基金会(OWASP)十大问题中第二个最普遍的问题——大约 2/3 的应用程序中都有跨站点脚本。

虽然自动化工具可以发现其中的一些问题，但也有一些自动化工具可以检测和利用这些漏洞。

## 什么是跨站点脚本？

当数据通过不可信的来源(如 web 请求)进入 web 应用程序，并且未经验证就发送给用户时，就会发生 XSS 攻击。

XSS 可以导致脚本在用户的浏览器中执行，从而导致会话被劫持、网站损坏以及用户被重定向到恶意站点。

本质上，攻击者将恶意代码输入到用户输入部分，服务器期望该部分是数据(但实际上是被设计来执行的代码)。

如果处理不当，恶意代码可能会突破“数据平面”，像正常代码一样执行(“控制平面”)。

我们可以将大多数 XSS 攻击分为两类:存储攻击和反射攻击。第三种类型不太常见，称为基于 DOM 的 XSS。

当数据通过不可信的来源进入并被发送给用户(以动态内容的形式)而没有被检查恶意内容时，任何 XSS 攻击都会发生。恶意内容可以是 JavaScript、Flash、HTML 或浏览器能够执行的任何其他代码。

### 反映 XSS(影响:中等)

这是最基本的 XSS 类型，其中应用程序接收数据，然后以不安全的方式将该数据包含在对用户的响应中。

例如，如果攻击者说服用户单击此网络钓鱼链接:

http://legitwebsite.com/message=

如果合法网站不处理数据，只是将数据返回给用户，用户的浏览器就会执行恶意代码。

### 储存的 XSS(影响:严重)

当注入永久存储在目标服务器上时，会发生存储 XSS，例如论坛或评论区中的消息、数据库等。本质上，这意味着该漏洞会影响网站/应用程序的每个访问者。

例如，如果网站允许用户发表评论，然后显示他们的评论，用户可以输入以下内容:

如果站点没有正确检查用户输入，可能会导致脚本为看到此消息的任何其他用户执行。

### 基于 DOM 的 XSS/客户端 XSS(影响:中等)

反射式和存储式 XSS 与基于 DOM 的最大区别在于攻击注入的位置。

反射和存储 XSS 是服务器端的问题，而基于 DOM 是客户端(浏览器)的问题。基于 DOM 的 XSS 出现在 DOM(文档对象模型)中，而不是作为 HTML 的一部分。

这种攻击不是在页面中插入恶意代码，而是允许加载合法页面，然后利用用户输入向页面添加 HTML，执行恶意脚本。这利用了客户端生成的 HTML 数量不断增加的优势。

例如，攻击者可以通过社交工程让受害者点击恶意链接(如 http://www.legitimatewebsite.com/contact#)。网站将接收对页面的合法请求，但不会接收恶意片段(因为浏览器不会向站点的服务器发送#字符之后的任何内容)。受害者将看到合法网站，但受害者的浏览器也会执行恶意脚本。

由于这种攻击的工作方式，服务器端的保护不会阻止它，因为恶意代码根本不会被发送到服务器。

相反，防范这种攻击需要确保 JavaScript 不会以不安全的方式解释 URI 片段(统一资源标识符——URI 标识指定位置的资源，如 URL)。

## 针对 XSS 袭击的缓解措施

有效防范 XSS 攻击需要以下措施的组合，当您一起使用它们时，可以提供对 XSS 的强大防御。

### 避免在指定位置以外的任何地方插入用户提供的/不可信的数据

这是第一条也是最重要的规则。编码、转义、验证和过滤输入是极其困难和复杂的。

限制人们可以输入不可信数据的地方的数量要容易得多。最安全的假设是所有不可信的数据都是恶意的。

### 验证/过滤输入

理想情况下，所有输入都应该根据可接受值列表进行验证。

### 编码输出

任何用户输入的数据都应该进行编码，以防止被读取为活动数据。这可能需要 CSS、JavaScript、URL 和/或 HTML 编码。

尤其重要的是，要确保输出在任何公开的地方都经过编码，因为相同的数据可能会在多个地方存储和显示。

### 谨慎选择框架

使用提供自动转义功能的框架(如 Go 模板)或那些对 XSS 有本地防御的框架(如。NET 的请求验证)。

### 设置 HttpOnly 标志

XSS 攻击经常使用 JavaScript 来窃取会话 cookie(而普通的 web 应用很少需要使用 JavaScript 来访问会话 cookie)。因此，设置 HttpOnly 标志可以保护会话 cookies 免受攻击者的攻击，同时不会限制正常行为。大多数浏览器都支持设置这个标志。

### 使用响应标题

与 HttpOnly 标志类似，任何不应该包含 HTML 或 JavaScript 的 HTTP 响应都可以利用“Content-Type”和“X-Content-Type-Options”头来确保浏览器只以预期的方式解释响应。

### 对开发人员进行安全教育

专门针对开发人员的教育非常重要，例如将应用程序安全团队成员与开发人员配对的“安全冠军”计划。他们可以帮助开发人员了解安全漏洞(如 XSS)以及如何预防。

### 制定内容安全政策

内容安全策略(CSP)可以帮助您检测和缓解 XSS 和其他数据注入攻击。

它们为可信内容的来源设置允许列表，并且只能应用于敏感页面(如支付页面)，或者理想情况下，应用于整个网站。如果内容是从不应该加载的页面加载的，它们甚至可以提供通知。

它们很容易部署——只需将内容安全策略 HTTP 头和任何适当的指令添加到网页中。

CSP Fiddler 扩展可以帮助你生成一个基线 CSP。该工具将围绕浏览器提交的报告构建一个策略，创建一个可变的基线策略。

此外，您可以使用 Troy Hunt 和 Scott Helme 运行的[报告 URI](https://report-uri.com/) ，获取 CSP 违规警报，以便更主动地监控您的站点。

通常，策略由一系列指令组成，这些指令将描述针对一种类型的资源或区域的策略。其中一个指令是子资源完整性检查，用于确保浏览器验证第三方内容(来自 CDN 之类的源)是在没有被操纵的情况下交付的。

本质上，提供的加密哈希必须与加载的文件匹配。如果黑客修改了第三方的内容，网站就不会加载恶意内容。

问题是，如果内容提供者更新了文件或进行了合法的更改，内容也不会被加载(因为哈希已经更改)。

解决此问题的主要方法是利用版本化的 JavaScript 资源，如 chatbot_0.1.23.js，而不是 chatbot.js。这通常是一种最佳做法，如果 js 文件发生变化，它还可以确保服务的连续性。

虽然浏览器并不普遍支持这一功能，但对于那些缺乏这一功能的浏览器来说，使用它不会破坏网站(它只是不会利用这项技术)。

有关各种指令的更多细节，请查看这些 [指南](https://content-security-policy.com/)。

### 来源/延伸阅读:

*   【Troy Hunt 的跨站点脚本
*   [理解 XSS 输入净化语义和输出编码上下文](https://www.troyhunt.com/understanding-xss-input-sanitisation/)
*   奥瓦斯普 XSS
*   [XSS 的 OWASP 类型](https://owasp.org/www-community/Types_of_Cross-Site_Scripting)
*   [OWASP 跨站点脚本防御](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html#rule-8-prevent-dom-based-xss)
*   [OWASP 基于 DOM 的 XSS](https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html)
*   [Acunetix 跨站点脚本](https://www.acunetix.com/websitesecurity/cross-site-scripting/)
*   XSS 港口巨头
*   XSS