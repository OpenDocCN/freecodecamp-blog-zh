# 陷入遗留代码地狱？这里有一些想法可以帮助你处理这种情况

> 原文：<https://www.freecodecamp.org/news/few-thoughts-on-legacy-hell-e229f76529e0/>

菲利普·洛佩斯

# 陷入遗留代码地狱？这里有一些想法可以帮助你处理这种情况

![zfY9sWtM7XpUaCnDuAgYxXq4JYVCHsHTMXBK](img/96eabec2f5c74d36bbe6a9b2ae8d7814.png)

Photo by [Caroline Methot](https://unsplash.com/photos/Se7fVNa9IXc?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

我将告诉你一个小故事，关于我是如何结束一个遗留代码项目的，以及我们的团队是如何从中获得最佳收益的。

### 首先，简单介绍一下背景

我在一个项目上工作了将近一年，退一步说，这个项目相当复杂。

当我在 Medium 阅读世界各地人们在软件工程领域所做的令人惊叹的事情(创建大型基础设施，整合几个尖端系统以响应每秒成千上万的请求)时，作为一名软件工程师，我日常生活的一部分并不那么迷人。也就是保持旧平台的旧扩展正常运行。

简单地说，我深受遗留代码之苦。

首先，让我告诉你关于明亮的堆栈。这个扩展是为了运行在最重要的电子商务平台之一， [Magento](https://magento.com/) 。但是 Magento 发布了平台的新版本(2.0)，有很多改进，实现了后端开发者希望看到的大多数好的实践。

对我来说，如果扩展是为最新的 Magento 版本做的就太好了，但是扩展是为之前的版本(1.9)开发的。一个古老的，很多时候不必要的复杂，繁琐，充满了错综复杂的 xml 文件。但它确实起作用了。哦，天啊，真的！

除此之外，正如您所料，这个扩展是用 PHP 编写的，这是一种人人都讨厌的语言。

尽管 PHP 在最新的 7.x 版本中得到了很多改进，但 Magento 1.9 不支持它，我被迫使用旧的 PHP 版本。因此，我不能玩所有的新东西。为了完成对场景的解释，没有一个单独的测试。我和团队中的任何人都没有参与最初的扩展设计和开发。开始的时候，大部分时间，我们有点迷失。

### 绕圈跑和尖叫不是一个选项

当你开始在这样的项目中工作时，你会觉得那些家伙在演奏泰坦尼克号的最后一首歌。一切都分崩离析，但你继续做你的工作。

客户不断开罚单，问题似乎永远不会得到解决。你老板要求新功能。你开始责怪平台、代码库(你甚至不知道是谁写的，你开始因此讨厌他们)。在这一点上，你深深地陷入了遗产地狱。

在这里你可以做两件事。第一个是更新你的 Linkedin 个人资料，放一张漂亮的照片，讲述一个关于你有多好的故事，并开始发送简历。寻找一份新工作，一份没有遗留代码的工作(剧透一下，这个地方不存在)或者你可以停下来，喘口气，制定一个计划来处理这件事。

### 开始做点什么吧

![jxhrSA2A9s8felRM-frky-yPewds0lZFA3R7](img/84b7d768431348a2989edd9b74a928bf.png)

Photo by [Yung Chang](https://unsplash.com/photos/qAShc5SV83M?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

如果你正处于这种情况，你应该开始快速行动。如果你的代码库不在源代码版本系统下(请使用 git ),并且你的团队不使用工具来管理任务，也许你应该考虑 Linkedin 的东西。但是如果你有最小的，从基本的开始，去掉 [cruft](https://www.techopedia.com/definition/15410/cruft) 。

我很确定有被否决的代码，根本没有达到的代码，和被留下的代码。只是占用空间，让事情看起来比实际情况更糟。给代码一个好的外观，修补它，用断点填充它，并开始删除那些没有被使用的。确保你没有做任何愚蠢的事情，不要夸大其词。请记住，还没有测试，所以只有摆脱那些你完全**确定**没用的方法。

这样做，你会对你的代码库更舒服，你可能会感觉更自信。在那之后，你仍然会有不必要的代码，但是几乎所有的代码都是有意义的，或者是有用的。

下一步是考虑测试。测试软件有几种方法。你可以进行单元测试、集成测试、系统测试、压力测试等等。它们很棒，应该在正确的时间使用。但请记住，你正处于关键时刻，你应该从真正重要的事情开始。功能测试。

我不是最熟练的测试者。远非如此。我还有很多要学习和研究的。但是据我所知，功能测试(至少对于 web 项目来说)是最不具侵入性的。你不必创造模仿，存根，假货，假人。您的测试将与浏览器进行交互，并模拟人与人之间的交互。

此时，您已经有了一个代码库，其中只有所需的代码和少量的测试来帮助您停止在每个新特性中添加新的 bug。这是一个双赢的局面。现在你可以停下来，深呼吸，更冷静地思考。

### 接下来呢？

![6R3e-PyHQpIrCFWPlPpxLYGtp3X3Za7Xv5pn](img/bc7f9f04abe2273c2ad43b755d9c6687.png)

Photo by [Patryk Grądys](https://unsplash.com/photos/4pPzKfd6BEg?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

有了更多的时间，更少的错误和理智，你就可以开始处理其他问题了。有没有想过持续集成？你的团队开发工作流程如何？如果你正在使用 git(我希望如此)，你可以开始规划你的分支。创建主分支、开发分支，通过功能分支、热修复分支等添加新功能。

你的连续交货情况如何？你的版本是如何创建的？如果你要做的不仅仅是“按一个按钮”，也许是时候考虑一下这个过程了。如何让它更可靠，更不容易出错？您的应用程序生成了足够多的日志吗？你能改进吗？现在是时候创造一个更好的软件了，现在就看你的了。

### 好了

我们仍在为我们的遗产努力，试图让它变得更好。虽然我们还没有达到理想的场景，但一些事情已经发生了变化。现在我们只有必要的代码。该特定扩展的工作流被很好地定义。我们已经进行了功能测试，部署过程也越来越好。

在改变了那个场景并从遗留的地狱中幸存下来后，我们的团队得到了开发旧 Magento 1.9 的新扩展的任务。任何正常人都会对此感到愤怒，但我认为这是做正确事情的最佳时机。这是一个机会，可以让所有的抱怨成为最佳实践，并在头脑中创建一个具有可维护性的软件。但是这是另一篇文章的主题。