# 如何用 Python 建立虚拟环境——以及它为什么有用

> 原文：<https://www.freecodecamp.org/news/how-to-setup-virtual-environments-in-python/>

当使用 Python 开发软件时，一个基本的方法是在您的机器上安装 Python，通过终端安装您需要的所有库，在一个单独的。py 文件或笔记本，并在终端中运行您的 Python 程序。

这是许多初学者和从使用 Python 进行数据分析过渡过来的人的常用方法。

这对于简单的 Python 脚本项目来说很好。但是在复杂的软件开发项目中，比如构建一个 Python 库、一个 API 或者软件开发工具包，通常你会处理多个文件、多个包和依赖项。因此，您需要为这个特定的项目隔离您的 Python 开发环境。

考虑这个场景:您正在使用系统安装的 Python 处理 app A，并且您将 packageX 版 pip 安装到您的全局 Python 库。然后您在本地机器上切换到项目 B，您安装相同的 packageX，但是版本 2.0，在版本 1.0 和 2.0 之间有一些突破性的变化。

当你返回运行你的应用程序 A 时，你得到各种各样的错误，你的应用程序不能运行。这是您在使用 Python 构建软件时可能会遇到的场景。为了解决这个问题，我们可以使用虚拟环境。

本教程将涵盖你需要了解的关于虚拟环境的一切，以及如何用 **Virtualenv** 设置虚拟环境。

## 什么是虚拟环境？

Python 的官方文档说:

> 虚拟环境是一种 Python 环境，其中安装的 Python 解释器、库和脚本与其他虚拟环境中安装的解释器、库和脚本以及(默认情况下)安装在“系统”Python(即作为操作系统的一部分安装的系统)中的任何库相隔离

为了打破这一点，当您为您的项目激活一个虚拟环境时，您的项目将成为它自己的自包含应用程序，独立于系统安装的 Python 及其模块。

您的新虚拟环境有自己的 pip 来安装库，有自己的 libraries 文件夹，其中添加了新的库，还有自己的 Python 解释器，用于您用来激活环境的 Python 版本。

在这个新环境中，您的应用程序变得独立，您将获得一些好处，例如:

*   您的开发环境包含在您的项目中，变得独立，并且不会干扰您系统中安装的 Python 或其他虚拟环境
*   您可以为多个 Python 版本创建新的虚拟环境
*   您可以在没有管理员权限的情况下将包下载到项目中
*   您可以轻松地打包您的应用程序，并与其他开发人员共享以进行复制
*   您可以很容易地在一个文件中为您的项目创建一个依赖项和子依赖项的列表，这使得其他开发人员可以很容易地复制和安装您的环境中使用的所有依赖项

对于通常由单个 Python 脚本发展而来的软件开发项目，建议使用虚拟环境，Python 提供了多种创建和使用虚拟环境的方法。

在下面的章节中，我们将介绍如何使用 **venv** 来设置您的虚拟环境，这将为您提供对您的环境的更多底层控制。

另一种设置虚拟环境的常见方法是使用 **pipenv** ，这是一种更高级的方法。

## 如何使用 Venv 安装虚拟环境

Virtualenv 是一个设置 Python 环境的工具。从 Python 3.3 开始，它的一个子集被集成到 venv 模块下的标准库中。您可以通过在终端中运行以下命令将 venv 安装到您的主机 Python 中:

```
pip install virtualenv
```

要在您的项目中使用 venv，请在您的终端中创建一个新的项目文件夹，cd 到您终端中的项目文件夹，然后运行以下命令:

```
 python<version> -m venv <virtual-environment-name>
```

像这样:

```
 mkdir projectA
 cd projectA
 python3.8 -m venv env
```

当您检查新的 projectA 文件夹时，您会注意到已经创建了一个名为 **env** 的新文件夹。env 是我们的虚拟环境的名称，但是它可以被命名为您想要的任何名称。

如果我们检查一下 env 的内容，在 Mac 上你会看到一个 bin 文件夹。您还将看到通常用于控制您的虚拟环境的脚本，例如用于安装库的 activate 和 pip，以及用于您安装的 Python 版本的 Python 解释器，等等。(在 windows 上，该文件夹将被称为脚本)。

lib 文件夹将包含您已安装的库的列表。如果您查看一下，就会看到虚拟环境默认附带的库列表。

## 如何激活虚拟环境

现在您已经创建了虚拟环境，您需要在您的项目中使用它之前激活它。在 mac 上，要激活您的虚拟环境，请运行以下代码:

```
source env/bin/activate
```

这将激活您的虚拟环境。很快，您会注意到您的终端路径包含 env，表示一个激活的虚拟环境。

请注意，要在 Widows 上激活您的虚拟环境，您需要运行下面的代码(参见此[链接](https://docs.python.org/3/library/venv.html)以全面了解平台之间的差异):

```
 env/Scripts/activate.bat //In CMD
 env/Scripts/Activate.ps1 //In Powershel
```

## 虚拟环境在工作吗？

我们已经激活了我们的虚拟环境，现在我们如何确认我们的项目实际上是与我们的主机 Python 隔离的呢？我们可以做几件事。

首先，我们通过在激活的虚拟环境中运行下面的代码来检查虚拟环境中安装的包的列表。您将只注意到两个包——pip 和 setuptools，它们是新虚拟环境中默认提供的基础包

```
pip list
```

接下来，您可以在尚未激活虚拟环境的新终端中运行上述代码。您将会注意到您的主机 Python 中有更多您过去可能安装过的库。在安装这些库之前，它们不是 Python 虚拟环境的一部分。

## 如何在虚拟环境中安装库

要安装新的库，您可以轻松地安装库。虚拟环境会利用自己的 pip，所以不需要使用 pip3。

安装所需的库后，可以使用 pip list 查看所有已安装的库，或者可以通过运行以下代码生成一个列出所有项目依赖项的文本文件:

```
pip freeze > requirements.txt
```

您可以随意命名这个 requirements.txt 文件。

## 需求文件

为什么需求文件对你的项目很重要？假设您将项目打包在一个 zip 文件(**中，没有 env 文件夹**)中，并与您的开发人员朋友共享。

要重新创建您的开发环境，您的朋友只需按照上述步骤激活一个新的虚拟环境。

他们不必一个接一个地安装每个依赖项，只需运行下面的代码，就可以在他们自己的项目副本中安装所有的依赖项:

```
 ~ pip install -r requirements.txt
```

请注意，通常不建议共享您的 env 文件夹，它应该很容易在任何新环境中复制。

通常，您的 env 目录将包含在一个. gitignore 文件中(当使用 GitHub 这样的版本控制平台时),以确保环境文件不会被推送到项目存储库中。

## 如何停用虚拟环境

要停用虚拟环境，只需在终端中运行以下代码:

```
 ~ deactivate
```

## 结论

Python 虚拟环境使您能够将 Python 开发项目与系统安装的 Python 和其他 Python 环境隔离开来。这使您可以完全控制您的项目，并使其易于重现。

当开发通常由简单的。py script 或 Jupyter 笔记本，使用虚拟环境是个好主意——现在你知道如何设置并开始使用虚拟环境了。