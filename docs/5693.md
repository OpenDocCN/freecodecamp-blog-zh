# 测试驱动开发的实用介绍

> 原文：<https://www.freecodecamp.org/news/practical-tdd-test-driven-development-84a32044ed0b/>

卢卡·皮奇尼利

#### 测试驱动开发很难！这是不为人知的真相。

最近，你阅读了大量关于进行测试驱动开发(TDD)的好处的文章。你可能会在科技会议上听到很多告诉你“做测试吧！”，以及做这些事情有多酷。

你知道吗？不幸的是，他们是对的(不一定是关于“酷”的部分，而是关于有用的部分)。测试是必须的！当谈到 TDD 时，我们列出的典型优势是真实的:

*   你写出更好的软件
*   当引入新功能时，您可以免受破坏
*   您的软件是自我记录的
*   你避免过度工程化

即使我一直认同这些优点，但曾经有一段时间我认为我不需要 TDD 来编写好的和可维护的软件。当然，现在我知道我错了，但为什么尽管职业选手们有闪亮的魔力，我还是会有这个想法？原因只有一个:让我请蕾哈娜替我说…

### **成本！**

花费很大！可能有人在想“*但是如果你不做测试的话成本会更高*”——这也是对的。但是这两种成本出现的时间不同:

*   你做 TDD ➡你现在有成本了。
*   如果你不做 TDD ➡，你将会在未来付出代价。

那么，我们如何走出这个僵局呢？

完成一件事最有效的方法是尽可能自然地去做。人们的本性是懒惰(这里软件开发人员是最好的执行者)和贪婪，所以你必须找到你的方式**降低成本**。说起来容易，做起来却很难！

在这里，我将分享我的经验，以及让我的收益/成本比变得对我有利的方法。

但在此之前，让我们分析一下应用 TDD 的一些典型困难。

### 你能测试两个数的和吗？

一般来说，理论不是可有可无的；你必须掌握它，才能掌握实践。然而，试图立刻应用你以前获得的所有理论知识可能会产生以下效果:

关于 TDD 的典型理论课是这样开始的:

你就像这样

接下来是这个:

*   红色➡绿色➡重构循环
*   单元、验收、回归、集成测试
*   嘲讽，存根，假货
*   如果你很幸运(也可能不幸运？)，会有人告诉你契约测试
*   如果你非常幸运(或者非常不幸？)您将接触到遗留代码库重构

事情会变得艰难，但是你是一个有经验的开发人员，所有这些概念对你来说并不难处理。然后下课；你回家，在接下来的几天里，你勤奋地做一些代码形来修正刚刚学到的概念。到目前为止一切顺利。

#### 斗争是真实的

接下来是一个真实世界的项目，有真实的截止日期和真实的时间成本——但是你被激励去应用你闪亮的新 TDD。你开始考虑你的软件的架构，并开始为第一个类和类本身编写测试——让我们称之为 **Class1** 。

现在你想想 Class1 的第一个用户，让我们称之为 **UsageOfAClass，**你再次测试并编写它。Class1 是 UsageOfAClass 的合作者，所以你打算嘲讽它吗？好吧，让我们嘲笑它。但是 Class1 和 UsageOfAClass 的真实交互呢？也许你也应该全部测试一下？让我们开始吧。

在这一点上，在你的内心，你开始听到一个小小的声音，说“*我* *如果我不用写这些测试，会发展得更快……*”。你不听这个邪恶的声音，直接进行下一个测试。

UsageOfAClass 将使用 Class2 ,它将自己保存在 Db 中。那么，我们必须测试 Class2，它与 UsageOfAClass 的交互，以及 Db 中的持久性吗？但是等等…有没有人在 TDD 理论课上提到如何应对 I/O 测试？

TDD 背后的理论并不难理解，但是如果方法不对，将它应用到现实世界中会非常复杂。

### 就这么干吧

我们应该永远记住，理论必须符合我们的需要，而不是相反。

主要目标是完成工作。所以我的建议是，**就这么做**！

从简单开始，坚持完成你的任务。然后，当你陷入某种理论思维循环时，比如:

*   这是单元测试还是集成测试？
*   我该不该嘲笑它？
*   哦，废话，这里我应该写一个新的合作者，所以一个全新的无限单元测试套件只是为了写“嘿，香蕉”…

暂时忘掉理论，向前迈出一步。顺其自然吧！

一旦你完成了任务，回头看看你的工作。回顾已经完成的工作，分析什么是正确的事情会容易得多。

### 实用 TDD

去做吧。顺便说一下，我认为这也是正确的 TDD 方法。

我们构建 Class1、Class2 和 UsageOfAClass 的方式有什么问题？**走近。**

这是一种自下而上的方法:

*   分析问题
*   想出一个架构
*   从单元组件开始构建

这种做法是**过度工程**的最好朋友。你通常构建系统是为了防止你认为将来会发生的变化，而不知道它们是否真的会发生。然后，当一些需求改变时，它通常以不适合你的结构的方式发生，不管它有多好。

对我来说,**大幅降低使用 TDD 写作的直接成本的关键是采取自上而下的方法:**

1.  带来一个用户故事
2.  编写一个非常简单的用例测试
3.  让它跑起来
4.  回到步骤 2，直到所有用例完成

在进行这个过程时，不要太担心架构、干净的代码(好吧，记住至少要使用体面的变量名)或任何当前不需要的复杂情况。现在就做你知道你需要的事情，直到最后。

故事的测试清楚地陈述了什么是当前的和已知的需求。

一旦你完成了，看看你的大球意大利面泥代码，克服耻辱，并深入看看你做了什么:

*   有用！测试证明了这一点。
*   所有的系统都在那里，**以及完成工作真正需要的东西**。

现在您已经对系统的所有部分有了一个总体的了解，因此您可以利用您从零开始时无法获得的领域知识进行重构。测试将确保在重构过程中不会出现任何问题。

### 重构

对我来说，开始重构的最好方法是确定责任范围，并在私有方法中分离它们。这一步有助于确定职责及其输入和输出。

之后，合作者的类就差不多了，你只需要把它们转移到不同的文件中。

在进行过程中，首先为从过程中跳出的类编写测试，并迭代直到您对结果满意为止。记住，如果你在某个地方卡住了，就去做！如果你做了坏事，一旦你做了，你会有更多的信息告诉你下次面对时如何克服错误。尽你目前的最大能力，完成工作是首要任务。

这样，如果你分析自己的错误并从中吸取教训，你也会提高自己的能力。

### 下一个用户故事

按照以下步骤继续开发您的产品:

*   拿一个故事
*   让它完全在一个“测试—编码”循环中工作。
*   重构

在添加功能的同时，你将继续改变你的软件，甚至可能改变它的结构。但是随着系统的增长，变化的成本将保持线性增长，这要归功于 TDD 的两个主要特性:

*   架构发现(有助于控制复杂性)
*   防止重大变更

这个系统不会被过度设计，因为建筑会随着故事的完成而出现。你不考虑未来的需求是什么；如果你最终需要它，那么实现它的成本将会很低。

#### 什么会让它出错？

故事的规模。你最终建造的东西必须是合适的尺寸。不要太大(否则会花太多时间来获得反馈)或太小(否则你不会有概述)。

故事太大怎么办？把它分成可以从头到尾建造的小块。

### 下一步是什么？

在下一篇文章中，我将给出一个我在这里解释的概念的实际例子。我们将从验收测试开始，一步一步地实现[保龄球游戏 kata](http://butunclebob.com/ArticleS.UncleBob.TheBowlingGameKata) 。

这不是一个现实世界的问题，但是它有足够的复杂性，可以看到 TDD 如何帮助处理它。

请分享你对这篇文章的看法和建议。你同意我还是认为这一切都是一堆垃圾？在评论中让我知道你的想法；在 TDD 上开始一个对话并分享我们的经验是非常好的。

我要感谢 Matteo Baglini 帮助我找到了软件开发和 TDD 的实用方法。

感谢您的阅读！

封面图片由 [testsigma](https://testsigma.com/blog/ai-driven-test-automation/) 提供。