# 如何使用 Selenium 和 Python 更有效地抓取网站

> 原文：<https://www.freecodecamp.org/news/improve-web-scraping-with-selenium/>

当您使用 Python 从 web 上抓取数据时，Selenium 通常会成为一个有用的工具。它最初是为自动化测试而设计的，但是它的抓取能力也令人印象深刻。

这是因为 Selenium 在收集数据时可以做其他库或框架通常不能做的事情:访问 JavaScript 呈现的内容，并以基本上任何您想要的方式与页面交互。

这篇文章是关于第二种能力——以你想要的方式与页面交互。它将涵盖三个有用的主题，让你在与网站互动以访问其内容时有更多的选择。

虽然本文关注的是 web 抓取，但这只是这些技巧的一个用例，因为您可以在任何需要 Selenium 的任务中实现它们。

在我们开始之前，一个重要的免责声明:在开始抓取任何网站之前，请确保检查该网站是否允许您这样做。此外，这是一个很好的做法，以配置您的刮刀，以不超载网站的服务器，因为我们不打算造成任何伤害。

抓取很有趣，也是收集数据的好方法，但需要以正确合法的方式进行。

## 如何标记复选框

抓取数据的过程不仅仅是抓取数据。有时，您需要浏览网站才能找到数据所在的位置。例如，当浏览网站时，你可能需要填写一些表格，点击一两个按钮，并标记一个复选框。

标记一个复选框可能看起来是一个非常简单的动作，但是可能有点棘手。这是因为您可能认为您需要做的就是使用 Xpath 定位元素，然后使用`click`方法点击它。

是的，这取决于网站的情况，但这不是规则。对于大多数网站，Selenium 不会将复选框识别为可点击的按钮。所以当你试图点击它的时候，会出现一个异常。

解决方法是找到元素，使用 ActionChains 对象将光标移动到复选框，然后单击它。下面是实现这一点的代码:

```
check_box = driver.find_element_by_xpath('Xpath')

actions = webdriver.ActionChains(driver)
actions.move_to_element_with_offset(check_box, -5, 5).perform()
actions.click().perform()
```

`move_to_element_with_offset`方法将鼠标移动页面上相对于左上角的特定元素的偏移量。您需要告知元素以及您希望光标离开左上角的距离。

目标是将光标放在复选框的中间。为了找到合适的移动距离，在运行完整的代码之前，执行带有元素的`size`属性的代码。

```
check_box = driver.find_element_by_xpath('Xpath')
print(check_box.size)
```

输出应该如下所示:

`{'height': 10, 'width': 10}`

然后，移动光标后，您只需单击一下，复选框就会被选中。

## 如何处理框架

您可能发现自己处于这样一种情况，即您无法让 Selenium 在网页上找到某个特定的元素。无论您如何尝试——通过使用 Xpath、类名或其他方式——您总是会得到错误。

所以你一遍又一遍地检查代码中的错误，但一切似乎都很好。那到底怎么了？

其实也没什么不好。您想要收集的数据或想要与之交互的元素就在页面上的另一个框架中。我们使用 HTML 框架将页面分成几个部分，每个部分加载内容的不同部分。

要解决此问题，您只需在再次尝试与页面交互之前切换到正确的框架。如果您知道框架的名称，只需这样做:

```
driver.switch_to.frame('mainIframe')
```

您也可以使用帧的索引来进行切换:

```
driver.switch_to.frame(0)
```

但是，如果您不知道框架的名称或页面上有多少个框架，解决方法是找到页面上的所有框架，然后打印每个框架的名称。它是这样工作的:

```
frames = driver.find_elements_by_tag_name('iframe')
for frame in frames:
   print(frame.get_attribute('name')) 
```

要找出页面上有多少帧，只需打印出`frames`对象的长度。

```
print(len(frames))
```

现在，您可以自由地与页面交互并收集您需要的数据。

## 如何切换选项卡

在浏览网站收集数据时，您可能会遇到的另一种常见情况是，按钮会自动打开一个新标签。当这种情况发生时，知道如何从一个选项卡转到另一个选项卡以获得您需要的数据是很重要的。

幸运的是，用 Selenium 处理标签并不是一个复杂的过程。实际上，这有点类似于处理框架。

您可以使用一种更质朴的方法，使用两个对象:一个包含当前选项卡，另一个包含所有选项卡。然后你只需要迭代第二个，迭代器和你刚才切换的标签不同。

```
current_tab = driver.current_window_handle

all_tabs = driver.window_handles
for tab in all_tabs:
   if tab!= current_tab:
       driver.switch_to.window(tab)
```

但是，如果你有两个以上的标签，并希望能够在任何需要的时候访问其中的任何一个，有一种更优雅的方法——你只需要记住标签打开的顺序。

对于这种方法，您不需要知道当前的选项卡。这是因为您只需在包含所有选项卡的对象中选择要移动到的选项卡的相应索引，就可以切换选项卡。

```
driver.switch_to.window(all_tabs[i])
```

如果您想一次遍历所有的选项卡，执行操作并从每个选项卡中收集数据，您也可以轻松地遍历所有的选项卡。

```
all_tabs = driver.window_handles
for tab in all_tabs:
   driver.switch_to.window(tab)
```

然而，如果你打开更多的标签来抓取数据，并且你有很多链接要抓取，你应该意识到你对网站的请求比平常多得多。这是因为对于每个链接，你会打开两到三个新标签。

在这种情况下，您还需要在代码中插入一些随机暂停，以免服务器过载。你可能还想利用代理提供商，比如 [Infatica](https://infatica.io/) (一家致力于通过类似本文的文章分享信息的公司)，来确保只要还有页面需要清理，你的代码就会一直运行。

这还可以确保您不会被阻止，并且您和您的连接受到保护。

## 结论

希望这些硒的小技巧能帮助你更有效的使用和刮除。你还可以做更多的事情，但是我想尽量简短。

如果您对更多类似的内容感兴趣，或者如果您有问题、建议或只是想保持联系，请随时联系我们。说不定马上就有第二部了！