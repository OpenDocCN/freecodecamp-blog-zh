# 如何使用 Traceroute 和 Ping 命令排除网络连通性故障

> 原文：<https://www.freecodecamp.org/news/traceroute-and-ping/>

Ping 和 traceroute 是可以用来排除网络故障的常用命令。

Ping 是一个简单的命令，可以测试网络中设备的可达性。

Traceroute 命令用于“跟踪”数据包到达目的地时所采用的路由。它有助于跟踪网络问题，发现连接失败的地方，并跟踪延迟问题。

## ping 是如何工作的？

Ping 使用 ICMP(互联网控制消息协议)回送消息来查看远程主机是活动的还是非活动的，往返消息到达目标主机并返回需要多长时间，以及任何数据包丢失。

它发送一个请求并等待回复(如果目的地在超时期限内回复，它将收到回复)。

这基本上是一种快速、简单的方法来验证您是否可以到达互联网上的目的地。如果可以，太好了！如果没有，您可以使用 traceroute 来调查在您的设备和目的地之间的每一步发生了什么。

### ping 命令和结果示例:

主机名~ % ping-C5 www.google.com

PING www.google.com(216 . 58 . 212 . 228):56 个数据字节

*ping 命令，设置向 google.com 发送 5 个数据包。*

来自 216.58.212.228 的 64 个字节:icmp_seq=0 ttl=113 time=42.262 ms

来自 216.58.212.228 的 64 个字节:icmp_seq=1 ttl=113 time=34.796 ms

来自 216.58.212.228 的 64 个字节:icmp_seq=2 ttl=113 time=35.805 ms

来自 216.58.212.228 的 64 个字节:icmp_seq=3 ttl=113 time=45.299 ms

来自 216.58.212.228 的 64 个字节:icmp _ seq = 4 TTL = 113 time = 150.292 ms

*这显示了每个 ping 的结果，以及它们的往返时间(毫秒)。*

-www.google.com 乒统计数据-

发送 5 个数据包，接收 5 个数据包，0.0%数据包丢失

往返最小/平均/最大/标准偏差= 34.796/61.691/150.292/44.474 毫秒

整个测试的统计数据——到达目的地所需的最短时间、平均值、最大值和标准偏差。

## traceroute 是如何工作的？

默认情况下，traceroute 会发送三个数据包来测试每个“跳”(当数据包在路由器之间传递时，称为“跳”)。

它首先向目标主机上不可到达的端口发送 3 个数据包，每个数据包的生存时间(TTL)值为 1。这意味着一旦它遇到路径中的第一个路由器(在您的网络中)，它就会超时。当数据报过期时，第一台路由器将响应 ICMP 超时消息(TEM)。

然后发送另外 3 个数据报，TTL 设置为 2，导致路径中的第二个路由器(您的 ISP)用 ICMP TEM 响应。

这种情况会持续下去，直到数据报的 TTL 长度足以到达目的地。如果出现这种情况，由于消息被发送到无效端口，将返回 ICMP 端口不可达消息，表示跟踪路由已完成。

在这种情况下，错误消息实际上是预期的行为，而不是出现问题的迹象。

traceroute 最重要的部分通常是往返时间。理想情况下，您会在追踪过程中寻找一致的时间。

如果您看到某个特定跃点上的时间突然增加(延迟增加)，并且随着跟踪接近目标而继续增加，这可能表明从突然增加开始就出现了问题。

但是，如果中间的延迟增加，但在接近尾声时保持一致，或者延迟增加在接近尾声时减少，这不一定说明有问题。

如果您在跟踪开始时看到高延迟，这可能表明您的本地网络有问题。您应该与您的本地管理员(或您自己，如果您是自己的本地管理员)合作来修复它。默认情况下，Windows 使用 ICMP 传输数据，而 Linux 使用 UDP。

### traceroute 命令和结果示例:

主机名~ % traceroute www.google.com

到 www.google.com 的 traceroute(216 . 58 . 212 . 228)，最大 64 跳，52 字节数据包

到 google 的 traceroute 命令。

1 home router . CPE(192 . 168 . 8 . 1)10.129 毫秒 1.528 毫秒 1.373 毫秒

第一跳是在本地网络中。这里，我们有跳数(1)、域名/IP 地址(在这种情况下是一个家庭路由器)，然后是 RTT1、RTT2 和 RTT3(往返时间——数据包到达该跳并返回计算机所需的时间，以毫秒为单位)。这是跳的延迟。

有三个数字，因为默认情况下，该命令发送三个数据包。一般来说，在美国大陆旅行超过 150 毫秒是不常见的，尽管穿越海洋的信号可能会超过这个时间。

2  * * *

*跳 2:这样的星形有两种可能——要么是接收设备上没有配置 ICMP/UDP，它没有响应，要么是由于网络问题(如防火墙或数据包超时)数据包被丢弃。*

在这种情况下，由于它非常接近跟踪的开始，这很可能是由于设备没有配置为向 traceroute 发送响应。

3 192 . 168 . 213 . 21 26.641 毫秒 31.671 毫秒 26.824 毫秒

4 192 . 168 . 213 . 22 20.294 毫秒 22.496 毫秒 19.922 毫秒

5  * * *

6  * * *

*在跟踪的更远处，这些星星更有可能是由于目标的防火墙阻止请求(尽管在大多数情况下 HTTP 请求仍然能够被处理)、可能的连接问题或返回路径问题(也就是说，信号到达了路由器，但没有得到响应)。*

然后，跟踪将继续，直到到达目标。

## 包扎

总之，ping 是判断主机是否可以通过网络到达的一种(非常)快速的方法，而 traceroute 可以帮助您诊断连通性问题。

了解它们都是有用的命令，因为了解它们的工作方式以及输出的含义，在排除网络连接故障时会非常有帮助。

您还应该知道如何在网络或安全面试中使用它们，比如“ping 通过什么端口工作(这是一个棘手的问题，因为 ping 使用 ICMP)？”经常被问到。