# 为什么应该重构代码

> 原文：<https://www.freecodecamp.org/news/why-you-should-refactor-your-code/>

如果下列任一项听起来很熟悉，请举手:考虑代码格式化。去掉不必要的`<div>`和`<span>`，使用功能性的 React 组件。渲染时尽量避免箭头功能。不要重复你自己！

在我直接进入重构之前，我需要你回答一个简单的问题:开发一个应用程序意味着什么？通常，这意味着通过实现某些特性来生产一个满足需求的软件。

我们如何做到这一点？我们收集客户需求，估算需求，一个一个开发功能，对吧？差不多了。

## **不要忘记臭虫**

是的，错误确实会发生。根据开发过程、软件复杂性、技术堆栈和许多其他参数，错误的数量可能会有所不同。

企业无法承受生产中的重大问题。为了尽量减少问题，你应该特别注意 [QA 流程](https://keenethics.com/blog/qa-documentation) 。但是 QA 理论声称，通常不可能对你的应用程序进行 100%的测试覆盖，并为所有可能的场景做好准备。

尽管如此，为了达到最佳结果，团队花费大量时间测试软件和修复问题。这是每个客户都应该理解和优先考虑的流程的必要部分。

## **介意技术债务**

然而，这枚硬币也有反面。开发和测试过程花费的时间越长，你招致的技术债务就越多。

那么，“技术债”是什么意思呢？技术债务指的是代码中所有与质量相关的问题。将来需要花费额外资源的问题。

您因各种原因而招致技术债务，例如:

1.  企业推动更快地发布新功能。
2.  测试不充分。
3.  需求变化很快。
4.  开发人员缺乏经验。

技术债务应记录在案。如果你没有在代码中留下待办事项，你很可能会忘记这个问题。即使你将来有时间，你也不会记得去修理它。

## **理解重构的重要性**

通常，您需要花一些时间重构现有代码，以解决代码质量问题，从而降低技术债务。

但是什么是重构呢？它是在不改变现有代码外部行为的情况下对其进行重组的过程。对于管理项目的业务人员来说，这实际上可能很难理解。

> –我们会有新功能吗？
> 
> –不
> 
> –我们至少会修复一些 bug 吧？
> 
> ——也没有
> 
> ——那我们会得到什么呢？
> 
> –…

处理技术债务有助于避免错误。为了给项目添加修正或变更，我们总是需要阅读旧的代码。

因此，重构和保持良好的代码质量将有助于我们保持良好的开发进度。

有时企业可能不需要它。例如，如果你正在做一个原型或者概念验证[](https://keenethics.com/services-proof)，或者如果有不能调整的业务优先级，你可以不进行重构。

但是在大多数情况下，放弃重构并不是一件明智的事情。如果你的开发人员是完美主义者，你可能会花大量的时间在重构上，但是这也没有意义。

因此，你需要取得平衡。你花在重构上的时间不应该超过你将来节省的时间。

## **如何开始重构你的 React 代码**

### **考虑代码格式化**

有些人添加尾随逗号，有些人没有。有些使用单引号，而有些使用双引号。

如果你在一个团队中工作，维护公共代码风格可能真的很难。代码风格的不一致会让你的代码看起来很脏，难以阅读。

因此，如果您以前没有考虑过使用代码格式化工具，现在是时候这样做了。最流行和易用的 React 重构工具之一是[](https://prettier.io/)。你可以把它添加到项目中，它会自动为你设置格式。

Prettier 有一些默认的样式设置，但是你可以通过添加一个带有你的格式规则的`.prettierrc`文件来根据你的喜好改变它们。

一个好的`.prettierrc`设置可能是这样的:

```
`{ "printWidth": 120,  "singleQuote": true, “trailingComma”: “none” }`
```

你也可以在提交前用 [预提交钩子](https://prettier.io/docs/en/precommit.html) 自动重新格式化代码。

### **去掉不必要的<分区>和<跨度>的**

2017 年 11 月 React 16.2 发布时，很多 React 开发者都松了一口气。在此之前，对于返回子元素列表的组件，必须将子元素包装在一个额外的元素中，比如`<div>`或`<span>`。

但是在 React 16.2 中，我们获得了对返回组件子组件的改进支持。现在开发者可以使用所谓的片段。它们看起来像空的 JSX 标签。在片段的帮助下，您可以向组件传递子组件列表，而无需向 DOM 添加额外的节点。

### **想名字**

在考虑组件和变量的名字时，不要偷懒。每个名字都应该是不言自明的。

你见过这样的代码片段吗？

```
`const modifyData = data.map(x => [x.a, x.b]))`
```

它是做什么的？如果你不能从名字上理解一个变量的用途，那么是时候给它重新命名了！

这将帮助您和您的团队更容易理解其中的逻辑。它还将消除将来对现有组件进行更改所花费的时间。

### **不要重复自己**

DRY 原则是在《实用程序员》一书中首次提出的。它指出“每一项知识都必须在一个系统中有一个单一的、明确的、权威的表示”。换句话说，您需要将重复的代码块放入单独的可重用组件中。

让你的代码干燥有很多好处。它可以节省你很多时间。如果您将来需要更改此代码，您将只在一个地方进行更改。此外，您永远也不会担心自己忘记在某些地方进行更改。此外，您将保持组件的整洁并增加代码的可读性。

为了保持组件干燥小巧，您可以遵循两个简单的规则:

1.  如果你使用一个代码块超过两次，就该提取它了。
2.  如果您在一个组件中超过了预定义的行数(例如 100 行)，则可能有逻辑可以提取。按照功能把它分成更小的组件。

### **使用超类功能组件**

随着 React 16.8 中钩子的引入，我们可以访问功能组件中的 React 类特性。钩子解决了开发人员在过去几年中经常遇到的一系列问题。

例如，`useEffect`钩子，正如 React 文档所建议的，允许我们根据相关的部分将组件逻辑分组为小功能(而不是根据生命周期方法将逻辑分组)。这有助于我们更好地重组我们的逻辑。

总而言之，在钩子的帮助下，重构 React 组件使代码更加整洁，减少了需要编写的代码量。

下面是一个非常基本的例子:在组件挂载后获取数据，并基于更新的 props 重新获取数据。

在一个类组件中，我们应该这样写:

```
`class BookList extends React.Component {
  componentDidMount() {
    this.props.fetchBooks(this.props.bookGenre);
  }
  componentDidUpdate(prevProps) {
    if (prevProps.bookGenre !== this.props.booksGenre) {
      this.props.fetchBooks(this.props.bookGenre);
    }
  } 
// ... }`
```

使用 React 钩子，它看起来像这样:

```
`const BookList = ({ bookGenre, fetchBooks }) => {
  useEffect(() => {
    fetchBooks(bookGenre);
  }, [bookGenre]);
// ... }`
```

取书逻辑现在集中在一个地方。每次方括号内的道具`[bookGenre]`变化时`useEffect`挂钩都会在挂载后运行。干净多了，不是吗？

此外，您可以提取类似的有状态逻辑，并通过创建自定义挂钩在不同的组件中重用它。你可以在官方 [React 文档](https://reactjs.org/docs/hooks-custom.html) 中阅读更多关于自定义钩子的内容。

### **尽量避免渲染中的箭头功能**

你见过这样的代码吗？：

```
`render() {    
  return (
    <div>
      <button onClick={() => this.setState({ flag: true })} />
      ...      
    </div>    
  );  
}`
```

你当然有。它有什么问题？每次呈现一个组件时，都会创建一个此类函数的新实例。

如果组件被渲染一次或两次，这没什么大不了的。但在其他情况下，它确实会影响性能。因此，如果您关心性能，请在 render 中使用该函数之前声明它:

```
`changeFlag = () => this.setState({ flag: true })
render() {    
  return (      
    <div> 
      <button onClick={this.changeFlag} />        
      ...      
    </div>    
  );  
}`
```

### **使捆变小**

如果你使用的是第三方库，如果没有必要的话，你不应该加载整个库。有时，您可能会偶然发现某个导入只使用了库中的一种方法，例如:

```
`import lodash form 'lodash'  
...  
const certainProps = lodash.pick(userObject, ['name', 'email']);  ...`
```

相反，最好使用以下代码:

```
`import pick from 'lodash/pick' 
... 
const certainProps = pick(userObject, ['name', 'email']); ...`
```

现在，您不需要加载整个库，只需要加载您需要的方法。

## **总结**

让我们回顾一下重构 React 代码应该采取的步骤:

*   想想代码格式
*   去掉不必要的`<div>`和`<span>`
*   想想名字
*   不要重复你自己
*   使用功能性的超类组件
*   在渲染中尽量避免使用箭头功能
*   使包变小

然而，理想的重构是不发生的重构。作为一名开发人员，尤其是作为一名技术领导者，您应该提前考虑许多步骤，并尝试生成高质量的代码。您还应该定期进行代码审查，不仅在一个团队内部，而且在团队之间。

## 你对 React 项目有什么想法吗？

我的公司 KeenEthics 是一家经验丰富的反应发展公司。如果你准备用你的软件项目改变游戏，请随意向[请求一个估价](https://keenethics.com/services-web-development)。

你可以在我的博客上看到更多类似的文章。请允许我建议[用户测试](https://keenethics.com/blog/the-value-of-user-testing)或 [Angular vs React 的价值:为你的应用选择什么？](https://keenethics.com/blog/angular-vs-react-what-to-choose-for-your-app)

最重要的是，我想对杰出的 React 开发人员 Yaryna Korduba 和 Max Fedas 说“谢谢”,感谢他们共同撰写了这篇文章，也感谢读者坚持到最后！