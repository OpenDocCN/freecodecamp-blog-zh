# Kubernetes 安全–K8s 程序的常见漏洞和暴露

> 原文：<https://www.freecodecamp.org/news/kubernetes-security-common-vulnerabilities-and-exposures/>

Kubernetes 已经成为编排、扩展、自动化部署和管理容器化应用程序的首选工具。

简单地说，Kubernetes 是一个在一组机器上维护不同应用程序之间协调的系统。

值得注意的是，该系统主要处理容器化的应用程序，如 Docker 图像。这基本上是一种虚拟化形式，其中应用程序在称为**容器**的隔离用户空间中运行。

## 容器的安全问题

但是用户定义了应用程序应该如何运行以及如何与其他应用程序和外部世界交互的规则。任何涉及人为干预的事情都容易出现缺陷和错误。

错误的严重程度通常取决于管理容器的人员的技能。有时，即使是最轻微的错误也会破坏系统。一个显著的例子是 Java 中的 [Log4j 漏洞](https://theconversation.com/what-is-log4j-a-cybersecurity-expert-explains-the-latest-internet-vulnerability-how-bad-it-is-and-whats-at-stake-173896),它导致了最近互联网上的重大崩溃。

对于一个软件/应用程序来说，100%地免受攻击者的攻击通常是不可能的。但是这不应该错误地暗示有漏洞和弱点是可以的，并希望没有人注意到它们。

您应该始终寻找安全漏洞和暴露，并在可用时应用补丁程序。

这种缺陷可能会使集群或容器变得脆弱，从而允许未经授权的个人利用它们。随着 Kubernetes 越来越受欢迎，我们需要更仔细地考虑如何评估其功效和管理容器安全问题。

为了更好地保护您的 Kubernetes 配置和程序，让我们来看看一些常见的漏洞、暴露和 Kubernetes 安全最佳实践。

## 配置困境

![access-control-overview](img/8591a1449390736dec9132514e4d1387.png)

[Source](https://kubernetes.io/docs/concepts/security/controlling-access/)

如果您是 Kubernetes 世界的新手，并且您自己正在部署一个项目，那么您可能很难弄清楚安全配置规则。不幸的是，这是因为 Kubernetes 在这种情况下没有提供足够安全的默认配置规则。

尽管当您试图控制环境时，安全配置并不十分重要，但在部署到生产环境的后期阶段，它变得至关重要。

类似的问题也存在于 pod 之间的通信方式上。这些通信权限是由网络策略定义的，但默认情况下没有此类策略与 pods 相关联。同样，这是您需要手动配置的。

解决这个问题的一个简单方法是启用基于角色的访问控制(RBAC)来定义谁有权访问 API 以及他们拥有什么授权。

您可以使用诸如`allowPrivilegeEscalation`和`readOnly`这样的属性来提升可读性和特权级别方面的安全性。

以下策略显示了用户“bob”的授权级别:

```
{
    "apiVersion": "abac.authorization.kubernetes.io/v1beta1",
    "kind": "Policy",
    "spec": {
    "user": "bob",
    "namespace": "projectCaribou",
    "resource": "pods",
    "readonly": true
    }
}
```

这里，用户“bob”只被授权从名称空间“projectCaribou”中读取对象。

如果请求的类型是“写”或“更新”，那么操作将会失败。

## Docker 图像中的恶意代码

由于 Kubernetes 经常处理容器化的应用程序，通常是 [Docker images](https://docs.docker.com/engine/reference/commandline/image/) ，攻击者经常通过从容器化的应用程序内部获得访问权来突破集群或 Kube 节点。

虽然有不同的解决方案来避免不同类型的攻击，但您总是可以限制内存资源的使用来防止 DoS 攻击。

您可以通过配置入口控制器来实现这一点，入口控制器被定义为限制一个时间范围内的请求数量，例如，每秒 10 个请求或每分钟 1000 个请求。

您可以通过限制每个客户端 IP 的请求或限制服务主机级别的请求来实现这一点。

或者，也可以定义访问控制列表，只允许单个或选定的 IP。这种缓解技术确保没有匿名请求流量淹没服务器，并且还确保只处理来自可信来源的流量/请求。

在部署之前扫描应用程序也是检测恶意代码并立即采取行动的一个很好的经验法则。

## 群集是安全的，透射率不是

通常，只优先考虑集群的安全性，因为这是处理应用程序的工作。但是有一点经常被忽略，那就是默认情况下，transmittance 不包含任何类型的安全措施或加密。

这是一个常见的暴露问题，忽略它可能会为入侵者打开大门，从而获得对您系统的未授权访问。这意味着[传输安全层](https://www.freecodecamp.org/news/what-is-tls-transport-layer-security-encryption-explained-in-plain-english/) (TLS)应该处理集群中服务之间的通信。

网络技术的进步导致了 LinkerD 等产品的出现，这些产品可以默认启用 TLS，同时还提供有关服务交易的附加遥测信息。

同样的原理也适用于“ [etcd](https://www.ibm.com/cloud/learn/etcd) ”，它存储集群的状态。如果不加保护，这将成为攻击者的诱人目标，因为攻击者有可能接管整个群集。即使他们只有读权限，他们也可以滥用它来提升特权。

## 关注运行时

即使您成功地克服了与策略和配置相关的漏洞，运行时也会带来一系列新的障碍。运行时安全漏洞的一个例子是运行恶意进程的被破坏的容器。

虽然加密挖掘已成为闯入容器设置的恶意行为者的流行目标，但攻击者可以从受损的容器执行其他恶意操作，如网络端口扫描以开放对所需资源的访问。

您可以主动监控安全关键容器的运行时活动，例如进程活动和网络通信，以解决这些和其他运行时问题。

此外，还强烈建议您结合构建和部署时间信息，以便在运行时将观察到的活动与预期的活动进行比较。这使得发现任何异常行为变得更加容易。

## 合规性的问题

在云原生系统中，遵守安全标准、法规要求和规范以及组织的内部法规可能很困难。

法规遵从性失败的最常见原因是在容器采用过程中忽视了安全性。

减少此类漏洞的最佳方式是在容器生命周期的早期采用安全控制。尽最大可能自动化必要的检查也是减少开销的好方法。

## 结论

安全性对于容器来说很重要，这是您在使用 Kubernetes 时需要考虑和管理的事情。

归根结底，您的最终目标应该是让入侵者难以进入您的系统。即使它们碰巧进入，基础设施也应该足够好，能够检测到异常活动，并采取行动阻止其扩散。

正如 NCC 集团首席安全顾问 Rory McCune 所说，

> “Kubernetes 非常复杂，在配置上很容易出错。”

Kubernetes 和容器漏洞，如果不修补，可能会导致严重的暴露。